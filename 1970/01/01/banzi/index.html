<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.1.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"mad0g4.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="banzi">
<meta property="og:type" content="article">
<meta property="og:title" content="banzi">
<meta property="og:url" content="https://mad0g4.github.io/1970/01/01/banzi/index.html">
<meta property="og:site_name" content="Blog of Mad0g4">
<meta property="og:description" content="banzi">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://mad0g4.github.io/1970/01/01/banzi/未命名图片_2.png">
<meta property="og:image" content="https://mad0g4.github.io/1970/01/01/banzi/未命名图片_1.png">
<meta property="og:image" content="https://mad0g4.github.io/1970/01/01/banzi/Untitled%20picture.png">
<meta property="og:image" content="https://mad0g4.github.io/1970/01/01/banzi/Untitled%20picture-16335074699661.png">
<meta property="og:image" content="https://mad0g4.github.io/1970/01/01/banzi/未命名图片.png">
<meta property="og:image" content="https://mad0g4.github.io/1970/01/01/banzi/未命名图片2.png">
<meta property="og:image" content="https://mad0g4.github.io/1970/01/01/banzi/1.png">
<meta property="og:image" content="https://mad0g4.github.io/1970/01/01/banzi/2.png">
<meta property="og:image" content="https://mad0g4.github.io/1970/01/01/banzi/3.png">
<meta property="og:image" content="https://mad0g4.github.io/1970/01/01/banzi/4.png">
<meta property="og:image" content="https://mad0g4.github.io/1970/01/01/banzi/1-16335077197532.png">
<meta property="og:image" content="https://mad0g4.github.io/1970/01/01/banzi/2-16335077221143.png">
<meta property="og:image" content="https://mad0g4.github.io/1970/01/01/banzi/3.jpg">
<meta property="og:image" content="https://mad0g4.github.io/1970/01/01/banzi/1.jpg">
<meta property="og:image" content="https://mad0g4.github.io/1970/01/01/banzi/1-16335077867434.jpg">
<meta property="og:image" content="https://mad0g4.github.io/1970/01/01/banzi/1-16335078265535.jpg">
<meta property="og:image" content="https://mad0g4.github.io/1970/01/01/banzi/1-16335078537076.jpg">
<meta property="og:image" content="https://mad0g4.github.io/1970/01/01/banzi/1.png">
<meta property="og:image" content="https://mad0g4.github.io/1970/01/01/banzi/2-16335079634039.png">
<meta property="og:image" content="https://mad0g4.github.io/1970/01/01/banzi/1-163350805284711.png">
<meta property="og:image" content="https://mad0g4.github.io/1970/01/01/banzi/1-163350812960914.jpg">
<meta property="og:image" content="https://mad0g4.github.io/1970/01/01/banzi/2-163350813644915.png">
<meta property="og:image" content="https://mad0g4.github.io/1970/01/01/banzi/1-163350823239916.png">
<meta property="og:image" content="https://mad0g4.github.io/1970/01/01/banzi/2-163350823482917.png">
<meta property="og:image" content="https://mad0g4.github.io/1970/01/01/banzi/3-163350823723018.png">
<meta property="og:image" content="https://mad0g4.github.io/1970/01/01/banzi/4-163350823951519.png">
<meta property="og:image" content="https://mad0g4.github.io/1970/01/01/banzi/image-20211006161742331.png">
<meta property="og:image" content="https://mad0g4.github.io/1970/01/01/banzi/1-163350893337220.png">
<meta property="og:image" content="https://mad0g4.github.io/1970/01/01/banzi/Snipaste_2022-05-10_11-07-01.png">
<meta property="article:published_time" content="1970-01-01T00:00:00.000Z">
<meta property="article:modified_time" content="2022-05-17T11:48:03.372Z">
<meta property="article:author" content="mad0g4">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://mad0g4.github.io/1970/01/01/banzi/未命名图片_2.png">

<link rel="canonical" href="https://mad0g4.github.io/1970/01/01/banzi/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>banzi | Blog of Mad0g4</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Blog of Mad0g4" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Blog of Mad0g4</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">None</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://mad0g4.github.io/1970/01/01/banzi/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="mad0g4">
      <meta itemprop="description" content="Blog of Mad0g4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog of Mad0g4">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          banzi
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 1970-01-01 08:00:00" itemprop="dateCreated datePublished" datetime="1970-01-01T08:00:00+08:00">1970-01-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-05-17 19:48:03" itemprop="dateModified" datetime="2022-05-17T19:48:03+08:00">2022-05-17</time>
              </span>

          
            <div class="post-description">banzi</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<p><strong>Table of Contents</strong> <em>generated with <a target="_blank" rel="noopener" href="https://github.com/thlorenz/doctoc">DocToc</a></em></p>
<ul>
<li><a href="#%E6%99%AE%E9%80%9A%E8%8E%AB%E9%98%9F">普通莫队</a></li>
<li><a href="#%E5%BE%85%E4%BF%AE%E6%94%B9%E8%8E%AB%E9%98%9F">待修改莫队</a></li>
<li><a href="#%E5%9B%9E%E6%BB%9A%E8%8E%AB%E9%98%9F">回滚莫队</a></li>
<li><a href="#%E6%A0%91%E4%B8%8Adfs%E5%BA%8F%E8%8E%AB%E9%98%9F">树上dfs序莫队</a>
<ul>
<li><a href="#wc2013%E7%B3%96%E6%9E%9C%E5%85%AC%E5%9B%AD">WC2013糖果公园</a></li>
</ul></li>
<li><a href="#%E7%9C%9F-%E6%A0%91%E4%B8%8A%E8%8E%AB%E9%98%9F">真
树上莫队</a>
<ul>
<li><a href="#wc2013%E7%B3%96%E6%9E%9C%E5%85%AC%E5%9B%AD-1">WC2013糖果公园</a></li>
</ul></li>
<li><a href="#%E7%82%B9%E5%88%86%E6%B2%BB">点分治</a>
<ul>
<li><a href="#p4178-tree">P4178 Tree</a></li>
</ul></li>
<li><a href="#%E5%8A%A8%E6%80%81%E7%82%B9%E5%88%86%E6%B2%BB">动态点分治</a>
<ul>
<li>[<a href="#p2056-zjoi2007%5C%E6%8D%89%E8%BF%B7%E8%97%8F">P2056
ZJOI2007]捉迷藏</a></li>
</ul></li>
<li><a href="#%E5%85%AC%E5%BC%8F">公式</a></li>
<li><a href="#%E6%9E%81%E8%A7%92%E6%8E%92%E5%BA%8F">极角排序</a>
<ul>
<li><a href="#interger">interger</a></li>
<li><a href="#neko-and-quadrilateral">Neko and quadrilateral</a></li>
</ul></li>
<li><a href="#3d">3D</a>
<ul>
<li><a href="#%E7%A9%BA%E9%97%B4%E7%82%B9%E7%BB%95%E7%BA%BF%E6%97%8B%E8%BD%AC%E5%85%AC%E5%BC%8F">空间点绕线旋转公式</a></li>
</ul></li>
<li><a href="#%E5%9C%86%E4%B9%8B%E9%97%B4%E7%9B%B8%E4%BA%A4">圆之间相交</a>
<ul>
<li><a href="#square-card">Square Card</a></li>
</ul></li>
<li><a href="#%E5%87%B8%E5%8C%85">凸包</a>
<ul>
<li><a href="#smzzl-with-safe-zone">Smzzl with Safe Zone</a></li>
<li><a href="#beauty-contest-poj---2187">Beauty Contest POJ -
2187</a></li>
</ul></li>
<li><a href="#%E4%B8%80%E4%BA%9B%E9%A2%98">一些题</a>
<ul>
<li><a href="#c---empty-convex-polygons">C - Empty Convex
Polygons</a></li>
</ul></li>
<li><a href="#%E5%8D%8A%E5%B9%B3%E9%9D%A2%E4%BA%A4">半平面交</a>
<ul>
<li><a href="#uyuws-concert">Uyuw’s Concert</a></li>
<li><a href="#p4196-cqoi2006%E5%87%B8%E5%A4%9A%E8%BE%B9%E5%BD%A2-%E6%A8%A1%E6%9D%BF%E5%8D%8A%E5%B9%B3%E9%9D%A2%E4%BA%A4">P4196
[CQOI2006]凸多边形 /【模板】半平面交</a></li>
</ul></li>
<li><a href="#%E4%B8%89%E7%BB%B4%E5%87%B8%E5%8C%85">三维凸包</a>
<ul>
<li><a href="#p4724-%E6%A8%A1%E6%9D%BF%E4%B8%89%E7%BB%B4%E5%87%B8%E5%8C%85">P4724
【模板】三维凸包</a></li>
</ul></li>
<li><a href="#kd-tree">KD-TREE</a>
<ul>
<li><a href="#in-case-of-failure">In case of failure</a></li>
</ul></li>
<li><a href="#%E4%B8%BB%E5%B8%AD%E6%A0%91">主席树</a>
<ul>
<li><a href="#p3834-%E6%A8%A1%E6%9D%BF%E5%8F%AF%E6%8C%81%E4%B9%85%E5%8C%96%E7%BA%BF%E6%AE%B5%E6%A0%91-2%E4%B8%BB%E5%B8%AD%E6%A0%91">P3834
【模板】可持久化线段树 2（主席树）</a></li>
<li>[<a href="#p3157-cqoi2011%5C%E5%8A%A8%E6%80%81%E9%80%86%E5%BA%8F%E5%AF%B9">P3157
CQOI2011]动态逆序对</a></li>
<li><a href="#p2633-count-on-a-tree">P2633 Count on a tree</a></li>
</ul></li>
<li><a href="#%E5%B9%B3%E8%A1%A1%E6%A0%91">平衡树</a>
<ul>
<li><a href="#p3369-%E6%A8%A1%E6%9D%BF%E6%99%AE%E9%80%9A%E5%B9%B3%E8%A1%A1%E6%A0%91">P3369
【模板】普通平衡树</a>
<ul>
<li><a href="#treap">Treap:</a></li>
<li><a href="#splay">splay:</a></li>
</ul></li>
<li><a href="#p3391-%E6%A8%A1%E6%9D%BF%E6%96%87%E8%89%BA%E5%B9%B3%E8%A1%A1%E6%A0%91">P3391
【模板】文艺平衡树</a></li>
</ul></li>
<li><a href="#lca">LCA</a>
<ul>
<li><a href="#o1-lca">O(1) LCA</a></li>
</ul></li>
<li><a href="#lct">LCT</a>
<ul>
<li><a href="#p3690-%E6%A8%A1%E6%9D%BF%E5%8A%A8%E6%80%81%E6%A0%91link-cut-tree">P3690
【模板】动态树（Link Cut Tree）</a></li>
<li>[<a href="#p3203-hnoi2010%5C%E5%BC%B9%E9%A3%9E%E7%BB%B5%E7%BE%8A">P3203
HNOI2010]弹飞绵羊</a></li>
<li><a href="#p4299-%E9%A6%96%E9%83%BD">P4299 首都</a></li>
<li><a href="#sp2939-qtree5---query-on-a-tree-v">SP2939 QTREE5 - Query
on a tree V</a></li>
</ul></li>
<li><a href="#%E6%A0%91%E7%9A%84%E6%80%A7%E8%B4%A8">树的性质</a>
<ul>
<li><a href="#%E9%87%8D%E5%BF%83">重心</a></li>
</ul></li>
<li><a href="#%E6%89%A9%E5%B1%95%E5%9F%9F%E5%B9%B6%E6%9F%A5%E9%9B%86">扩展域并查集</a>
<ul>
<li><a href="#e-prefix-enlightenment">E. Prefix Enlightenment</a></li>
<li>[<a href="#p1525-noip2010-%E6%8F%90%E9%AB%98%E7%BB%84%5C-%E5%85%B3%E6%8A%BC%E7%BD%AA%E7%8A%AF">P1525
NOIP2010 提高组] 关押罪犯</a></li>
<li>[<a href="#p2024-noi2001%5C-%E9%A3%9F%E7%89%A9%E9%93%BE">P2024
NOI2001] 食物链</a></li>
</ul></li>
<li><a href="#%E8%BE%B9%E5%B8%A6%E6%9D%83%E5%B9%B6%E6%9F%A5%E9%9B%86">边带权并查集</a>
<ul>
<li>[<a href="#p1196-noi2002%5C-%E9%93%B6%E6%B2%B3%E8%8B%B1%E9%9B%84%E4%BC%A0%E8%AF%B4">P1196
NOI2002] 银河英雄传说</a></li>
</ul></li>
<li><a href="#%E8%99%9A%E6%A0%91">虚树</a>
<ul>
<li><a href="#sdoi2011%5C%E6%B6%88%E8%80%97%E6%88%98">SDOI2011]消耗战</a></li>
<li><a href="#g-yet-another-lcp-problem">G. Yet Another LCP
Problem</a></li>
<li><a href="#p4426-hnoiahoi2018%E6%AF%92%E7%98%A4">P4426
[HNOI/AHOI2018]毒瘤</a></li>
</ul></li>
<li><a href="#segment-tree-beats">segment tree beats</a>
<ul>
<li><a href="#f-stations">F. Stations</a></li>
<li><a href="#gorgeous-sequence">Gorgeous Sequence</a></li>
</ul></li>
<li><a href="#%E5%90%88%E5%B9%B6%E7%BA%BF%E6%AE%B5%E6%A0%91">合并线段树</a>
<ul>
<li><a href="#%E5%90%88%E5%B9%B601trie%E5%BC%82%E6%88%96%E6%A0%91">合并01trie:异或树</a></li>
</ul></li>
<li><a href="#%E6%8B%89%E6%A0%BC%E6%9C%97%E6%97%A5%E6%8F%92%E5%80%BC%E6%B3%95">拉格朗日插值法</a>
<ul>
<li><a href="#f---cumulative-sum-%E6%8B%89%E6%A0%BC%E6%9C%97%E6%97%A5%E6%8F%92%E5%80%BC%E6%B3%95">F
- Cumulative Sum 拉格朗日插值法</a></li>
</ul></li>
<li><a href="#%E6%95%B0%E8%AE%BA%E5%88%86%E5%9D%97">数论分块</a>
<ul>
<li>[<a href="#p2261-cqoi2007%5C%E4%BD%99%E6%95%B0%E6%B1%82%E5%92%8C">P2261
CQOI2007]余数求和</a></li>
</ul></li>
<li><a href="#%E8%8E%AB%E6%AF%94%E4%B9%8C%E6%96%AF">莫比乌斯</a>
<ul>
<li><a href="#%E8%8E%AB%E6%AF%94%E4%B9%8C%E6%96%AF%E5%87%BD%E6%95%B0">莫比乌斯函数</a></li>
<li>[<a href="#p2522-haoi2011%5Cproblem-b">P2522 HAOI2011]Problem
b</a></li>
<li><a href="#lcmsum---lcm-sum">LCMSUM - LCM Sum</a></li>
<li>[<a href="#p1829-%E5%9B%BD%E5%AE%B6%E9%9B%86%E8%AE%AD%E9%98%9F%5Ccrash%E7%9A%84%E6%95%B0%E5%AD%97%E8%A1%A8%E6%A0%BC--jzptab">P1829
国家集训队]Crash的数字表格 / JZPTAB</a></li>
<li><a href="#2185-sdoi2015%E7%BA%A6%E6%95%B0%E4%B8%AA%E6%95%B0%E5%92%8C">#2185.
「SDOI2015」约数个数和</a></li>
<li><a href="#p3768-%E7%AE%80%E5%8D%95%E7%9A%84%E6%95%B0%E5%AD%A6%E9%A2%98">P3768
简单的数学题</a></li>
</ul></li>
<li><a href="#%E6%9D%9C%E6%95%99%E7%AD%9B">杜教筛</a>
<ul>
<li><a href="#%E6%9D%9C%E6%95%99%E7%AD%9B%E5%85%AC%E5%BC%8F">杜教筛公式</a></li>
<li><a href="#p3768-%E7%AE%80%E5%8D%95%E7%9A%84%E6%95%B0%E5%AD%A6%E9%A2%98-1">P3768
简单的数学题</a></li>
<li><a href="#e---huntian-oy">E - huntian oy</a></li>
<li><a href="#1227-%E5%B9%B3%E5%9D%87%E6%9C%80%E5%B0%8F%E5%85%AC%E5%80%8D%E6%95%B0">1227
平均最小公倍数</a></li>
<li><a href="#1220-%E7%BA%A6%E6%95%B0%E4%B9%8B%E5%92%8C">1220
约数之和</a></li>
<li><a href="#gcd-and-lcm">Gcd and Lcm</a></li>
</ul></li>
<li><a href="#min25%E7%AD%9B">min25筛</a></li>
<li><a href="#fft">FFT</a></li>
<li><a href="#ntt">NTT</a></li>
<li><a href="#bsgs">BSGS</a>
<ul>
<li><a href="#pass">Pass!</a></li>
</ul></li>
<li><a href="#burnside-and-polya">Burnside and Polya</a>
<ul>
<li><a href="#%E8%AE%B2%E8%A7%A3%E7%BD%91%E5%9D%80">讲解网址</a></li>
</ul></li>
<li><a href="#crt">CRT</a>
<ul>
<li>[<a href="#p2480-sdoi2010%5C%E5%8F%A4%E4%BB%A3%E7%8C%AA%E6%96%87">P2480
SDOI2010]古代猪文</a></li>
</ul></li>
<li><a href="#%E5%A4%9A%E9%A1%B9%E5%BC%8F%E6%B1%82%E9%80%86">多项式求逆</a>
<ul>
<li><a href="#b---basel-problem">B - Basel Problem</a></li>
</ul></li>
<li><a href="#%E7%9F%A9%E9%98%B5%E6%B1%82%E9%80%86%E9%AB%98%E6%96%AF%E6%B6%88%E5%85%83">矩阵求逆(高斯消元)</a>
<ul>
<li><a href="#p4783-%E6%A8%A1%E6%9D%BF%E7%9F%A9%E9%98%B5%E6%B1%82%E9%80%86">P4783
【模板】矩阵求逆</a></li>
<li><a href="#random-walk-2">Random Walk 2</a></li>
</ul></li>
<li><a href="#%E7%BA%BF%E6%80%A7%E5%9F%BA">线性基</a>
<ul>
<li><a href="#e---odd-subrectangles">E - Odd Subrectangles</a></li>
</ul></li>
<li><a href="#tarjan">tarjan</a>
<ul>
<li><a href="#%E5%89%B2%E7%82%B9">割点</a></li>
</ul></li>
<li><a href="#sam">SAM</a>
<ul>
<li>[<a href="#p4070-sdoi2016%5C%E7%94%9F%E6%88%90%E9%AD%94%E5%92%92">P4070
SDOI2016]生成魔咒</a></li>
<li>[<a href="#p4022-ctsc2012%5C%E7%86%9F%E6%82%89%E7%9A%84%E6%96%87%E7%AB%A0">P4022
CTSC2012]熟悉的文章</a></li>
<li><a href="#display-substring">Display Substring</a></li>
</ul></li>
<li><a href="#ac%E8%87%AA%E5%8A%A8%E6%9C%BA">AC自动机</a>
<ul>
<li><a href="#searching-the-stringzoj-3228">Searching the
String（ZOJ-3228）</a></li>
</ul></li>
<li><a href="#%E5%B9%BF%E4%B9%89sam">广义SAM</a>
<ul>
<li><a href="#p6139-%E6%A8%A1%E6%9D%BF%E5%B9%BF%E4%B9%89%E5%90%8E%E7%BC%80%E8%87%AA%E5%8A%A8%E6%9C%BA%E5%B9%BF%E4%B9%89-sam">P6139
【模板】广义后缀自动机（广义 SAM）</a></li>
<li><a href="#lcs2---longest-common-substring-ii">LCS2 - Longest Common
Substring II</a></li>
</ul></li>
<li><a href="#%E6%95%B0%E4%BD%8Ddp">数位DP</a>
<ul>
<li>[<a href="#p4127-ahoi2009%5C%E5%90%8C%E7%B1%BB%E5%88%86%E5%B8%83">P4127
AHOI2009]同类分布</a></li>
</ul></li>
<li><a href="#%E5%8A%A8%E6%80%81dp">动态dp</a></li>
<li><a href="#%E6%A0%91%E4%B8%8A%E8%83%8C%E5%8C%85">树上背包</a></li>
<li><a href="#%E7%BD%91%E7%BB%9C%E6%B5%81">网络流</a>
<ul>
<li><a href="#dinic">Dinic</a></li>
<li><a href="#%E8%B4%B9%E7%94%A8%E6%B5%81">费用流</a></li>
</ul></li>
<li><a href="#km%E4%BA%8C%E5%88%86%E5%9B%BE%E5%8C%B9%E9%85%8D">KM二分图匹配</a></li>
<li><a href="#optimize_dp">optimize_DP</a>
<ul>
<li><a href="#%E5%9B%9B%E8%BE%B9%E5%BD%A2%E4%BC%98%E5%8C%96dp">四边形优化DP</a>
<ul>
<li><a href="#merging-the-rocks">merging the rocks</a></li>
</ul></li>
<li><a href="#%E6%96%9C%E7%8E%87%E4%BC%98%E5%8C%96dp">斜率优化DP</a>
<ul>
<li><a href="#%E7%8E%A9%E5%85%B7%E8%A3%85%E7%AE%B1">玩具装箱</a></li>
</ul></li>
</ul></li>
<li><a href="#2sat">2sat</a>
<ul>
<li><a href="#words-on-tree">Words on Tree</a></li>
</ul></li>
<li><a href="#cdqfft">CDQFFT</a></li>
<li><a href="#mtt">MTT</a></li>
<li><a href="#fwt">FWT</a></li>
<li><a href="#%E4%BA%8C%E7%BB%B4%E6%A0%BC%E9%9B%B7%E7%A0%81">二维格雷码</a></li>
<li><a href="#%E4%BA%94%E8%BE%B9%E5%BD%A2%E6%95%B0">五边形数</a></li>
<li><a href="#sosdp">SOSDP</a></li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<h1 id="普通莫队">普通莫队</h1>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> dd double</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ld long double</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 50006</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> mod=<span class="number">998244353</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> blo=<span class="number">300</span>;</span><br><span class="line"><span class="function">ll <span class="title">gcd</span><span class="params">(ll x,ll y)</span></span>&#123;<span class="keyword">return</span> y==<span class="number">0</span>?x:<span class="built_in">gcd</span>(y,x%y);&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span>&#123;<span class="type">int</span> l,r,id;&#125;q[N];</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span><span class="params">(Node n1,Node n2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(n1.l/blo==n2.l/blo) <span class="keyword">return</span> n1.r&lt;n2.r;</span><br><span class="line">    <span class="keyword">return</span> n1.l&lt;n2.l;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> n,m,c[N];</span><br><span class="line">ll num[N],ans,a1[N],a2[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    ans-=<span class="number">1ll</span>*num[x]*(num[x]<span class="number">-1</span>)/<span class="number">2ll</span>;</span><br><span class="line">    ++num[x];</span><br><span class="line">    ans+=<span class="number">1ll</span>*num[x]*(num[x]<span class="number">-1</span>)/<span class="number">2ll</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">del</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    ans-=<span class="number">1ll</span>*num[x]*(num[x]<span class="number">-1</span>)/<span class="number">2ll</span>;</span><br><span class="line">    --num[x];</span><br><span class="line">    ans+=<span class="number">1ll</span>*num[x]*(num[x]<span class="number">-1</span>)/<span class="number">2ll</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;1.txt&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;2.txt&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;c[i]);</span><br><span class="line">    <span class="type">int</span> l=<span class="number">1</span>,r=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;++i) <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;q[i].l,&amp;q[i].r),q[i].id=i;</span><br><span class="line">    <span class="built_in">sort</span>(q+<span class="number">1</span>,q+<span class="number">1</span>+m,cmp);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;++i)&#123;</span><br><span class="line">        <span class="keyword">while</span>(l&lt;q[i].l) <span class="built_in">del</span>(c[l++]);</span><br><span class="line">        <span class="keyword">while</span>(l&gt;q[i].l) <span class="built_in">add</span>(c[--l]);</span><br><span class="line">        <span class="keyword">while</span>(r&lt;q[i].r) <span class="built_in">add</span>(c[++r]);</span><br><span class="line">        <span class="keyword">while</span>(r&gt;q[i].r) <span class="built_in">del</span>(c[r--]);</span><br><span class="line">        <span class="keyword">if</span>(l==r) a1[q[i].id]=<span class="number">0</span>,a2[q[i].id]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(ans==<span class="number">0</span>) a1[q[i].id]=<span class="number">0</span>,a2[q[i].id]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            a1[q[i].id]=ans; a2[q[i].id]=<span class="number">1ll</span>*(r-l+<span class="number">1</span>)*(r-l)/<span class="number">2ll</span>;</span><br><span class="line">            ll tmp=<span class="built_in">gcd</span>(a1[q[i].id],a2[q[i].id]);</span><br><span class="line">            a1[q[i].id]/=tmp; a2[q[i].id]/=tmp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;++i) <span class="built_in">printf</span>(<span class="string">&quot;%lld/%lld\n&quot;</span>,a1[i],a2[i]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">1 2 3</span></span><br><span class="line"><span class="comment">3 4 5</span></span><br><span class="line"><span class="comment">1 4</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">1 2 3 4 2</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h1 id="待修改莫队">待修改莫队</h1>
<p>注意值的大小为<span class="math inline">\(1e6\)</span></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> dd double</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ld long double</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 140006</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAXV 1000006</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> mod=<span class="number">998244353</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> blo=<span class="built_in">pow</span>(N,<span class="number">2.0</span>/<span class="number">3.0</span>)+<span class="number">1</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span>&#123;<span class="type">int</span> l,r,tim,id;&#125;q[N];</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span><span class="params">(Node n1,Node n2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(n1.l/blo==n2.l/blo)&#123;</span><br><span class="line">        <span class="keyword">if</span>(n1.r/blo==n2.r/blo) <span class="keyword">return</span> n1.tim&lt;n2.tim;</span><br><span class="line">        <span class="keyword">return</span> n1.r&lt;n2.r;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> n1.l&lt;n2.l;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> n,m,c[N],totmo,ctmp[N],totq,an[N];</span><br><span class="line">pair&lt;<span class="type">int</span>,pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt;&gt; mo[N];</span><br><span class="line"><span class="type">int</span> num[MAXV],ans;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!num[x]) ++ans; ++num[x];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">del</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    --num[x]; <span class="keyword">if</span>(!num[x]) --ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">chan</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> pos,<span class="type">int</span> val)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(pos&gt;=l&amp;&amp;pos&lt;=r) <span class="built_in">del</span>(c[pos]),<span class="built_in">add</span>(val);</span><br><span class="line">    c[pos]=val;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;1.txt&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;2.txt&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;c[i]),ctmp[i]=c[i];</span><br><span class="line">    <span class="type">int</span> l=<span class="number">1</span>,r=<span class="number">0</span>,tim=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;++i)&#123;</span><br><span class="line">        <span class="type">int</span> t1,t2; <span class="type">char</span> opt[<span class="number">10</span>];</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s%d%d&quot;</span>,opt,&amp;t1,&amp;t2);</span><br><span class="line">        <span class="keyword">if</span>(opt[<span class="number">0</span>]==<span class="string">&#x27;R&#x27;</span>)&#123;</span><br><span class="line">            mo[++totmo]=&#123;t1,&#123;ctmp[t1],t2&#125;&#125;; ctmp[t1]=t2;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            ++totq;</span><br><span class="line">            q[totq]=(Node)&#123;t1,t2,totmo,totq&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sort</span>(q+<span class="number">1</span>,q+<span class="number">1</span>+totq,cmp);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=totq;++i)&#123;</span><br><span class="line">        <span class="keyword">while</span>(l&lt;q[i].l) <span class="built_in">del</span>(c[l++]);</span><br><span class="line">        <span class="keyword">while</span>(l&gt;q[i].l) <span class="built_in">add</span>(c[--l]);</span><br><span class="line">        <span class="keyword">while</span>(r&lt;q[i].r) <span class="built_in">add</span>(c[++r]);</span><br><span class="line">        <span class="keyword">while</span>(r&gt;q[i].r) <span class="built_in">del</span>(c[r--]);</span><br><span class="line">        <span class="keyword">while</span>(tim&lt;q[i].tim) <span class="built_in">chan</span>(l,r,mo[tim+<span class="number">1</span>].first,mo[tim+<span class="number">1</span>].second.second),++tim;</span><br><span class="line">        <span class="keyword">while</span>(tim&gt;q[i].tim) <span class="built_in">chan</span>(l,r,mo[tim].first,mo[tim].second.first),--tim;</span><br><span class="line">        an[q[i].id]=ans;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=totq;++i) <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,an[i]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">1 2 3</span></span><br><span class="line"><span class="comment">3 4 5</span></span><br><span class="line"><span class="comment">1 4</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">1 2 3 4 2</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h1 id="回滚莫队">回滚莫队</h1>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> dd double</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ld long double</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAXV 1000006</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 100006</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> mod=<span class="number">998244353</span>;</span><br><span class="line"><span class="type">int</span> blo;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span>&#123;<span class="type">int</span> l,r,id;&#125;b[N];</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span><span class="params">(Node n1,Node n2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(n1.l/blo==n2.l/blo) <span class="keyword">return</span> n1.r&lt;n2.r;</span><br><span class="line">    <span class="keyword">return</span> n1.l&lt;n2.l;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> n,q,a[N],l,r,c[N],totv;</span><br><span class="line">ll num[N],ans,an[N],num2[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> vv)</span></span>&#123;</span><br><span class="line">    ++num[vv]; <span class="keyword">if</span>(ans&lt;num[vv]*c[vv]) ans=num[vv]*c[vv];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;1.txt&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;2.txt&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;q);</span><br><span class="line">    blo=<span class="built_in">sqrt</span>(n)+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;a[i]),c[i]=a[i];</span><br><span class="line">    <span class="built_in">sort</span>(c+<span class="number">1</span>,c+<span class="number">1</span>+n);</span><br><span class="line">    totv=<span class="built_in">unique</span>(c+<span class="number">1</span>,c+<span class="number">1</span>+n)-c<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i) a[i]=<span class="built_in">lower_bound</span>(c+<span class="number">1</span>,c+<span class="number">1</span>+totv,a[i])-c;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=q;++i) <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;b[i].l,&amp;b[i].r),b[i].id=i;</span><br><span class="line">    <span class="built_in">sort</span>(b+<span class="number">1</span>,b+<span class="number">1</span>+q,cmp);</span><br><span class="line">    l=<span class="number">1</span>; r=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=q;++i)&#123;</span><br><span class="line">        <span class="keyword">if</span>(l/blo&lt;=b[i].l/blo)&#123;</span><br><span class="line">            ans=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=totv;++j) num[j]=<span class="number">0</span>;</span><br><span class="line">            l=b[i].l/blo*blo+blo+<span class="number">1</span>,r=l<span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(b[i].l/blo==b[i].r/blo)&#123;</span><br><span class="line">            ll tmpa=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=b[i].l;j&lt;=b[i].r;++j)&#123;</span><br><span class="line">                ++num2[a[j]];</span><br><span class="line">                <span class="keyword">if</span>(tmpa&lt;num2[a[j]]*c[a[j]]) tmpa=num2[a[j]]*c[a[j]];</span><br><span class="line">            &#125;</span><br><span class="line">            an[b[i].id]=tmpa;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=b[i].l;j&lt;=b[i].r;++j) --num2[a[j]];</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(r&lt;b[i].r) <span class="built_in">add</span>(a[++r]);</span><br><span class="line">        ll tmp=ans; <span class="type">int</span> tmpl=l;</span><br><span class="line">        <span class="keyword">while</span>(l&gt;b[i].l) <span class="built_in">add</span>(a[--l]);</span><br><span class="line">        an[b[i].id]=ans;</span><br><span class="line">        ans=tmp;</span><br><span class="line">        <span class="keyword">while</span>(l&lt;tmpl) --num[a[l++]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=q;++i) <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,an[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="树上dfs序莫队">树上dfs序莫队</h1>
<h2 id="wc2013糖果公园"><a target="_blank" rel="noopener" href="https://uoj.ac/problem/58">WC2013糖果公园</a></h2>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> dd double</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ld long double</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAXV 1000006</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 100006</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> mod=<span class="number">998244353</span>;</span><br><span class="line"><span class="type">int</span> blo;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span>&#123;<span class="type">int</span> l,r,tim,id;&#125;b[N];</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span><span class="params">(Node n1,Node n2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(n1.l/blo==n2.l/blo)&#123;</span><br><span class="line">        <span class="keyword">if</span>(n1.r/blo==n2.r/blo) <span class="keyword">return</span> n1.tim&lt;n2.tim;</span><br><span class="line">        <span class="keyword">return</span> n1.r&lt;n2.r;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> n1.l&lt;n2.l;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> n,m,q,vis[N],col[N],totmo,totq,tmpc[N],tim,f[N],g[N],anti[N&lt;&lt;<span class="number">1</span>],st[N][<span class="number">21</span>],dep[N],num[N];</span><br><span class="line">ll v[N],w[N],ans,an[N];</span><br><span class="line">pair&lt;<span class="type">int</span>,pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt;&gt; mo[N];</span><br><span class="line"><span class="type">int</span> head[N],cnt,to[N&lt;&lt;<span class="number">1</span>],nxt[N&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">adde</span><span class="params">(<span class="type">int</span> t1,<span class="type">int</span> t2)</span></span>&#123;</span><br><span class="line">    ++cnt;</span><br><span class="line">    nxt[cnt]=head[t1];</span><br><span class="line">    head[t1]=cnt;</span><br><span class="line">    to[cnt]=t2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs1</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> ff)</span></span>&#123;</span><br><span class="line">    f[x]=++tim; anti[tim]=x;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=head[x];i;i=nxt[i])</span><br><span class="line">        <span class="keyword">if</span>(to[i]!=ff)&#123;</span><br><span class="line">            st[to[i]][<span class="number">0</span>]=x;</span><br><span class="line">            dep[to[i]]=dep[x]+<span class="number">1</span>;</span><br><span class="line">            <span class="built_in">dfs1</span>(to[i],x);</span><br><span class="line">        &#125;</span><br><span class="line">    g[x]=++tim; anti[tim]=x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">LCA</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(dep[x]&lt;dep[y]) <span class="built_in">swap</span>(x,y);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">20</span>;j&gt;=<span class="number">0</span>;--j) <span class="keyword">if</span>(st[x][j]&amp;&amp;dep[st[x][j]]&gt;=dep[y]) x=st[x][j];</span><br><span class="line">    <span class="keyword">if</span>(x==y) <span class="keyword">return</span> x;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">20</span>;j&gt;=<span class="number">0</span>;--j) <span class="keyword">if</span>(st[x][j]&amp;&amp;st[x][j]!=st[y][j]) x=st[x][j],y=st[y][j];</span><br><span class="line">    <span class="keyword">return</span> st[x][<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">del</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    ans-=<span class="number">1ll</span>*v[x]*w[num[x]];</span><br><span class="line">    --num[x];</span><br><span class="line">    ans+=<span class="number">1ll</span>*v[x]*w[num[x]];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    ans-=<span class="number">1ll</span>*v[x]*w[num[x]];</span><br><span class="line">    ++num[x];</span><br><span class="line">    ans+=<span class="number">1ll</span>*v[x]*w[num[x]];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">modi</span><span class="params">(<span class="type">int</span> pos,<span class="type">int</span> val)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(vis[pos]) <span class="built_in">del</span>(col[pos]),<span class="built_in">add</span>(val);</span><br><span class="line">    col[pos]=val;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">swi</span><span class="params">(<span class="type">int</span> pos)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(vis[pos]) <span class="built_in">del</span>(col[pos]);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">add</span>(col[pos]);</span><br><span class="line">    vis[pos]^=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;1.txt&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;2.txt&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;n,&amp;m,&amp;q);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;++i) <span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>,v+i);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i) <span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>,w+i),w[i]+=w[i<span class="number">-1</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;++i)&#123;</span><br><span class="line">        <span class="type">int</span> t1,t2; <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;t1,&amp;t2);</span><br><span class="line">        <span class="built_in">adde</span>(t1,t2); <span class="built_in">adde</span>(t2,t1);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dfs1</span>(<span class="number">1</span>,<span class="number">-1</span>);</span><br><span class="line">    blo=<span class="built_in">pow</span>(tim,<span class="number">2.0</span>/<span class="number">3.0</span>)+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=<span class="number">20</span>;++j) <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i) st[i][j]=st[st[i][j<span class="number">-1</span>]][j<span class="number">-1</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,col+i),tmpc[i]=col[i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=q;++i)&#123;</span><br><span class="line">        <span class="type">int</span> opt,t1,t2;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;opt,&amp;t1,&amp;t2);</span><br><span class="line">        <span class="keyword">if</span>(!opt)&#123;</span><br><span class="line">            mo[++totmo]=&#123;t1,&#123;tmpc[t1],t2&#125;&#125;; tmpc[t1]=t2;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="type">int</span> lca=<span class="built_in">LCA</span>(t1,t2);</span><br><span class="line">            <span class="keyword">if</span>(f[t1]&gt;f[t2]) <span class="built_in">swap</span>(t1,t2);</span><br><span class="line">            <span class="keyword">if</span>(lca!=t1&amp;&amp;lca!=t2)</span><br><span class="line">                b[++totq]=&#123;g[t1],f[t2],totmo,totq&#125;;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                b[++totq]=&#123;f[t1],f[t2],totmo,totq&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sort</span>(b+<span class="number">1</span>,b+<span class="number">1</span>+totq,cmp);</span><br><span class="line">    <span class="type">int</span> l=<span class="number">1</span>,r=<span class="number">0</span>,t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=totq;++i)&#123;</span><br><span class="line">        <span class="keyword">while</span>(t&lt;b[i].tim) <span class="built_in">modi</span>(mo[t+<span class="number">1</span>].first,mo[t+<span class="number">1</span>].second.second),++t;</span><br><span class="line">        <span class="keyword">while</span>(t&gt;b[i].tim) <span class="built_in">modi</span>(mo[t].first,mo[t].second.first),--t;</span><br><span class="line">        <span class="keyword">while</span>(r&lt;b[i].r) <span class="built_in">swi</span>(anti[++r]);</span><br><span class="line">        <span class="keyword">while</span>(r&gt;b[i].r) <span class="built_in">swi</span>(anti[r--]);</span><br><span class="line">        <span class="keyword">while</span>(l&lt;b[i].l) <span class="built_in">swi</span>(anti[l++]);</span><br><span class="line">        <span class="keyword">while</span>(l&gt;b[i].l) <span class="built_in">swi</span>(anti[--l]);</span><br><span class="line">        <span class="type">int</span> lca=<span class="built_in">LCA</span>(anti[b[i].l],anti[b[i].r]);</span><br><span class="line">        <span class="keyword">if</span>(lca!=anti[b[i].l]&amp;&amp;lca!=anti[b[i].r])&#123;</span><br><span class="line">            <span class="built_in">swi</span>(lca); an[b[i].id]=ans;</span><br><span class="line">            <span class="built_in">swi</span>(lca);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> an[b[i].id]=ans;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=totq;++i) <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,an[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="真-树上莫队">真 树上莫队</h1>
<h2 id="wc2013糖果公园-1"><a target="_blank" rel="noopener" href="https://uoj.ac/problem/58">WC2013糖果公园</a></h2>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> dd double</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ld long double</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 100006</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> mod=<span class="number">998244353</span>;</span><br><span class="line"><span class="type">int</span> blo,bel[N];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span>&#123;<span class="type">int</span> l,r,tim,id;&#125;b[N];</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span><span class="params">(Node &amp;n1,Node &amp;n2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> bel[n1.l]==bel[n2.l]?(bel[n1.r]==bel[n2.r]?n1.tim&lt;n2.tim:bel[n1.r]&lt;bel[n2.r]):bel[n1.l]&lt;bel[n2.l];</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> n,m,q,col[N],tmpc[N],dep[N],sta[N],he,st[<span class="number">21</span>][N],totb,totq,totmo,vis[N],num[N],v[N],w[N];</span><br><span class="line">ll an[N],ans;</span><br><span class="line">pair&lt;<span class="type">int</span>,pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt;&gt; mo[N];</span><br><span class="line"><span class="type">int</span> head[N],cnt,to[N&lt;&lt;<span class="number">1</span>],nxt[N&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">adde</span><span class="params">(<span class="type">int</span> t1,<span class="type">int</span> t2)</span></span>&#123;</span><br><span class="line">    ++cnt;</span><br><span class="line">    nxt[cnt]=head[t1];</span><br><span class="line">    head[t1]=cnt;</span><br><span class="line">    to[cnt]=t2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs1</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> ff)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> tmp=he; <span class="comment">// ************</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=head[x];i;i=nxt[i])</span><br><span class="line">        <span class="keyword">if</span>(to[i]!=ff)&#123;</span><br><span class="line">            dep[to[i]]=dep[x]+<span class="number">1</span>;</span><br><span class="line">            st[<span class="number">0</span>][to[i]]=x;</span><br><span class="line">            <span class="built_in">dfs1</span>(to[i],x);</span><br><span class="line">            <span class="keyword">if</span>(he-tmp&gt;=blo)&#123;</span><br><span class="line">                ++totb;</span><br><span class="line">                <span class="keyword">while</span>(he&gt;tmp) bel[sta[he--]]=totb;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    sta[++he]=x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">swi</span><span class="params">(<span class="type">int</span> pos)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(vis[pos]) ans-=<span class="number">1ll</span>*v[col[pos]]*w[num[col[pos]]--];</span><br><span class="line">    <span class="keyword">else</span> ans+=<span class="number">1ll</span>*v[col[pos]]*w[++num[col[pos]]];</span><br><span class="line">    vis[pos]^=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">LCA</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(dep[x]&lt;dep[y]) <span class="built_in">swap</span>(x,y);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">16</span>;j&gt;=<span class="number">0</span>;--j) <span class="keyword">if</span>(st[j][x]&amp;&amp;dep[st[j][x]]&gt;=dep[y]) x=st[j][x];</span><br><span class="line">    <span class="keyword">if</span>(x==y) <span class="keyword">return</span> x;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">16</span>;j&gt;=<span class="number">0</span>;--j) <span class="keyword">if</span>(st[j][x]&amp;&amp;st[j][x]!=st[j][y]) x=st[j][x],y=st[j][y];</span><br><span class="line">    <span class="keyword">return</span> st[<span class="number">0</span>][x];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pathmo</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(dep[x]&lt;dep[y]) <span class="built_in">swap</span>(x,y);</span><br><span class="line">    <span class="keyword">while</span>(dep[x]&gt;dep[y])&#123;</span><br><span class="line">        <span class="built_in">swi</span>(x);</span><br><span class="line">        x=st[<span class="number">0</span>][x];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(x!=y)&#123;</span><br><span class="line">        <span class="built_in">swi</span>(x); <span class="built_in">swi</span>(y);</span><br><span class="line">        x=st[<span class="number">0</span>][x]; y=st[<span class="number">0</span>][y];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">modic</span><span class="params">(<span class="type">int</span> pos,<span class="type">int</span> val)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(vis[pos])&#123;</span><br><span class="line">        ans-=<span class="number">1ll</span>*v[col[pos]]*w[num[col[pos]]--];</span><br><span class="line">        ans+=<span class="number">1ll</span>*v[val]*w[++num[val]];</span><br><span class="line">    &#125;</span><br><span class="line">    col[pos]=val;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;1.txt&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;2.txt&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;n,&amp;m,&amp;q);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;++i) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,v+i);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,w+i);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;++i)&#123;</span><br><span class="line">        <span class="type">int</span> t1,t2; <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;t1,&amp;t2);</span><br><span class="line">        <span class="built_in">adde</span>(t1,t2); <span class="built_in">adde</span>(t2,t1);</span><br><span class="line">    &#125;</span><br><span class="line">    blo=<span class="built_in">pow</span>(n,<span class="number">2.0</span>/<span class="number">3.0</span>);</span><br><span class="line">    <span class="built_in">dfs1</span>(<span class="number">1</span>,<span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">while</span>(he) bel[sta[he--]]=totb;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=<span class="number">16</span>;++j) <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i) st[j][i]=st[j<span class="number">-1</span>][st[j<span class="number">-1</span>][i]];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,col+i),tmpc[i]=col[i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=q;++i)&#123;</span><br><span class="line">        <span class="type">int</span> opt,t1,t2;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;opt,&amp;t1,&amp;t2);</span><br><span class="line">        <span class="keyword">if</span>(!opt)&#123;</span><br><span class="line">            mo[++totmo]=&#123;t1,&#123;tmpc[t1],t2&#125;&#125;; tmpc[t1]=t2;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            b[++totq]=&#123;t1,t2,totmo,totq&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sort</span>(b+<span class="number">1</span>,b+<span class="number">1</span>+totq,cmp);</span><br><span class="line">    <span class="type">int</span> l=<span class="number">1</span>,r=<span class="number">1</span>,t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=totq;++i)&#123;</span><br><span class="line">        <span class="built_in">pathmo</span>(l,b[i].l);</span><br><span class="line">        <span class="built_in">pathmo</span>(r,b[i].r);</span><br><span class="line">        l=b[i].l; r=b[i].r;</span><br><span class="line">        <span class="keyword">while</span>(t&lt;b[i].tim) <span class="built_in">modic</span>(mo[t+<span class="number">1</span>].first,mo[t+<span class="number">1</span>].second.second),++t;</span><br><span class="line">        <span class="keyword">while</span>(t&gt;b[i].tim) <span class="built_in">modic</span>(mo[t].first,mo[t].second.first),--t;</span><br><span class="line">        <span class="type">int</span> lca=<span class="built_in">LCA</span>(l,r);</span><br><span class="line">        <span class="built_in">swi</span>(lca); an[b[i].id]=ans; <span class="built_in">swi</span>(lca);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=totq;++i) <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,an[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="点分治">点分治</h1>
<h2 id="p4178-tree"><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4178">P4178 Tree</a></h2>
<p>使用树状数组维护点分治</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 40006</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> M 20006</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod 1000000007</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> n,m,ans;</span><br><span class="line"><span class="type">int</span> head[N],cnt,v[N&lt;&lt;<span class="number">1</span>],val[N&lt;&lt;<span class="number">1</span>],nxt[N&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> t1,<span class="type">int</span> t2,<span class="type">int</span> t3)</span></span>&#123;</span><br><span class="line">    ++cnt;</span><br><span class="line">    nxt[cnt]=head[t1];</span><br><span class="line">    head[t1]=cnt;</span><br><span class="line">    v[cnt]=t2;</span><br><span class="line">    val[cnt]=t3;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> c[M];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> pos,<span class="type">int</span> val)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=pos;i&lt;M;i+=(i&amp;(-i)))&#123;</span><br><span class="line">        c[i]+=val;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">qq</span><span class="params">(<span class="type">int</span> pos)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=pos;i&gt;<span class="number">0</span>;i-=(i&amp;(-i)))</span><br><span class="line">        res+=c[i];</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> rt,sz[N],mxson[N],dis[N];</span><br><span class="line"><span class="type">bool</span> vis[N];</span><br><span class="line"><span class="type">int</span> sta[N],he,tmpsta[N],tmphe;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">calcrt</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> fa,<span class="type">int</span> totsz)</span></span>&#123;</span><br><span class="line">    sz[x]=<span class="number">1</span>; mxson[x]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=head[x];i;i=nxt[i])&#123;</span><br><span class="line">        <span class="keyword">if</span>(!vis[v[i]]&amp;&amp;v[i]!=fa)&#123;</span><br><span class="line">            <span class="built_in">calcrt</span>(v[i],x,totsz);</span><br><span class="line">            sz[x]+=sz[v[i]];</span><br><span class="line">            mxson[x]=(mxson[x]&lt;sz[v[i]]?sz[v[i]]:mxson[x]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    mxson[x]=(mxson[x]&lt;(totsz-sz[x])?(totsz-sz[x]):mxson[x]);</span><br><span class="line">    <span class="keyword">if</span>(!rt||mxson[rt]&gt;mxson[x])</span><br><span class="line">        rt=x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">calcdis</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> fa)</span></span>&#123;</span><br><span class="line">    tmpsta[++tmphe]=dis[x];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=head[x];i;i=nxt[i])&#123;</span><br><span class="line">        <span class="keyword">if</span>(!vis[v[i]]&amp;&amp;v[i]!=fa)&#123;</span><br><span class="line">            dis[v[i]]=dis[x]+val[i];</span><br><span class="line">            <span class="built_in">calcdis</span>(v[i],x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> fa)</span></span>&#123;</span><br><span class="line">    vis[x]=<span class="number">1</span>; sta[++he]=<span class="number">0</span>; <span class="built_in">add</span>(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=head[x];i;i=nxt[i])&#123;</span><br><span class="line">        <span class="keyword">if</span>(!vis[v[i]]&amp;&amp;v[i]!=fa)&#123;</span><br><span class="line">            dis[v[i]]=val[i];</span><br><span class="line">            <span class="built_in">calcdis</span>(v[i],x);</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">1</span>;k&lt;=tmphe;++k)&#123;</span><br><span class="line">                <span class="keyword">if</span>(m&gt;=tmpsta[k])&#123;</span><br><span class="line">                    ans+=<span class="built_in">qq</span>(m-tmpsta[k]+<span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span>(tmphe)&#123;</span><br><span class="line">                <span class="keyword">if</span>(tmpsta[tmphe]&lt;=m)</span><br><span class="line">                    <span class="built_in">add</span>(tmpsta[tmphe]+<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">                sta[++he]=tmpsta[tmphe--];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(he)&#123;</span><br><span class="line">        <span class="keyword">if</span>(sta[he]&lt;=m)</span><br><span class="line">            <span class="built_in">add</span>(sta[he]+<span class="number">1</span>,<span class="number">-1</span>);</span><br><span class="line">        --he;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=head[x];i;i=nxt[i])&#123;</span><br><span class="line">        <span class="keyword">if</span>(!vis[v[i]]&amp;&amp;v[i]!=fa)&#123;</span><br><span class="line">            rt=<span class="number">0</span>; <span class="comment">//***********</span></span><br><span class="line">            <span class="built_in">calcrt</span>(v[i],x,sz[v[i]]);</span><br><span class="line">            <span class="built_in">dfs</span>(rt,<span class="number">-1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> t1,t2,t3;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;++i)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;t1,&amp;t2,&amp;t3);</span><br><span class="line">        <span class="built_in">add</span>(t1,t2,t3);</span><br><span class="line">        <span class="built_in">add</span>(t2,t1,t3);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;m);</span><br><span class="line">    rt=<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">calcrt</span>(<span class="number">1</span>,<span class="number">-1</span>,n);</span><br><span class="line">    <span class="built_in">dfs</span>(rt,<span class="number">-1</span>);</span><br><span class="line">    cout&lt;&lt;ans&lt;&lt;endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="动态点分治">动态点分治</h1>
<h2 id="p2056-zjoi2007捉迷藏">[P2056 <a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2056">ZJOI2007]捉迷藏</a></h2>
<p>先构造点分树，然后给每一个点维护两个可删大根堆，一个记录在点分树中当前点的子树中的点到父亲节点的距离h1，一个记录所有儿子节点h1的最大值h2，还有一个h3维护h2中top1-top2的值。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> dd double</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod 998244353</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> maxn=<span class="number">100006</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> maxm=<span class="number">500006</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Hp</span>&#123;</span><br><span class="line">    priority_queue&lt;<span class="type">int</span>,vector&lt;<span class="type">int</span>&gt;,less&lt;<span class="type">int</span>&gt; &gt; q1,q2;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">push</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        q1.<span class="built_in">push</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">erase</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        q2.<span class="built_in">push</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">size</span><span class="params">()</span></span>&#123; <span class="keyword">return</span> q1.<span class="built_in">size</span>()-q2.<span class="built_in">size</span>(); &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pop</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(q2.<span class="built_in">size</span>()&amp;&amp;q1.<span class="built_in">top</span>()==q2.<span class="built_in">top</span>()) q1.<span class="built_in">pop</span>(),q2.<span class="built_in">pop</span>();</span><br><span class="line">        q1.<span class="built_in">pop</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">top</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(q2.<span class="built_in">size</span>()&amp;&amp;q1.<span class="built_in">top</span>()==q2.<span class="built_in">top</span>()) q1.<span class="built_in">pop</span>(),q2.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">return</span> q1.<span class="built_in">top</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">top2</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="type">int</span> t1=<span class="built_in">top</span>(); <span class="built_in">pop</span>();</span><br><span class="line">        <span class="type">int</span> t2=<span class="built_in">top</span>(); <span class="built_in">push</span>(t1);</span><br><span class="line">        <span class="keyword">return</span> t2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;h1[maxn],h2[maxn],h3;</span><br><span class="line"><span class="type">int</span> n,q;</span><br><span class="line"><span class="type">char</span> s[<span class="number">100</span>];</span><br><span class="line"><span class="type">int</span> head[maxn],cnt,v[maxn&lt;&lt;<span class="number">1</span>],nxt[maxn&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> t1,<span class="type">int</span> t2)</span></span>&#123;</span><br><span class="line">    ++cnt;</span><br><span class="line">    nxt[cnt]=head[t1];</span><br><span class="line">    head[t1]=cnt;</span><br><span class="line">    v[cnt]=t2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> rt,root,dep[maxn],sz[maxn],mxsz[maxn],ban[maxn],dad[maxn];</span><br><span class="line"><span class="type">int</span> state[maxn],numon;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; to[maxn];</span><br><span class="line"><span class="type">int</span> st[maxm&lt;&lt;<span class="number">1</span>][<span class="number">21</span>],oula[maxm&lt;&lt;<span class="number">1</span>],tot,dfn[maxm&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> tim,anti[maxm&lt;&lt;<span class="number">1</span>],lcadep[maxn],firpos[maxn];</span><br><span class="line"><span class="type">int</span> lowb[maxm&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfsou</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> fa)</span></span>&#123;</span><br><span class="line">    dfn[x]=++tim;</span><br><span class="line">    anti[tim]=x;</span><br><span class="line">    oula[++tot]=dfn[x];</span><br><span class="line">    firpos[x]=tot;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=head[x];i;i=nxt[i])&#123;</span><br><span class="line">        <span class="keyword">if</span>(v[i]==fa) <span class="keyword">continue</span>;</span><br><span class="line">        lcadep[v[i]]=lcadep[x]+<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">dfsou</span>(v[i],x);</span><br><span class="line">        oula[++tot]=dfn[x];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Initst</span><span class="params">()</span></span>&#123;</span><br><span class="line">    lowb[<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>,j=<span class="number">1</span>;j&lt;=tot;j&lt;&lt;=<span class="number">1</span>,++i)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> k=j+<span class="number">1</span>;k&lt;=j+j&amp;&amp;k&lt;=tot;++k)&#123;</span><br><span class="line">            lowb[k]=i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=tot;++i)&#123;</span><br><span class="line">        st[i][<span class="number">0</span>]=oula[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=<span class="number">20</span>;++j)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=tot;++i)&#123;</span><br><span class="line">            st[i][j]=st[i][j<span class="number">-1</span>];</span><br><span class="line">            <span class="keyword">if</span>(i+(<span class="number">1</span>&lt;&lt;(j<span class="number">-1</span>))&lt;=tot)</span><br><span class="line">                st[i][j]=<span class="built_in">min</span>(st[i][j],st[i+(<span class="number">1</span>&lt;&lt;(j<span class="number">-1</span>))][j<span class="number">-1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">lca</span><span class="params">(<span class="type">int</span> t1,<span class="type">int</span> t2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(firpos[t1]&gt;firpos[t2]) <span class="built_in">swap</span>(t1,t2);</span><br><span class="line">    <span class="type">int</span> tt=lowb[firpos[t2]-firpos[t1]+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">return</span> anti[<span class="built_in">min</span>(st[firpos[t1]][tt],st[firpos[t2]-(<span class="number">1</span>&lt;&lt;tt)+<span class="number">1</span>][tt])];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">dis</span><span class="params">(<span class="type">int</span> t1,<span class="type">int</span> t2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> lcadep[t1]+lcadep[t2]<span class="number">-2</span>*lcadep[<span class="built_in">lca</span>(t1,t2)];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs1</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> fa)</span></span>&#123;</span><br><span class="line">    sz[x]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=head[x];i;i=nxt[i])&#123;</span><br><span class="line">        <span class="keyword">if</span>(ban[v[i]]||v[i]==fa) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfs1</span>(v[i],x);</span><br><span class="line">        sz[x]+=sz[v[i]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">getrt</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> fa,<span class="type">int</span> allsz)</span></span>&#123;</span><br><span class="line">    sz[x]=<span class="number">1</span>; mxsz[x]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=head[x];i;i=nxt[i])&#123;</span><br><span class="line">        <span class="keyword">if</span>(ban[v[i]]||v[i]==fa) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">getrt</span>(v[i],x,allsz);</span><br><span class="line">        sz[x]+=sz[v[i]];</span><br><span class="line">        mxsz[x]=<span class="built_in">max</span>(mxsz[x],sz[v[i]]);</span><br><span class="line">    &#125;</span><br><span class="line">    mxsz[x]=<span class="built_in">max</span>(mxsz[x],allsz-sz[x]);</span><br><span class="line">    <span class="keyword">if</span>(mxsz[rt]&gt;mxsz[x]) rt=x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">gettree</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    ban[x]=<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">dfs1</span>(x,<span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=head[x];i;i=nxt[i])&#123;</span><br><span class="line">        <span class="keyword">if</span>(ban[v[i]]) <span class="keyword">continue</span>;</span><br><span class="line">        rt=<span class="number">0</span>; <span class="built_in">getrt</span>(v[i],<span class="number">-1</span>,sz[v[i]]);</span><br><span class="line">        dad[rt]=x; dep[rt]=dep[x]+<span class="number">1</span>;</span><br><span class="line">        to[x].<span class="built_in">push_back</span>(rt);</span><br><span class="line">        <span class="built_in">gettree</span>(rt);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">getans</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> whi)</span></span>&#123;</span><br><span class="line">    h1[whi].<span class="built_in">push</span>(<span class="built_in">dis</span>(x,dad[whi]));</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>,tt=to[x].<span class="built_in">size</span>();i&lt;tt;++i)&#123;</span><br><span class="line">        <span class="built_in">getans</span>(to[x][i],whi);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(dad[x]!=<span class="number">-1</span>)&#123;</span><br><span class="line">        <span class="built_in">getans</span>(x,x);</span><br><span class="line">        h2[dad[x]].<span class="built_in">push</span>(h1[x].<span class="built_in">top</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    h2[x].<span class="built_in">push</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>,tt=to[x].<span class="built_in">size</span>();i&lt;tt;++i)&#123;</span><br><span class="line">        <span class="built_in">build</span>(to[x][i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(h2[x].<span class="built_in">size</span>()&gt;=<span class="number">2</span>) h3.<span class="built_in">push</span>(h2[x].<span class="built_in">top</span>()+h2[x].<span class="built_in">top2</span>());</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">upd</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> low=x;</span><br><span class="line">    <span class="keyword">if</span>(h2[x].<span class="built_in">size</span>()&gt;=<span class="number">2</span>) h3.<span class="built_in">erase</span>(h2[x].<span class="built_in">top</span>()+h2[x].<span class="built_in">top2</span>());</span><br><span class="line">    state[low]==<span class="number">1</span>?h2[x].<span class="built_in">push</span>(<span class="number">0</span>):h2[x].<span class="built_in">erase</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span>(h2[x].<span class="built_in">size</span>()&gt;=<span class="number">2</span>) h3.<span class="built_in">push</span>(h2[x].<span class="built_in">top</span>()+h2[x].<span class="built_in">top2</span>());</span><br><span class="line">    <span class="keyword">while</span>(dad[x]!=<span class="number">-1</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(h2[dad[x]].<span class="built_in">size</span>()&gt;=<span class="number">2</span>) h3.<span class="built_in">erase</span>(h2[dad[x]].<span class="built_in">top</span>()+h2[dad[x]].<span class="built_in">top2</span>());</span><br><span class="line">        <span class="keyword">if</span>(h1[x].<span class="built_in">size</span>()&gt;=<span class="number">1</span>) h2[dad[x]].<span class="built_in">erase</span>(h1[x].<span class="built_in">top</span>());</span><br><span class="line">        state[low]==<span class="number">1</span>?h1[x].<span class="built_in">push</span>(<span class="built_in">dis</span>(low,dad[x])):h1[x].<span class="built_in">erase</span>(<span class="built_in">dis</span>(low,dad[x]));</span><br><span class="line">        <span class="keyword">if</span>(h1[x].<span class="built_in">size</span>()&gt;=<span class="number">1</span>) h2[dad[x]].<span class="built_in">push</span>(h1[x].<span class="built_in">top</span>());</span><br><span class="line">        <span class="keyword">if</span>(h2[dad[x]].<span class="built_in">size</span>()&gt;=<span class="number">2</span>) h3.<span class="built_in">push</span>(h2[dad[x]].<span class="built_in">top</span>()+h2[dad[x]].<span class="built_in">top2</span>());</span><br><span class="line">        x=dad[x];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;1.txt&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;2.txt&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="type">int</span> t1,t2;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;++i)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;t1,&amp;t2);</span><br><span class="line">        <span class="built_in">add</span>(t1,t2);</span><br><span class="line">        <span class="built_in">add</span>(t2,t1);</span><br><span class="line">    &#125;</span><br><span class="line">    lcadep[<span class="number">1</span>]=<span class="number">0</span>; <span class="built_in">dfsou</span>(<span class="number">1</span>,<span class="number">-1</span>); <span class="built_in">Initst</span>();</span><br><span class="line">    rt=<span class="number">0</span>; mxsz[<span class="number">0</span>]=<span class="number">1e9</span>; <span class="built_in">getrt</span>(<span class="number">1</span>,<span class="number">-1</span>,n); root=rt;</span><br><span class="line">    dad[root]=<span class="number">-1</span>; dep[root]=<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">gettree</span>(root);</span><br><span class="line">    <span class="built_in">build</span>(root);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;q);</span><br><span class="line">    <span class="keyword">while</span>(q--)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,s+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span>(s[<span class="number">1</span>]==<span class="string">&#x27;G&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(numon==n) <span class="built_in">printf</span>(<span class="string">&quot;-1\n&quot;</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(numon==n<span class="number">-1</span>) <span class="built_in">printf</span>(<span class="string">&quot;0\n&quot;</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,h3.<span class="built_in">top</span>());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;t1);</span><br><span class="line">            <span class="keyword">if</span>(state[t1])&#123;</span><br><span class="line">                <span class="built_in">upd</span>(t1); --numon; state[t1]^=<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="built_in">upd</span>(t1); ++numon; state[t1]^=<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="公式">公式</h1>
<p>点到直线距离公式：</p>
<figure>
<img src="/1970/01/01/banzi/未命名图片_2.png" alt="未命名图片">
<figcaption aria-hidden="true">未命名图片</figcaption>
</figure>
<p>已知点$ (x_0,y_0) <span class="math inline">\(和 点\)</span>
(x_1,y_1)$，直线公式为: <span class="math display">\[
(y_0-y_1)x-(x_0-x_1)y+x_0y_1-x_1y_0=0
\]</span></p>
<p>直线方程 <span class="math inline">\(ax+by+c=0\)</span>
的垂直直线方程为：<span class="math inline">\(bx-ay+k=0\)</span></p>
<h1 id="极角排序">极角排序</h1>
<h2 id="interger">interger</h2>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 100006</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> dd double</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> ll mod=<span class="number">998244353</span>;</span><br><span class="line"><span class="function">ll <span class="title">qpow</span><span class="params">(ll x,ll y)</span></span>&#123;</span><br><span class="line">    ll res=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(y)&#123;</span><br><span class="line">        <span class="keyword">if</span>(y&amp;<span class="number">1</span>) res=res*x%mod;</span><br><span class="line">        y&gt;&gt;=<span class="number">1</span>; x=x*x%mod;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span>&#123;</span><br><span class="line">    ll x,y;</span><br><span class="line">    <span class="built_in">Node</span>()&#123;&#125;</span><br><span class="line">    <span class="built_in">Node</span>(ll t1,ll t2)&#123;x=t1;y=t2;&#125;</span><br><span class="line">    <span class="function">ll <span class="title">cross</span><span class="params">(<span class="type">const</span> Node &amp;c)</span> <span class="type">const</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x*c.y-y*c.x;</span><br><span class="line">    &#125;</span><br><span class="line">    Node <span class="keyword">operator</span> - (<span class="type">const</span> Node &amp;c) <span class="type">const</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Node</span>(x-c.x,y-c.y);</span><br><span class="line">    &#125;</span><br><span class="line">    Node <span class="keyword">operator</span> + (<span class="type">const</span> Node &amp;c) <span class="type">const</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Node</span>(x+c.x,y+c.y);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">calc</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(x&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(x==<span class="number">0</span>&amp;&amp;y&gt;<span class="number">0</span>) <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span> &lt; (<span class="type">const</span> Node &amp;c) <span class="type">const</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>-&gt;<span class="built_in">calc</span>()!=c.<span class="built_in">calc</span>()) <span class="keyword">return</span> <span class="keyword">this</span>-&gt;<span class="built_in">calc</span>()&lt;c.<span class="built_in">calc</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>-&gt;<span class="built_in">cross</span>(c)&gt;<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">ll <span class="title">dis2</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ll tx=x%mod,ty=y%mod;</span><br><span class="line">        <span class="keyword">return</span> (tx*tx%mod+ty*ty%mod)%mod;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;a[N],b[N];</span><br><span class="line"><span class="type">int</span> n,tot;</span><br><span class="line">ll pow2[N];</span><br><span class="line"><span class="function">ll <span class="title">cross</span><span class="params">(Node &amp;c1,Node &amp;c2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> c1.x*c2.y-c1.y*c2.x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">nxt</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    ++x; <span class="keyword">if</span>(x&gt;tot) x=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">pre</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    --x; <span class="keyword">if</span>(x&lt;<span class="number">1</span>) x=tot;</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">dis</span><span class="params">(<span class="type">int</span> st,<span class="type">int</span> en)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(st&lt;=en) <span class="keyword">return</span> en-st;</span><br><span class="line">    <span class="keyword">return</span> tot-st+en;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;1.txt&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;2.txt&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n); pow2[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;N;++i) pow2[i]=pow2[i<span class="number">-1</span>]*<span class="number">2ll</span>%mod;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i) <span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld&quot;</span>,&amp;a[i].x,&amp;a[i].y);</span><br><span class="line">    ll ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123;</span><br><span class="line">        tot=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=n;++j)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i==j) <span class="keyword">continue</span>;</span><br><span class="line">            b[++tot]=a[j]-a[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">sort</span>(b+<span class="number">1</span>,b+<span class="number">1</span>+tot);</span><br><span class="line">        <span class="type">int</span> now=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=tot;++j)&#123;</span><br><span class="line">            now=<span class="built_in">nxt</span>(now);</span><br><span class="line">            ll las=ans;</span><br><span class="line">            <span class="keyword">while</span>(now!=j&amp;&amp;<span class="built_in">cross</span>(b[j],b[now])&gt;<span class="number">0</span>) now=<span class="built_in">nxt</span>(now); now=<span class="built_in">pre</span>(now);</span><br><span class="line">            ans=(ans+b[j].<span class="built_in">dis2</span>()*((pow2[<span class="built_in">dis</span>(j,now)]+pow2[<span class="built_in">dis</span>(<span class="built_in">nxt</span>(now),j)]<span class="number">-2ll</span>+mod)%mod)%mod)%mod;</span><br><span class="line">            Node tmp=b[j]+a[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,(ans*<span class="built_in">qpow</span>(<span class="number">2</span>,mod<span class="number">-2</span>)%mod+mod)%mod);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="neko-and-quadrilateral"><a target="_blank" rel="noopener" href="http://acm.hdu.edu.cn/showproblem.php?pid=6538">Neko and
quadrilateral</a></h2>
<p>妙蛙</p>
<p>把所有点按x first key y sec key sort</p>
<p>点两两相连的向量进行极角排序，第一个向量对应的两个端点一定在排好序的点的序列里相邻，左右的点到向量的距离都是单调的，枚举到下一个时，只需要把向量端点在点的序列中的位置互换即可维护这个性质</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> dd double</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">2006</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> mod=<span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line"><span class="type">const</span> ll infll=<span class="number">1e18</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span>&#123;</span><br><span class="line">    ll x,y;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span> &lt; (Node c)&#123;<span class="keyword">if</span>(x==c.x)<span class="keyword">return</span> y&lt;c.y;<span class="keyword">return</span> x&lt;c.x;&#125;</span><br><span class="line">    Node <span class="keyword">operator</span> - (Node c)&#123;<span class="keyword">return</span> (Node)&#123;x-c.x,y-c.y&#125;;&#125;</span><br><span class="line">&#125;a[N];</span><br><span class="line"><span class="function">ll <span class="title">cross</span><span class="params">(Node c1,Node c2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> c1.x*c2.y-c1.y*c2.x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Vec</span>&#123;</span><br><span class="line">    <span class="type">int</span> v1,v2;</span><br><span class="line">    Node p;</span><br><span class="line">    <span class="built_in">Vec</span>()&#123;&#125;</span><br><span class="line">    <span class="built_in">Vec</span>(<span class="type">int</span> t1,<span class="type">int</span> t2,Node tt)&#123;v1=t1;v2=t2;p=tt;&#125;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span> &lt; (Vec c)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">cross</span>(<span class="keyword">this</span>-&gt;p,c.p)&gt;<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;v[((N*N)&gt;&gt;<span class="number">1</span>)+<span class="number">100</span>];</span><br><span class="line"><span class="function">ll <span class="title">dis</span><span class="params">(Node c,Node p1,Node p2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">abs</span>(<span class="built_in">cross</span>(p2-p1,c-p1));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp1</span><span class="params">(<span class="type">int</span> t1,<span class="type">int</span> t2)</span></span>&#123;<span class="keyword">return</span> a[t1]&lt;a[t2];&#125;</span><br><span class="line"><span class="type">int</span> n,pos[N],ind[N],tot;</span><br><span class="line">ll ansmn,ansmx;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">cmx</span><span class="params">(ll &amp;x,ll val)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;val) x=val;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">cmn</span><span class="params">(ll &amp;x,ll val)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x&gt;val) x=val;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;1.txt&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;2.txt&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n)!=EOF)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i) <span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld&quot;</span>,&amp;a[i].x,&amp;a[i].y),ind[i]=i;</span><br><span class="line">        <span class="keyword">if</span>(n&lt;<span class="number">4</span>)&#123;<span class="built_in">printf</span>(<span class="string">&quot;0 0\n&quot;</span>);<span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">        ansmn=infll; ansmx=-infll; tot=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">sort</span>(ind+<span class="number">1</span>,ind+<span class="number">1</span>+n,cmp1);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i) pos[ind[i]]=i;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=i+<span class="number">1</span>;j&lt;=n;++j)&#123;</span><br><span class="line">                v[++tot]=<span class="built_in">Vec</span>(ind[i],ind[j],a[ind[j]]-a[ind[i]]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">sort</span>(v+<span class="number">1</span>,v+<span class="number">1</span>+tot);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=tot;++i)&#123;</span><br><span class="line">            <span class="type">int</span> v1=v[i].v1,v2=v[i].v2;</span><br><span class="line">            <span class="keyword">if</span>(pos[v1]&gt;pos[v2]) <span class="built_in">swap</span>(v1,v2);</span><br><span class="line">            <span class="keyword">if</span>(pos[v1]&gt;<span class="number">1</span>&amp;&amp;pos[v2]&lt;n) <span class="built_in">cmn</span>(ansmn,<span class="built_in">dis</span>(a[ind[pos[v1]<span class="number">-1</span>]],a[v1],a[v2])+<span class="built_in">dis</span>(a[ind[pos[v2]+<span class="number">1</span>]],a[v1],a[v2]));</span><br><span class="line">            <span class="keyword">if</span>(pos[v1]&gt;<span class="number">1</span>&amp;&amp;pos[v2]&lt;n) <span class="built_in">cmx</span>(ansmx,<span class="built_in">dis</span>(a[ind[<span class="number">1</span>]],a[v1],a[v2])+<span class="built_in">dis</span>(a[ind[n]],a[v1],a[v2]));</span><br><span class="line">            <span class="built_in">swap</span>(pos[v1],pos[v2]); <span class="built_in">swap</span>(ind[pos[v1]],ind[pos[v2]]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld %lld\n&quot;</span>,ansmn,ansmx);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="d">3D</h1>
<h2 id="空间点绕线旋转公式">空间点绕线旋转公式</h2>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// unit vector</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">rota</span><span class="params">(dd lx,dd ly,dd lz,dd sx,dd sy,dd sz,dd the,dd &amp;resx,dd &amp;resy,dd &amp;resz)</span></span>&#123;</span><br><span class="line">    dd cthe=<span class="built_in">cos</span>(the),sthe=<span class="built_in">sin</span>(the);</span><br><span class="line">    resx=(lx*lx*(<span class="number">1.0</span>-cthe)+cthe)*sx+(lx*ly*(<span class="number">1.0</span>-cthe)-lz*sthe)*sy+(lx*lz*(<span class="number">1.0</span>-cthe)+ly*sthe)*sz;</span><br><span class="line">    resy=(lx*ly*(<span class="number">1.0</span>-cthe)+lz*sthe)*sx+(ly*ly*(<span class="number">1.0</span>-cthe)+cthe)*sy+(ly*lz*(<span class="number">1.0</span>-cthe)-lx*sthe)*sz;</span><br><span class="line">    resz=(lx*lz*(<span class="number">1.0</span>-cthe)-ly*sthe)*sx+(ly*lz*(<span class="number">1.0</span>-cthe)+lx*sthe)*sy+(lz*lz*(<span class="number">1.0</span>-cthe)+cthe)*sz;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="圆之间相交">圆之间相交</h1>
<h2 id="square-card"><a target="_blank" rel="noopener" href="https://acm.hdu.edu.cn/showproblem.php?pid=7063">Square
Card</a></h2>
<p>两个圆相交 的经典问题，判断一下</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 100006</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> X 19260817</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod 1000000009</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> dd double</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> T,tx[<span class="number">2</span>],ty[<span class="number">2</span>],tr[<span class="number">2</span>],a;</span><br><span class="line"><span class="type">const</span> dd PI=<span class="built_in">asin</span>(<span class="number">1.0</span>)*<span class="number">2.0</span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;1.txt&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;2.txt&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    dd t1,r1,r2,t2,d;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;T);</span><br><span class="line">    <span class="keyword">while</span>(T--)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d%d%d%d%d&quot;</span>,&amp;tr[<span class="number">0</span>],&amp;tx[<span class="number">0</span>],&amp;ty[<span class="number">0</span>],&amp;tr[<span class="number">1</span>],&amp;tx[<span class="number">1</span>],&amp;ty[<span class="number">1</span>],&amp;a);</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">sqrt</span>(<span class="number">2.0</span>)*tr[<span class="number">0</span>]&lt;a||<span class="built_in">sqrt</span>(<span class="number">2.0</span>)*tr[<span class="number">1</span>]&lt;a)&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;0.000000\n&quot;</span>);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        r1=<span class="built_in">sqrt</span>(tr[<span class="number">0</span>]*tr[<span class="number">0</span>]-a*a/<span class="number">4.0</span>)-a/<span class="number">2.0</span>;</span><br><span class="line">        r2=<span class="built_in">sqrt</span>(tr[<span class="number">1</span>]*tr[<span class="number">1</span>]-a*a/<span class="number">4.0</span>)-a/<span class="number">2.0</span>;</span><br><span class="line">        <span class="keyword">if</span>(r1&lt;=<span class="number">0</span>||r2&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;0.000000\n&quot;</span>);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        d=<span class="built_in">sqrt</span>((dd)(tx[<span class="number">0</span>]-tx[<span class="number">1</span>])*(tx[<span class="number">0</span>]-tx[<span class="number">1</span>])+(dd)(ty[<span class="number">0</span>]-ty[<span class="number">1</span>])*(ty[<span class="number">0</span>]-ty[<span class="number">1</span>]));</span><br><span class="line">        <span class="keyword">if</span>(r1+r2&lt;=d)&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;0.000000\n&quot;</span>);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(r1&gt;=r2+d)&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%.6f\n&quot;</span>,r2*r2/r1/r1);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(r2&gt;=r1+d)&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;1.000000\n&quot;</span>);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        dd c1=<span class="built_in">acos</span>((r1*r1+d*d-r2*r2)/<span class="number">2.0</span>/r1/d);</span><br><span class="line">        dd c2=<span class="built_in">acos</span>((r2*r2+d*d-r1*r1)/<span class="number">2.0</span>/r2/d);</span><br><span class="line">        dd ans=c1*r1*r1+c2*r2*r2-r1*r1*<span class="built_in">sin</span>(c1)*<span class="built_in">cos</span>(c1)-r2*r2*<span class="built_in">sin</span>(c2)*<span class="built_in">cos</span>(c2);</span><br><span class="line">        ans=ans/PI/r1/r1;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%.6f\n&quot;</span>,ans);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="凸包">凸包</h1>
<h2 id="smzzl-with-safe-zone"><a target="_blank" rel="noopener" href="https://acm.hdu.edu.cn/showproblem.php?pid=7052">Smzzl with Safe
Zone</a></h2>
<p>答案一定是外面的环的端点到里面的环的最短距离的最大值</p>
<p>考虑旋转卡壳的思想<span class="math inline">\(O(n)\)</span>做</p>
<p>使用叉积计算点到两个点直线之间的距离</p>
<p>使用点积判断两个点与一个点到两个点连接直线的垂点的相对位置</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 200006</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> dd double</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ld long double</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod 1000000007</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">read</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ll ans = <span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>(), last = <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">    <span class="keyword">while</span>(!<span class="built_in">isdigit</span>(ch)) last = ch, ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">isdigit</span>(ch)) ans = (ans &lt;&lt; <span class="number">1</span>) + (ans &lt;&lt; <span class="number">3</span>) + ch - <span class="string">&#x27;0&#x27;</span>, ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">if</span>(last == <span class="string">&#x27;-&#x27;</span>) ans = -ans;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(ll x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x &lt; <span class="number">0</span>) x = -x, <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(x &gt;= <span class="number">10</span>) <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(x % <span class="number">10</span> + <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">qpow</span><span class="params">(ll x,ll y)</span></span>&#123;</span><br><span class="line">    ll ans=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(y)&#123;</span><br><span class="line">        <span class="keyword">if</span>(y&amp;<span class="number">1</span>)&#123;</span><br><span class="line">            ans=ans*x%Mod;</span><br><span class="line">        &#125;</span><br><span class="line">        x=x*x%Mod;</span><br><span class="line">        y&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span>&#123;</span><br><span class="line">    ll x,y;</span><br><span class="line">    <span class="built_in">Node</span>()&#123;&#125;</span><br><span class="line">    <span class="built_in">Node</span>(ll tx,ll ty)&#123;</span><br><span class="line">        x=tx; y=ty;</span><br><span class="line">    &#125;</span><br><span class="line">    Node <span class="keyword">operator</span> - (<span class="type">const</span> Node &amp;c) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Node</span>(x-c.x,y-c.y);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">ll <span class="title">modll</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x*x+y*y;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">ld <span class="title">modld</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sqrtl</span>((ld)x*x+(ld)y*y);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;sa[N],ma[N];</span><br><span class="line"><span class="function">ll <span class="title">cross</span><span class="params">(Node &amp;t1,Node &amp;t2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> t1.x*t2.y-t1.y*t2.x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">mul</span><span class="params">(Node &amp;t1,Node &amp;t2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> t1.x*t2.x+t1.y*t2.y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> T,n,m;</span><br><span class="line"><span class="function">ld <span class="title">calcdis</span><span class="params">(Node &amp;tt,Node &amp;c1,Node &amp;c2)</span></span>&#123;</span><br><span class="line">    Node u,v;</span><br><span class="line">    u=c2-c1; v=tt-c1;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">mul</span>(u,v)&lt;<span class="number">0</span>||<span class="built_in">mul</span>(u,v)&gt;u.<span class="built_in">modll</span>())&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">min</span>((tt-c1).<span class="built_in">modld</span>(),(tt-c2).<span class="built_in">modld</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">fabsl</span>(<span class="built_in">cross</span>(u,v)/u.<span class="built_in">modld</span>());</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">calcdismod</span><span class="params">(Node &amp;tt,Node &amp;c1,Node &amp;c2)</span></span>&#123;</span><br><span class="line">    Node u,v;</span><br><span class="line">    u=c2-c1; v=tt-c1;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">mul</span>(u,v)&lt;<span class="number">0</span>||<span class="built_in">mul</span>(u,v)&gt;u.<span class="built_in">modll</span>())&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">min</span>((tt-c1).<span class="built_in">modll</span>(),(tt-c2).<span class="built_in">modll</span>())%Mod;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">cross</span>(u,v)%Mod)*(<span class="built_in">cross</span>(u,v)%Mod)%Mod*<span class="built_in">qpow</span>(u.<span class="built_in">modll</span>()%Mod,Mod<span class="number">-2</span>)%Mod;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">nxt</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> m)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (x+<span class="number">1</span>)%m;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">getAns</span><span class="params">(Node * safe,<span class="type">int</span> m,Node * mapp,<span class="type">int</span> n)</span></span>&#123;</span><br><span class="line">    ld mn=<span class="number">1e18</span>+<span class="number">2.0</span>; <span class="type">int</span> pos=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;m;++i)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">calcdis</span>(mapp[<span class="number">0</span>],safe[i],safe[<span class="built_in">nxt</span>(i,m)])&lt;mn)&#123;</span><br><span class="line">            mn=<span class="built_in">calcdis</span>(mapp[<span class="number">0</span>],safe[i],safe[<span class="built_in">nxt</span>(i,m)]);</span><br><span class="line">            pos=i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ld mx=<span class="number">-1e18</span><span class="number">-2.0</span>; ll res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;++i)&#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="built_in">calcdis</span>(mapp[i],safe[pos],safe[<span class="built_in">nxt</span>(pos,m)])&gt;<span class="built_in">calcdis</span>(mapp[i],safe[<span class="built_in">nxt</span>(pos,m)],safe[<span class="built_in">nxt</span>(<span class="built_in">nxt</span>(pos,m),m)]))&#123;</span><br><span class="line">            pos=<span class="built_in">nxt</span>(pos,m);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(mx&lt;<span class="built_in">calcdis</span>(mapp[i],safe[pos],safe[<span class="built_in">nxt</span>(pos,m)]))&#123;</span><br><span class="line">            mx=<span class="built_in">calcdis</span>(mapp[i],safe[pos],safe[<span class="built_in">nxt</span>(pos,m)]);</span><br><span class="line">            res=<span class="built_in">calcdismod</span>(mapp[i],safe[pos],safe[<span class="built_in">nxt</span>(pos,m)]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;1.txt&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;2.txt&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    T=<span class="built_in">read</span>();</span><br><span class="line">    <span class="keyword">while</span>(T--)&#123;</span><br><span class="line">        m=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;m;++i)&#123;</span><br><span class="line">            sa[i].x=<span class="built_in">read</span>(); sa[i].y=<span class="built_in">read</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        n=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;++i)&#123;</span><br><span class="line">            ma[i].x=<span class="built_in">read</span>(); ma[i].y=<span class="built_in">read</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,<span class="built_in">getAns</span>(sa,m,ma,n));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="beauty-contest-poj---2187"><a target="_blank" rel="noopener" href="https://vjudge.net/problem/POJ-2187">Beauty Contest POJ -
2187</a></h2>
<p>求凸包和旋转卡壳</p>
<p>板子</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 50006</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> dd double</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod 1000000007</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span>&#123;</span><br><span class="line">    <span class="type">int</span> x,y;</span><br><span class="line">    <span class="built_in">Node</span>()&#123;&#125;</span><br><span class="line">    <span class="built_in">Node</span>(<span class="type">int</span> tx,<span class="type">int</span> ty)&#123;</span><br><span class="line">        x=tx; y=ty;</span><br><span class="line">    &#125;</span><br><span class="line">    Node <span class="keyword">operator</span> - (<span class="type">const</span> Node &amp;c) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Node</span>(x-c.x,y-c.y);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="keyword">operator</span> * (<span class="type">const</span> Node &amp;c) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> x*c.y-y*c.x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;p[N],ch[N];</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp1</span><span class="params">(Node &amp;t1,Node &amp;t2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> t1.x&lt;t2.x||(t1.x==t2.x&amp;&amp;t1.y&lt;t2.y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> n,m;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">getHull</span><span class="params">(Node * fr,Node * to,<span class="type">int</span> n,<span class="type">int</span> &amp;m)</span></span>&#123;</span><br><span class="line">    <span class="built_in">sort</span>(fr+<span class="number">1</span>,fr+<span class="number">1</span>+n,cmp1);</span><br><span class="line">    m=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123;</span><br><span class="line">        <span class="keyword">while</span>(m&gt;<span class="number">1</span>&amp;&amp;(to[m<span class="number">-1</span>]-to[m<span class="number">-2</span>])*(fr[i]-to[m<span class="number">-2</span>])&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">            --m;</span><br><span class="line">        &#125;</span><br><span class="line">        to[m++]=fr[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> k=m;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=n<span class="number">-1</span>;i&gt;<span class="number">0</span>;--i)&#123;</span><br><span class="line">        <span class="keyword">while</span>(m&gt;k&amp;&amp;(to[m<span class="number">-1</span>]-to[m<span class="number">-2</span>])*(fr[i]-to[m<span class="number">-2</span>])&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">            --m;</span><br><span class="line">        &#125;</span><br><span class="line">        to[m++]=fr[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(n&gt;<span class="number">1</span>) --m;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">dis</span><span class="params">(Node &amp;t1,Node &amp;t2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (t1.x-t2.x)*(t1.x-t2.x)+(t1.y-t2.y)*(t1.y-t2.y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getAns</span><span class="params">(Node * ch,<span class="type">int</span> m)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> now=<span class="number">1</span>,res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;m;++i)&#123;</span><br><span class="line">        <span class="keyword">while</span>((ch[(i+<span class="number">1</span>)%m]-ch[i])*(ch[now]-ch[i])&lt;(ch[(i+<span class="number">1</span>)%m]-ch[i])*(ch[(now+<span class="number">1</span>)%m]-ch[i]))&#123;</span><br><span class="line">            now=(now+<span class="number">1</span>)%m;</span><br><span class="line">        &#125;</span><br><span class="line">        res=<span class="built_in">max</span>(res,<span class="built_in">max</span>(<span class="built_in">dis</span>(ch[i],ch[now]),<span class="built_in">dis</span>(ch[(i+<span class="number">1</span>)%m],ch[now])));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;1.txt&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;2.txt&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;p[i].x,&amp;p[i].y);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">getHull</span>(p,ch,n,m);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">getAns</span>(ch,m));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="一些题">一些题</h1>
<h2 id="c---empty-convex-polygons"><a target="_blank" rel="noopener" href="https://vjudge.net/problem/HDU-6219">C - Empty Convex
Polygons</a></h2>
<p><span class="math inline">\(dp_{i,j}\)</span> 表示最后两条边为<span class="math inline">\(Oi\)</span>和<span class="math inline">\(ij\)</span>且<span class="math inline">\(Oi\)</span>之间没有点的最大面积（不包括<span class="math inline">\(j\)</span>之前的点）</p>
<p><span class="math inline">\(g_{i,j}\)</span> 表示最后两条边为<span class="math inline">\(Oi\)</span>和<span class="math inline">\(ij\)</span>且<span class="math inline">\(Oi\)</span>之间没有点的最大面积（包括<span class="math inline">\(j\)</span>之前的点）</p>
<p>从左到右枚举答案多边形的最左边端点，极角排序其右边端点之后从小到大枚举，每次找i之前最大的不在<span class="math inline">\(Oi\)</span>上的点<span class="math inline">\(j\)</span>，再找<span class="math inline">\(j\)</span>之前最大的满足<span class="math inline">\(ijk\)</span>为凸的<span class="math inline">\(k\)</span>，dp即可</p>
<p><span class="math inline">\(O(n^3)\)</span></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 106</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> mod=<span class="number">998244353</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span>&#123;</span><br><span class="line">    ll x,y;</span><br><span class="line">    Node <span class="keyword">operator</span> - (Node c)&#123;</span><br><span class="line">        <span class="keyword">return</span> (Node)&#123;x-c.x,y-c.y&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    Node <span class="keyword">operator</span> + (Node c)&#123;</span><br><span class="line">        <span class="keyword">return</span> (Node)&#123;x+c.x,y+c.y&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">ll <span class="title">cross</span><span class="params">(Node c1,Node c2)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> c1.x*c2.y-c1.y*c2.x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">whe</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(x&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(x==<span class="number">0</span>&amp;&amp;y&gt;<span class="number">0</span>) <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">ll <span class="title">dis</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x*x+y*y;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span> &lt; (Node c)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>-&gt;<span class="built_in">whe</span>()==c.<span class="built_in">whe</span>())&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">cross</span>(*<span class="keyword">this</span>,c)==<span class="number">0</span>) <span class="keyword">return</span> <span class="keyword">this</span>-&gt;<span class="built_in">dis</span>()&lt;c.<span class="built_in">dis</span>();</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">cross</span>(*<span class="keyword">this</span>,c)&gt;<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>-&gt;<span class="built_in">whe</span>()&lt;c.<span class="built_in">whe</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;a[N],b[N];</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp1</span><span class="params">(Node n1,Node n2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(n1.x==n2.x) <span class="keyword">return</span> n1.y&lt;n2.y;</span><br><span class="line">    <span class="keyword">return</span> n1.x&lt;n2.x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">cross</span><span class="params">(Node c1,Node c2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> c1.x*c2.y-c1.y*c2.x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> T,n,tot,pre[N];</span><br><span class="line">ll ans,dp[N][N],g[N][N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;1.txt&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;2.txt&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;T);</span><br><span class="line">    <span class="keyword">while</span>(T--)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n); ans=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i) <span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld&quot;</span>,&amp;a[i].x,&amp;a[i].y);</span><br><span class="line">        <span class="built_in">sort</span>(a+<span class="number">1</span>,a+<span class="number">1</span>+n,cmp1);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123;</span><br><span class="line">            tot=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=i+<span class="number">1</span>;j&lt;=n;++j) b[++tot]=a[j]-a[i];</span><br><span class="line">            <span class="built_in">sort</span>(b+<span class="number">1</span>,b+<span class="number">1</span>+tot);</span><br><span class="line">            Node qw;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=tot;++j) <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">1</span>;k&lt;=tot;++k) dp[j][k]=g[j][k]=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">2</span>;j&lt;=tot;++j)&#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="built_in">cross</span>(b[j],b[j<span class="number">-1</span>])==<span class="number">0</span>) pre[j]=pre[j<span class="number">-1</span>];</span><br><span class="line">                <span class="keyword">else</span> pre[j]=j<span class="number">-1</span>;</span><br><span class="line">                <span class="type">int</span> k=pre[j],nx;</span><br><span class="line">                <span class="keyword">while</span>(k)&#123;</span><br><span class="line">                    ans=<span class="built_in">max</span>(ans,<span class="built_in">abs</span>(<span class="built_in">cross</span>(b[j],b[k])));</span><br><span class="line">                    <span class="keyword">if</span>(pre[j]==j<span class="number">-1</span>&amp;&amp;k) dp[j][k]=<span class="built_in">max</span>(dp[j][k],<span class="built_in">abs</span>(<span class="built_in">cross</span>(b[k],b[j])));</span><br><span class="line">                    <span class="keyword">while</span>(k&gt;<span class="number">1</span>&amp;&amp;<span class="built_in">cross</span>(b[k],b[k<span class="number">-1</span>])==<span class="number">0</span>)&#123;</span><br><span class="line">                        --k;</span><br><span class="line">                        dp[j][k]=<span class="built_in">max</span>(dp[j][k],<span class="built_in">abs</span>(<span class="built_in">cross</span>(b[k],b[j])));</span><br><span class="line">                    &#125;</span><br><span class="line">                    nx=k<span class="number">-1</span>;</span><br><span class="line">                    <span class="keyword">while</span>(nx&amp;&amp;<span class="built_in">cross</span>(b[k]-b[j],b[nx]-b[k])&gt;<span class="number">0</span>) --nx;</span><br><span class="line">                    <span class="keyword">if</span>(nx)&#123;</span><br><span class="line">                        dp[j][k]=<span class="built_in">max</span>(dp[j][k],<span class="built_in">abs</span>(<span class="built_in">cross</span>(b[j],b[k]))+g[k][nx]);</span><br><span class="line">                        ans=<span class="built_in">max</span>(ans,dp[j][k]);</span><br><span class="line">                    &#125;</span><br><span class="line">                    k=nx;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">for</span>(k=<span class="number">1</span>;k&lt;j;++k) g[j][k]=<span class="built_in">max</span>(g[j][k<span class="number">-1</span>],dp[j][k]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%.1lf\n&quot;</span>,ans/<span class="number">2.0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="半平面交">半平面交</h1>
<h2 id="uyuws-concert"><a target="_blank" rel="noopener" href="http://poj.org/problem?id=2451">Uyuw’s
Concert</a></h2>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> dd double</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 20006</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> mod=<span class="number">998244353</span>;</span><br><span class="line"><span class="type">const</span> dd eps=<span class="number">1e-7</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span>&#123;dd x,y;&#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Line</span>&#123;Node p,v;&#125;a[N];</span><br><span class="line">Node <span class="keyword">operator</span> + (Node n1,Node n2)&#123;<span class="keyword">return</span> (Node)&#123;n1.x+n2.x,n1.y+n2.y&#125;;&#125;</span><br><span class="line">Node <span class="keyword">operator</span> - (Node n1,Node n2)&#123;<span class="keyword">return</span> (Node)&#123;n1.x-n2.x,n1.y-n2.y&#125;;&#125;</span><br><span class="line">dd <span class="keyword">operator</span> * (Node n1,Node n2)&#123;<span class="keyword">return</span> n1.x*n2.y-n1.y*n2.x;&#125;</span><br><span class="line">Node <span class="keyword">operator</span> * (Node n1,dd c)&#123;<span class="keyword">return</span> (Node)&#123;n1.x*c,n1.y*c&#125;;&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span><span class="params">(Line l1,Line l2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">atan2</span>(l1.v.y,l1.v.x)&lt;<span class="built_in">atan2</span>(l2.v.y,l2.v.x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">right</span><span class="params">(Line l1,Node n1)</span></span>&#123;<span class="keyword">return</span> l1.v*(n1-l1.p)&lt;<span class="number">0</span>;&#125;</span><br><span class="line"><span class="function">Node <span class="title">xp</span><span class="params">(Line l1,Line l2)</span></span>&#123;<span class="keyword">return</span> l1.p+l1.v*(l2.v*(l1.p-l2.p)/(l1.v*l2.v));&#125;</span><br><span class="line"><span class="type">int</span> n,sta[N&lt;&lt;<span class="number">1</span>],he,en,tot,totc;</span><br><span class="line">Node b[N],c[N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;1.txt&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;2.txt&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123;</span><br><span class="line">        dd t1,t2,t3,t4;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%lf%lf%lf%lf&quot;</span>,&amp;t1,&amp;t2,&amp;t3,&amp;t4);</span><br><span class="line">        a[i]=(Line)&#123;(Node)&#123;t1,t2&#125;,(Node)&#123;t3-t1,t4-t2&#125;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    a[n+<span class="number">1</span>]=(Line)&#123;(Node)&#123;<span class="number">0</span>,<span class="number">0</span>&#125;,(Node)&#123;<span class="number">10000</span>,<span class="number">0</span>&#125;&#125;;</span><br><span class="line">    a[n+<span class="number">2</span>]=(Line)&#123;(Node)&#123;<span class="number">10000</span>,<span class="number">0</span>&#125;,(Node)&#123;<span class="number">0</span>,<span class="number">10000</span>&#125;&#125;;</span><br><span class="line">    a[n+<span class="number">3</span>]=(Line)&#123;(Node)&#123;<span class="number">10000</span>,<span class="number">10000</span>&#125;,(Node)&#123;<span class="number">-10000</span>,<span class="number">0</span>&#125;&#125;;</span><br><span class="line">    a[n+<span class="number">4</span>]=(Line)&#123;(Node)&#123;<span class="number">0</span>,<span class="number">10000</span>&#125;,(Node)&#123;<span class="number">0</span>,<span class="number">-10000</span>&#125;&#125;;</span><br><span class="line">    n+=<span class="number">4</span>;</span><br><span class="line">    <span class="built_in">sort</span>(a+<span class="number">1</span>,a+<span class="number">1</span>+n,cmp); he=<span class="number">1</span>; en=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123;</span><br><span class="line">        <span class="keyword">while</span>(en&gt;he&amp;&amp;<span class="built_in">right</span>(a[i],<span class="built_in">xp</span>(a[sta[en]],a[sta[en<span class="number">-1</span>]]))) --en;</span><br><span class="line">        <span class="keyword">while</span>(en&gt;he&amp;&amp;<span class="built_in">right</span>(a[i],<span class="built_in">xp</span>(a[sta[he]],a[sta[he+<span class="number">1</span>]]))) ++he;</span><br><span class="line">        sta[++en]=i;</span><br><span class="line">        <span class="keyword">if</span>(en&gt;he&amp;&amp;<span class="built_in">fabs</span>(a[sta[en<span class="number">-1</span>]].v*a[sta[en]].v)&lt;eps) --en;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(en&gt;he&amp;&amp;<span class="built_in">right</span>(a[sta[he]],<span class="built_in">xp</span>(a[sta[en]],a[sta[en<span class="number">-1</span>]]))) --en;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=he;i&lt;en;++i) b[++tot]=<span class="built_in">xp</span>(a[sta[i]],a[sta[i+<span class="number">1</span>]]);</span><br><span class="line">    b[++tot]=<span class="built_in">xp</span>(a[sta[he]],a[sta[en]]);</span><br><span class="line">    dd ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;tot;++i) ans+=<span class="built_in">fabs</span>((b[i]-b[<span class="number">1</span>])*(b[i+<span class="number">1</span>]-b[<span class="number">1</span>]));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.1f\n&quot;</span>,ans/<span class="number">2.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="p4196-cqoi2006凸多边形-模板半平面交"><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4196">P4196 [CQOI2006]凸多边形
/【模板】半平面交</a></h2>
<p>特殊处理平行的线</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;cmath&gt;</span><br><span class="line">#include &lt;cstdio&gt;</span><br><span class="line">#include &lt;algorithm&gt;</span><br><span class="line">#define ll long long</span><br><span class="line">#define dd double</span><br><span class="line">#define N 20006</span><br><span class="line">using namespace std;</span><br><span class="line">const int mod=998244353;</span><br><span class="line">const dd eps=1e-10;</span><br><span class="line">struct Node&#123;dd x,y;&#125;;</span><br><span class="line">struct Line&#123;Node p,v;&#125;a[N];</span><br><span class="line">Node operator + (Node n1,Node n2)&#123;return (Node)&#123;n1.x+n2.x,n1.y+n2.y&#125;;&#125;</span><br><span class="line">Node operator - (Node n1,Node n2)&#123;return (Node)&#123;n1.x-n2.x,n1.y-n2.y&#125;;&#125;</span><br><span class="line">dd operator * (Node n1,Node n2)&#123;return n1.x*n2.y-n1.y*n2.x;&#125;</span><br><span class="line">Node operator * (Node n1,dd c)&#123;return (Node)&#123;n1.x*c,n1.y*c&#125;;&#125;</span><br><span class="line">bool cmp(Line l1,Line l2)&#123;</span><br><span class="line">    return atan2(l1.v.y,l1.v.x)&lt;atan2(l2.v.y,l2.v.x);</span><br><span class="line">&#125;</span><br><span class="line">bool rightoreq(Line l1,Node n1)&#123;return l1.v*(n1-l1.p)&lt;eps;&#125;</span><br><span class="line">Node xp(Line l1,Line l2)&#123;return l1.p+l1.v*(l2.v*(l1.p-l2.p)/(l1.v*l2.v));&#125;</span><br><span class="line">int n,T,sta[N&lt;&lt;1],he,en,tot,totc;</span><br><span class="line">Node b[N],c[N],d[N];</span><br><span class="line">int main()&#123;</span><br><span class="line">    // freopen(&quot;1.txt&quot;,&quot;r&quot;,stdin);</span><br><span class="line">    // freopen(&quot;2.txt&quot;,&quot;w&quot;,stdout);</span><br><span class="line">    scanf(&quot;%d&quot;,&amp;T);</span><br><span class="line">    for(int i=1;i&lt;=T;++i)&#123;</span><br><span class="line">        int opt;</span><br><span class="line">        scanf(&quot;%d&quot;,&amp;opt);</span><br><span class="line">        for(int j=1;j&lt;=opt;++j) scanf(&quot;%lf%lf&quot;,&amp;d[j].x,&amp;d[j].y);</span><br><span class="line">        for(int j=1;j&lt;opt;++j) a[++n]=(Line)&#123;d[j],d[j+1]-d[j]&#125;;</span><br><span class="line">        a[++n]=(Line)&#123;d[opt],d[1]-d[opt]&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    sort(a+1,a+1+n,cmp); he=1; en=0;</span><br><span class="line">    for(int i=1;i&lt;=n;++i)&#123;</span><br><span class="line">        while(en&gt;he&amp;&amp;rightoreq(a[i],xp(a[sta[en]],a[sta[en-1]]))) --en;</span><br><span class="line">        while(en&gt;he&amp;&amp;rightoreq(a[i],xp(a[sta[he]],a[sta[he+1]]))) ++he;</span><br><span class="line">        sta[++en]=i;</span><br><span class="line">        if(en&gt;he&amp;&amp;fabs(a[sta[en-1]].v*a[sta[en]].v)&lt;eps)&#123;</span><br><span class="line">            if((a[sta[en]].p-a[sta[en-1]].p)*a[sta[en]].v&lt;eps) sta[en-1]=sta[en];</span><br><span class="line">            --en;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    while(en&gt;he&amp;&amp;rightoreq(a[sta[he]],xp(a[sta[en]],a[sta[en-1]]))) --en;</span><br><span class="line">    for(int i=he;i&lt;en;++i) b[++tot]=xp(a[sta[i]],a[sta[i+1]]);</span><br><span class="line">    b[++tot]=xp(a[sta[he]],a[sta[en]]);</span><br><span class="line">    dd ans=0;</span><br><span class="line">    for(int i=2;i&lt;tot;++i) ans+=fabs((b[i]-b[1])*(b[i+1]-b[1]));</span><br><span class="line">    printf(&quot;%.3f\n&quot;,ans/2.0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="三维凸包">三维凸包</h1>
<h2 id="p4724-模板三维凸包"><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4724">P4724
【模板】三维凸包</a></h2>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> dd double</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 2006</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> mod=<span class="number">998244353</span>;</span><br><span class="line"><span class="type">const</span> dd eps=<span class="number">1e-9</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span>&#123;dd x,y,z;&#125;a[N];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Face</span>&#123;<span class="type">int</span> v[<span class="number">3</span>];&#125;f[N],t[N];</span><br><span class="line">Node <span class="keyword">operator</span> + (Node n1,Node n2)&#123;<span class="keyword">return</span> (Node)&#123;n1.x+n2.x,n1.y+n2.y,n1.z+n2.z&#125;;&#125;</span><br><span class="line">Node <span class="keyword">operator</span> - (Node n1,Node n2)&#123;<span class="keyword">return</span> (Node)&#123;n1.x-n2.x,n1.y-n2.y,n1.z-n2.z&#125;;&#125;</span><br><span class="line">Node <span class="keyword">operator</span> * (Node n1,Node n2)&#123;<span class="keyword">return</span> (Node)&#123;n1.y*n2.z-n1.z*n2.y,n1.z*n2.x-n1.x*n2.z,n1.x*n2.y-n1.y*n2.x&#125;;&#125;</span><br><span class="line"><span class="type">double</span> <span class="keyword">operator</span> &amp; (Node n1,Node n2)&#123;<span class="keyword">return</span> n1.x*n2.x+n1.y*n2.y+n1.z*n2.z;&#125;</span><br><span class="line"><span class="function">Node <span class="title">Normal</span><span class="params">(Face ff)</span></span>&#123;<span class="keyword">return</span> (a[ff.v[<span class="number">1</span>]]-a[ff.v[<span class="number">0</span>]])*(a[ff.v[<span class="number">2</span>]]-a[ff.v[<span class="number">0</span>]]);&#125;</span><br><span class="line"><span class="function">dd <span class="title">len</span><span class="params">(Node n1)</span></span>&#123;<span class="keyword">return</span> <span class="built_in">sqrt</span>(n1.x*n1.x+n1.y*n1.y+n1.z*n1.z);&#125;</span><br><span class="line"><span class="function">dd <span class="title">area</span><span class="params">(Face ff)</span></span>&#123;<span class="keyword">return</span> <span class="built_in">len</span>(<span class="built_in">Normal</span>(ff))/<span class="number">2.0</span>;&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">see</span><span class="params">(Face ff,Node n1)</span></span>&#123;<span class="keyword">return</span> ((n1-a[ff.v[<span class="number">0</span>]])&amp;<span class="built_in">Normal</span>(ff))&gt;<span class="number">0</span>;&#125;</span><br><span class="line"><span class="type">int</span> n,tot,tott,vis[N][N];</span><br><span class="line">dd ans;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">convec</span><span class="params">()</span></span>&#123;</span><br><span class="line">    f[++tot]=(Face)&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line">    f[++tot]=(Face)&#123;<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">4</span>;i&lt;=n;++i)&#123;</span><br><span class="line">        tott=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>,fl;j&lt;=tot;++j)&#123;</span><br><span class="line">            <span class="keyword">if</span>(!(fl=<span class="built_in">see</span>(f[j],a[i]))) t[++tott]=f[j];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;<span class="number">3</span>;++k) vis[f[j].v[k]][f[j].v[(k+<span class="number">1</span>)%<span class="number">3</span>]]=fl;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=tot;++j)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;<span class="number">3</span>;++k)&#123;</span><br><span class="line">                <span class="type">int</span> t1=f[j].v[k],t2=f[j].v[(k+<span class="number">1</span>)%<span class="number">3</span>];</span><br><span class="line">                <span class="keyword">if</span>(vis[t1][t2]&amp;&amp;!vis[t2][t1]) t[++tott]=(Face)&#123;t1,t2,i&#125;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=tott;++j) f[j]=t[j];</span><br><span class="line">        tot=tott;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;1.txt&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;2.txt&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i) <span class="built_in">scanf</span>(<span class="string">&quot;%lf%lf%lf&quot;</span>,&amp;a[i].x,&amp;a[i].y,&amp;a[i].z);</span><br><span class="line">    <span class="built_in">convec</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=tot;++i) ans+=<span class="built_in">area</span>(f[i]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.3f\n&quot;</span>,ans);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="kd-tree">KD-TREE</h1>
<h2 id="in-case-of-failure"><a target="_blank" rel="noopener" href="https://acm.hdu.edu.cn/showproblem.php?pid=2966">In case of
failure</a></h2>
<p>KD树板子</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 100005</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod 998244353</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">read</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ll ans = <span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch = <span class="built_in">getchar</span>(), last = <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">    <span class="keyword">while</span>(!<span class="built_in">isdigit</span>(ch)) last = ch, ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">isdigit</span>(ch)) ans = (ans &lt;&lt; <span class="number">1</span>) + (ans &lt;&lt; <span class="number">3</span>) + ch - <span class="string">&#x27;0&#x27;</span>, ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">if</span>(last == <span class="string">&#x27;-&#x27;</span>) ans = -ans;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(ll x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x &lt; <span class="number">0</span>) x = -x, <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(x &gt;= <span class="number">10</span>) <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(x % <span class="number">10</span> + <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> dim;</span><br><span class="line"><span class="type">int</span> T,n;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span>&#123;</span><br><span class="line">    <span class="type">int</span> id;</span><br><span class="line">    ll d[<span class="number">2</span>];</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span> &lt; (<span class="type">const</span> Node &amp;c) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> d[dim]&lt;c.d[dim];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;b1[N],b2[N];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Tree</span>&#123;</span><br><span class="line">    <span class="type">int</span> id,ch[<span class="number">2</span>];</span><br><span class="line">    ll d[<span class="number">2</span>],mn[<span class="number">2</span>],mx[<span class="number">2</span>];</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span> &lt; (<span class="type">const</span> Tree &amp;c) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> d[dim]&lt;c.d[dim];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;a[N&lt;&lt;<span class="number">2</span>];</span><br><span class="line"><span class="type">int</span> tcnt,rt;</span><br><span class="line">ll ans;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pushup</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">2</span>;++i)&#123;</span><br><span class="line">        <span class="keyword">if</span>(a[x].ch[<span class="number">0</span>])&#123;</span><br><span class="line">            a[x].mn[i]=<span class="built_in">min</span>(a[x].mn[i],a[a[x].ch[<span class="number">0</span>]].mn[i]);</span><br><span class="line">            a[x].mx[i]=<span class="built_in">max</span>(a[x].mx[i],a[a[x].ch[<span class="number">0</span>]].mx[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(a[x].ch[<span class="number">1</span>])&#123;</span><br><span class="line">            a[x].mn[i]=<span class="built_in">min</span>(a[x].mn[i],a[a[x].ch[<span class="number">1</span>]].mn[i]);</span><br><span class="line">            a[x].mx[i]=<span class="built_in">max</span>(a[x].mx[i],a[a[x].ch[<span class="number">1</span>]].mx[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">build</span><span class="params">(<span class="type">int</span> d,<span class="type">int</span> l,<span class="type">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l&gt;r) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    dim=d;</span><br><span class="line">    <span class="built_in">nth_element</span>(b1+l,b1+mid,b1+r+<span class="number">1</span>);</span><br><span class="line">    <span class="type">int</span> now=++tcnt;</span><br><span class="line">    a[now].d[<span class="number">0</span>]=b1[mid].d[<span class="number">0</span>]; a[now].d[<span class="number">1</span>]=b1[mid].d[<span class="number">1</span>]; a[now].id=b1[mid].id;</span><br><span class="line">    a[now].mn[<span class="number">0</span>]=a[now].mx[<span class="number">0</span>]=a[now].d[<span class="number">0</span>];</span><br><span class="line">    a[now].mn[<span class="number">1</span>]=a[now].mx[<span class="number">1</span>]=a[now].d[<span class="number">1</span>];</span><br><span class="line">    a[now].ch[<span class="number">0</span>]=<span class="built_in">build</span>(d^<span class="number">1</span>,l,mid<span class="number">-1</span>);</span><br><span class="line">    a[now].ch[<span class="number">1</span>]=<span class="built_in">build</span>(d^<span class="number">1</span>,mid+<span class="number">1</span>,r);</span><br><span class="line">    <span class="built_in">pushup</span>(now);</span><br><span class="line">    <span class="keyword">return</span> now;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">dis</span><span class="params">(<span class="type">int</span> x,ll * d)</span></span>&#123;</span><br><span class="line">    ll res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">2</span>;++i) res+=(a[x].d[i]-d[i])*(a[x].d[i]-d[i]);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">pri</span><span class="params">(<span class="type">int</span> x,ll * d)</span></span>&#123;</span><br><span class="line">    ll res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">2</span>;++i)&#123;</span><br><span class="line">        <span class="keyword">if</span>(a[x].mx[i]&lt;d[i]) res+=(a[x].mx[i]-d[i])*(a[x].mx[i]-d[i]);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(a[x].mn[i]&gt;d[i]) res+=(a[x].mn[i]-d[i])*(a[x].mn[i]-d[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">que</span><span class="params">(<span class="type">int</span> id,<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!x) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="keyword">if</span>(a[x].id^id) ans=<span class="built_in">min</span>(ans,<span class="built_in">dis</span>(x,b2[id].d));</span><br><span class="line">    ll disl=<span class="built_in">pri</span>(a[x].ch[<span class="number">0</span>],b2[id].d),disr=<span class="built_in">pri</span>(a[x].ch[<span class="number">1</span>],b2[id].d);</span><br><span class="line">    <span class="keyword">if</span>(disl&lt;ans) <span class="built_in">que</span>(id,a[x].ch[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">if</span>(disr&lt;ans) <span class="built_in">que</span>(id,a[x].ch[<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;1.txt&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;2.txt&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    T=<span class="built_in">read</span>();</span><br><span class="line">    <span class="keyword">while</span>(T--)&#123;</span><br><span class="line">        n=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123;</span><br><span class="line">            b1[i].d[<span class="number">0</span>]=<span class="built_in">read</span>(); b1[i].d[<span class="number">1</span>]=<span class="built_in">read</span>();</span><br><span class="line">            b1[i].id=i;</span><br><span class="line">            b2[i]=b1[i];</span><br><span class="line">        &#125;</span><br><span class="line">        tcnt=<span class="number">0</span>;</span><br><span class="line">        rt=<span class="built_in">build</span>(<span class="number">0</span>,<span class="number">1</span>,n);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123;</span><br><span class="line">            ans=<span class="number">1e18</span>;</span><br><span class="line">            <span class="built_in">que</span>(i,rt);</span><br><span class="line">            <span class="built_in">write</span>(ans);</span><br><span class="line">            cout&lt;&lt;endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="主席树">主席树</h1>
<h2 id="p3834-模板可持久化线段树-2主席树"><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3834">P3834
【模板】可持久化线段树 2（主席树）</a></h2>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 200006</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span>&#123;</span><br><span class="line">    <span class="type">int</span> l,r;</span><br><span class="line">    <span class="type">int</span> sum;</span><br><span class="line">&#125;;</span><br><span class="line">Node c[N*<span class="number">20</span>];</span><br><span class="line"><span class="type">int</span> rt[N],cnt;</span><br><span class="line"><span class="type">int</span> n,m,len;</span><br><span class="line"><span class="type">int</span> a[N],b[N];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    c[x].sum=c[c[x].l].sum+c[c[x].r].sum;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">build</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l&gt;r)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> idx=++cnt,mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    c[idx].sum=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(l==r)</span><br><span class="line">        <span class="keyword">return</span> idx;</span><br><span class="line">    c[idx].l=<span class="built_in">build</span>(l,mid);</span><br><span class="line">    c[idx].r=<span class="built_in">build</span>(mid+<span class="number">1</span>,r);</span><br><span class="line">    <span class="keyword">return</span> idx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> pos,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l&gt;r)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> idx=++cnt,mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    c[idx]=c[x];</span><br><span class="line">    <span class="keyword">if</span>(l==r)&#123;</span><br><span class="line">        ++c[idx].sum;</span><br><span class="line">        <span class="keyword">return</span> idx;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(pos&lt;=mid) c[idx].l=<span class="built_in">insert</span>(pos,l,mid,c[x].l);</span><br><span class="line">    <span class="keyword">else</span> c[idx].r=<span class="built_in">insert</span>(pos,mid+<span class="number">1</span>,r,c[x].r);</span><br><span class="line">    <span class="built_in">update</span>(idx);</span><br><span class="line">    <span class="keyword">return</span> idx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">qq</span><span class="params">(<span class="type">int</span> lidx,<span class="type">int</span> ridx,<span class="type">int</span> k,<span class="type">int</span> l,<span class="type">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l==r)</span><br><span class="line">        <span class="keyword">return</span> l;</span><br><span class="line">    <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>,temp;</span><br><span class="line">    temp=c[c[ridx].l].sum-c[c[lidx].l].sum;</span><br><span class="line">    <span class="keyword">if</span>(k&lt;=temp) <span class="keyword">return</span> <span class="built_in">qq</span>(c[lidx].l,c[ridx].l,k,l,mid);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="built_in">qq</span>(c[lidx].r,c[ridx].r,k-temp,mid+<span class="number">1</span>,r);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> t1,t2,t3;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;b[i]),a[i]=b[i];</span><br><span class="line">    <span class="built_in">sort</span>(b+<span class="number">1</span>,b+<span class="number">1</span>+n);</span><br><span class="line">    len=<span class="built_in">unique</span>(b+<span class="number">1</span>,b+<span class="number">1</span>+n)-b<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)</span><br><span class="line">        a[i]=<span class="built_in">lower_bound</span>(b+<span class="number">1</span>,b+<span class="number">1</span>+len,a[i])-b;</span><br><span class="line">    rt[<span class="number">0</span>]=<span class="built_in">build</span>(<span class="number">1</span>,len);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)</span><br><span class="line">        rt[i]=<span class="built_in">insert</span>(a[i],<span class="number">1</span>,len,rt[i<span class="number">-1</span>]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;++i)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;t1,&amp;t2,&amp;t3);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,b[<span class="built_in">qq</span>(rt[t1<span class="number">-1</span>],rt[t2],t3,<span class="number">1</span>,len)]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="p3157-cqoi2011动态逆序对">[P3157 <a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3157">CQOI2011]动态逆序对</a></h2>
<p>实际上并不是树状数组套主席树，而是树状数组套动态开点权值线段树</p>
<p>所谓的权值线段树就是把值域作为数组下标的线段树</p>
<p>而普通的线段是把元素个数当作数组下标</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 100006</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span>&#123;</span><br><span class="line">    <span class="type">int</span> l,r,sum;</span><br><span class="line">&#125;;</span><br><span class="line">Node a[N*<span class="number">50</span>];</span><br><span class="line"><span class="type">int</span> cnt,rt[N];</span><br><span class="line"><span class="type">int</span> n,m;</span><br><span class="line">ll now;</span><br><span class="line"><span class="type">int</span> b[N],ant[N];</span><br><span class="line"><span class="type">int</span> rn[N],ln[N];</span><br><span class="line"><span class="type">int</span> c[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> pos)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=pos;i&lt;=n;i+=(i&amp;(-i))) ++c[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">qq</span><span class="params">(<span class="type">int</span> pos)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=pos;i&gt;<span class="number">0</span>;i-=(i&amp;(-i))) res+=c[i];</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    a[x].sum=a[a[x].l].sum+a[a[x].r].sum;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> pos,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> &amp;x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l&gt;r)</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    <span class="keyword">if</span>(!x) x=++cnt;</span><br><span class="line">    <span class="keyword">if</span>(l==r)&#123;</span><br><span class="line">        ++a[x].sum;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(pos&lt;=mid) <span class="built_in">insert</span>(pos,l,mid,a[x].l);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">insert</span>(pos,mid+<span class="number">1</span>,r,a[x].r);</span><br><span class="line">    <span class="built_in">update</span>(x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">qq</span><span class="params">(<span class="type">int</span> L,<span class="type">int</span> R,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l&gt;r||l&gt;R||r&lt;L||x==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(l&gt;=L&amp;&amp;r&lt;=R) <span class="keyword">return</span> a[x].sum;</span><br><span class="line">    <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">qq</span>(L,R,l,mid,a[x].l)+<span class="built_in">qq</span>(L,R,mid+<span class="number">1</span>,r,a[x].r);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">q1</span><span class="params">(<span class="type">int</span> pos,<span class="type">int</span> val)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=pos;i&gt;<span class="number">0</span>;i-=(i&amp;(-i)))</span><br><span class="line">        res+=<span class="built_in">qq</span>(val,n,<span class="number">1</span>,n,rt[i]);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">q2</span><span class="params">(<span class="type">int</span> pos,<span class="type">int</span> val)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=pos;i&gt;<span class="number">0</span>;i-=(i&amp;(-i)))</span><br><span class="line">        res+=<span class="built_in">qq</span>(<span class="number">1</span>,val,<span class="number">1</span>,n,rt[i]);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add1</span><span class="params">(<span class="type">int</span> pos)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=pos;i&lt;=n;i+=(i&amp;(-i)))</span><br><span class="line">        <span class="built_in">insert</span>(b[pos],<span class="number">1</span>,n,rt[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> temp;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;b[i]),ant[b[i]]=i;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=n;i;--i)&#123;</span><br><span class="line">        now+=rn[i]=<span class="built_in">qq</span>(b[i]);</span><br><span class="line">        <span class="built_in">add</span>(b[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">memset</span>(c,<span class="number">0</span>,<span class="built_in">sizeof</span>(c));</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123;</span><br><span class="line">        ln[i]=i<span class="number">-1</span>-<span class="built_in">qq</span>(b[i]);</span><br><span class="line">        <span class="built_in">add</span>(b[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;++i)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;temp);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,now);</span><br><span class="line">        now-=(ln[ant[temp]]+rn[ant[temp]]);</span><br><span class="line">        now+=(<span class="built_in">q1</span>(ant[temp]<span class="number">-1</span>,temp+<span class="number">1</span>)-<span class="built_in">q1</span>(<span class="number">0</span>,temp+<span class="number">1</span>)+<span class="built_in">q2</span>(n,temp<span class="number">-1</span>)-<span class="built_in">q2</span>(ant[temp],temp<span class="number">-1</span>));</span><br><span class="line">        <span class="built_in">add1</span>(ant[temp]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="p2633-count-on-a-tree"><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2633">P2633 Count on a
tree</a></h2>
<p>树链剖分+主席树</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 100006</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span>&#123;</span><br><span class="line">    <span class="type">int</span> l,r,sum;</span><br><span class="line">&#125;;</span><br><span class="line">Node a[N*<span class="number">50</span>];</span><br><span class="line"><span class="type">int</span> sz,rt[N];</span><br><span class="line"><span class="type">int</span> n,m,len;</span><br><span class="line"><span class="type">int</span> b[N],te[N];</span><br><span class="line"><span class="type">int</span> size[N],son[N],ind[N],top[N],ant[N],dep[N],fa[N],num;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; sta;</span><br><span class="line"><span class="type">int</span> he;</span><br><span class="line"><span class="type">int</span> cnt,head[N*<span class="number">2</span>],nxt[N*<span class="number">2</span>],v[N*<span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> t1,<span class="type">int</span> t2)</span></span>&#123;</span><br><span class="line">    ++cnt;</span><br><span class="line">    nxt[cnt]=head[t1];</span><br><span class="line">    head[t1]=cnt;</span><br><span class="line">    v[cnt]=t2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs1</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> temp=head[x];</span><br><span class="line">    size[x]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(temp)&#123;</span><br><span class="line">        <span class="keyword">if</span>(v[temp]==fa[x])&#123;</span><br><span class="line">            temp=nxt[temp];</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        dep[v[temp]]=dep[x]+<span class="number">1</span>;</span><br><span class="line">        fa[v[temp]]=x;</span><br><span class="line">        <span class="built_in">dfs1</span>(v[temp]);</span><br><span class="line">        size[x]+=size[v[temp]];</span><br><span class="line">        <span class="keyword">if</span>(size[v[temp]]&gt;size[son[x]])</span><br><span class="line">            son[x]=v[temp];</span><br><span class="line">        temp=nxt[temp];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs2</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> tp)</span></span>&#123;</span><br><span class="line">    ind[x]=++num; ant[num]=x; top[x]=tp;</span><br><span class="line">    <span class="keyword">if</span>(son[x])</span><br><span class="line">        <span class="built_in">dfs2</span>(son[x],tp);</span><br><span class="line">    <span class="type">int</span> temp=head[x];</span><br><span class="line">    <span class="keyword">while</span>(temp)&#123;</span><br><span class="line">        <span class="keyword">if</span>(v[temp]==fa[x])&#123;</span><br><span class="line">            temp=nxt[temp];</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(v[temp]!=son[x])</span><br><span class="line">            <span class="built_in">dfs2</span>(v[temp],v[temp]);</span><br><span class="line">        temp=nxt[temp];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pushup</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    a[x].sum=a[a[x].l].sum+a[a[x].r].sum;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">build</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l&gt;r) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> idx=++sz,mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(l==r) <span class="keyword">return</span> idx;</span><br><span class="line">    a[idx].l=<span class="built_in">build</span>(l,mid);</span><br><span class="line">    a[idx].r=<span class="built_in">build</span>(mid+<span class="number">1</span>,r);</span><br><span class="line">    <span class="keyword">return</span> idx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> pos,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> idx=++sz,mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    a[idx]=a[x]; ++a[idx].sum;</span><br><span class="line">    <span class="keyword">if</span>(l==r) <span class="keyword">return</span> idx;</span><br><span class="line">    <span class="keyword">if</span>(pos&lt;=mid) a[idx].l=<span class="built_in">insert</span>(pos,l,mid,a[x].l);</span><br><span class="line">    <span class="keyword">else</span> a[idx].r=<span class="built_in">insert</span>(pos,mid+<span class="number">1</span>,r,a[x].r);</span><br><span class="line">    <span class="built_in">pushup</span>(idx);</span><br><span class="line">    <span class="keyword">return</span> idx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">LCA</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> t1,t2;</span><br><span class="line">    <span class="keyword">while</span>(top[x]!=top[y])&#123;</span><br><span class="line">        <span class="keyword">if</span>(dep[top[x]]&lt;dep[top[y]])</span><br><span class="line">            <span class="built_in">swap</span>(x,y);</span><br><span class="line">        ++he; sta.<span class="built_in">push_back</span>(rt[ind[top[x]]<span class="number">-1</span>]);</span><br><span class="line">        ++he; sta.<span class="built_in">push_back</span>(rt[ind[x]]);</span><br><span class="line">        x=fa[top[x]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(dep[x]&lt;dep[y])</span><br><span class="line">        <span class="built_in">swap</span>(x,y);</span><br><span class="line">    ++he; sta.<span class="built_in">push_back</span>(rt[ind[y]<span class="number">-1</span>]);</span><br><span class="line">    ++he; sta.<span class="built_in">push_back</span>(rt[ind[x]]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">qq</span><span class="params">(vector&lt;<span class="type">int</span>&gt; idx,<span class="type">int</span> K,<span class="type">int</span> l,<span class="type">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l==r)</span><br><span class="line">        <span class="keyword">return</span> l;</span><br><span class="line">    <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>,sum=<span class="number">0</span>,lidx,ridx;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;he;i+=<span class="number">2</span>)&#123;</span><br><span class="line">        lidx=idx[i]; ridx=idx[i+<span class="number">1</span>];</span><br><span class="line">        lidx=a[lidx].l; ridx=a[ridx].l;</span><br><span class="line">        sum+=(a[ridx].sum-a[lidx].sum);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(K&lt;=sum)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;he;i+=<span class="number">2</span>)&#123;</span><br><span class="line">            idx[i]=a[idx[i]].l;</span><br><span class="line">            idx[i+<span class="number">1</span>]=a[idx[i+<span class="number">1</span>]].l;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">qq</span>(idx,K,l,mid);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;he;i+=<span class="number">2</span>)&#123;</span><br><span class="line">            idx[i]=a[idx[i]].r;</span><br><span class="line">            idx[i+<span class="number">1</span>]=a[idx[i+<span class="number">1</span>]].r;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">qq</span>(idx,K-sum,mid+<span class="number">1</span>,r);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> t1,t2,t3,las=<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;te[i]),b[i]=te[i];</span><br><span class="line">    <span class="built_in">sort</span>(te+<span class="number">1</span>,te+<span class="number">1</span>+n);</span><br><span class="line">    len=<span class="built_in">unique</span>(te+<span class="number">1</span>,te+<span class="number">1</span>+n)-te<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i) b[i]=<span class="built_in">lower_bound</span>(te+<span class="number">1</span>,te+<span class="number">1</span>+len,b[i])-te;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;++i)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;t1,&amp;t2);</span><br><span class="line">        <span class="built_in">add</span>(t1,t2);</span><br><span class="line">        <span class="built_in">add</span>(t2,t1);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    dep[<span class="number">1</span>]=<span class="number">1</span>; fa[<span class="number">1</span>]=<span class="number">-1</span>;</span><br><span class="line">    <span class="built_in">dfs1</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">dfs2</span>(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">    rt[<span class="number">0</span>]=<span class="built_in">build</span>(<span class="number">1</span>,len);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)</span><br><span class="line">        rt[i]=<span class="built_in">insert</span>(b[ant[i]],<span class="number">1</span>,len,rt[i<span class="number">-1</span>]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;++i)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;t1,&amp;t2,&amp;t3);</span><br><span class="line">        t1^=las;</span><br><span class="line">        he=<span class="number">0</span>; sta.<span class="built_in">clear</span>();</span><br><span class="line">        <span class="built_in">LCA</span>(t1,t2);</span><br><span class="line">        las=te[<span class="built_in">qq</span>(sta,t3,<span class="number">1</span>,len)];</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,las);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="平衡树">平衡树</h1>
<h2 id="p3369-模板普通平衡树"><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3369">P3369
【模板】普通平衡树</a></h2>
<h3 id="treap">Treap:</h3>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 100006</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">treap</span>&#123;</span><br><span class="line">    <span class="type">int</span> val,key,sz;</span><br><span class="line">    treap *ch[<span class="number">2</span>];</span><br><span class="line">    <span class="built_in">treap</span>(<span class="type">int</span> t1)&#123;</span><br><span class="line">        val=t1;</span><br><span class="line">        sz=<span class="number">1</span>;</span><br><span class="line">        key=<span class="built_in">rand</span>();</span><br><span class="line">        ch[<span class="number">0</span>]=ch[<span class="number">1</span>]=<span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;*root;</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">size</span><span class="params">(treap *&amp;x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x==<span class="literal">NULL</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> x-&gt;sz;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pushup</span><span class="params">(treap *&amp;x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x==<span class="literal">NULL</span>)</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    x-&gt;sz=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">2</span>;++i)</span><br><span class="line">        <span class="keyword">if</span>(x-&gt;ch[i]!=<span class="literal">NULL</span>)</span><br><span class="line">            x-&gt;sz+=x-&gt;ch[i]-&gt;sz;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">lrot</span><span class="params">(treap *&amp;x)</span></span>&#123;</span><br><span class="line">    treap *temp=x-&gt;ch[<span class="number">1</span>];</span><br><span class="line">    x-&gt;ch[<span class="number">1</span>]=temp-&gt;ch[<span class="number">0</span>];</span><br><span class="line">    temp-&gt;ch[<span class="number">0</span>]=x;</span><br><span class="line">    x=temp;</span><br><span class="line">    <span class="built_in">pushup</span>(x-&gt;ch[<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">pushup</span>(x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">rrot</span><span class="params">(treap *&amp;x)</span></span>&#123;</span><br><span class="line">    treap *temp=x-&gt;ch[<span class="number">0</span>];</span><br><span class="line">    x-&gt;ch[<span class="number">0</span>]=temp-&gt;ch[<span class="number">1</span>];</span><br><span class="line">    temp-&gt;ch[<span class="number">1</span>]=x;</span><br><span class="line">    x=temp;</span><br><span class="line">    <span class="built_in">pushup</span>(x-&gt;ch[<span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">pushup</span>(x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> tt,treap *&amp;x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x==<span class="literal">NULL</span>)&#123;</span><br><span class="line">        x=<span class="keyword">new</span> <span class="built_in">treap</span>(tt);</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(tt&gt;=x-&gt;val)&#123;</span><br><span class="line">        <span class="built_in">insert</span>(tt,x-&gt;ch[<span class="number">1</span>]);</span><br><span class="line">        <span class="built_in">pushup</span>(x);</span><br><span class="line">        <span class="keyword">if</span>(x-&gt;ch[<span class="number">1</span>]-&gt;key&gt;x-&gt;key)</span><br><span class="line">            <span class="built_in">lrot</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">insert</span>(tt,x-&gt;ch[<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">pushup</span>(x);</span><br><span class="line">        <span class="keyword">if</span>(x-&gt;ch[<span class="number">0</span>]-&gt;key&gt;x-&gt;key)</span><br><span class="line">            <span class="built_in">rrot</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">del</span><span class="params">(<span class="type">int</span> tt,treap *&amp;x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x-&gt;val==tt)&#123;</span><br><span class="line">        <span class="keyword">if</span>(x-&gt;ch[<span class="number">0</span>]==<span class="literal">NULL</span>&amp;&amp;x-&gt;ch[<span class="number">1</span>]==<span class="literal">NULL</span>)&#123;</span><br><span class="line">            <span class="keyword">delete</span> x;</span><br><span class="line">            x=<span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(x-&gt;ch[<span class="number">0</span>]==<span class="literal">NULL</span>)&#123;</span><br><span class="line">            <span class="built_in">lrot</span>(x);</span><br><span class="line">            <span class="built_in">del</span>(tt,x-&gt;ch[<span class="number">0</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(x-&gt;ch[<span class="number">1</span>]==<span class="literal">NULL</span>)&#123;</span><br><span class="line">            <span class="built_in">rrot</span>(x);</span><br><span class="line">            <span class="built_in">del</span>(tt,x-&gt;ch[<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(x-&gt;ch[<span class="number">0</span>]-&gt;key&gt;x-&gt;ch[<span class="number">1</span>]-&gt;key)&#123;</span><br><span class="line">            <span class="built_in">rrot</span>(x);</span><br><span class="line">            <span class="built_in">del</span>(tt,x-&gt;ch[<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">lrot</span>(x);</span><br><span class="line">            <span class="built_in">del</span>(tt,x-&gt;ch[<span class="number">0</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(tt&gt;x-&gt;val)</span><br><span class="line">        <span class="built_in">del</span>(tt,x-&gt;ch[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">del</span>(tt,x-&gt;ch[<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">pushup</span>(x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">fin</span><span class="params">(<span class="type">int</span> tt,treap *&amp;x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x==<span class="literal">NULL</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(x-&gt;val&lt;tt)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>+<span class="built_in">size</span>(x-&gt;ch[<span class="number">0</span>])+<span class="built_in">fin</span>(tt,x-&gt;ch[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">fin</span>(tt,x-&gt;ch[<span class="number">0</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">rank1</span><span class="params">(<span class="type">int</span> k)</span></span>&#123;</span><br><span class="line">    treap *x=root;</span><br><span class="line">    <span class="keyword">while</span>(x!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">size</span>(x-&gt;ch[<span class="number">0</span>])+<span class="number">1</span>==k)</span><br><span class="line">            <span class="keyword">return</span> x-&gt;val;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">size</span>(x-&gt;ch[<span class="number">0</span>])+<span class="number">1</span>&lt;k)&#123;</span><br><span class="line">            k-=(<span class="built_in">size</span>(x-&gt;ch[<span class="number">0</span>])+<span class="number">1</span>);</span><br><span class="line">            x=x-&gt;ch[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            x=x-&gt;ch[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">las</span><span class="params">(<span class="type">int</span> tt,treap *&amp;x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x==<span class="literal">NULL</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1e9</span>;</span><br><span class="line">    <span class="keyword">if</span>(x-&gt;val&gt;=tt)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">las</span>(tt,x-&gt;ch[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">max</span>(x-&gt;val,<span class="built_in">las</span>(tt,x-&gt;ch[<span class="number">1</span>]));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">nxt</span><span class="params">(<span class="type">int</span> tt,treap *&amp;x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x==<span class="literal">NULL</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1e9</span>;</span><br><span class="line">    <span class="keyword">if</span>(x-&gt;val&lt;=tt)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">nxt</span>(tt,x-&gt;ch[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">min</span>(x-&gt;val,<span class="built_in">nxt</span>(tt,x-&gt;ch[<span class="number">0</span>]));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(treap *&amp;x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x==<span class="literal">NULL</span>)</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    <span class="built_in">dfs</span>(x-&gt;ch[<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,x-&gt;val);</span><br><span class="line">    <span class="built_in">dfs</span>(x-&gt;ch[<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//freopen(&quot;1.txt&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="type">int</span> temp,tt;</span><br><span class="line">    <span class="built_in">srand</span>(<span class="built_in">time</span>(<span class="number">0</span>));</span><br><span class="line">    root=<span class="literal">NULL</span>;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;temp,&amp;tt);</span><br><span class="line">        <span class="keyword">if</span>(temp==<span class="number">1</span>)</span><br><span class="line">            <span class="built_in">insert</span>(tt,root);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(temp==<span class="number">2</span>)</span><br><span class="line">            <span class="built_in">del</span>(tt,root);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(temp==<span class="number">3</span>)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">fin</span>(tt,root)+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(temp==<span class="number">4</span>)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">rank1</span>(tt));</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(temp==<span class="number">5</span>)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">las</span>(tt,root));</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">nxt</span>(tt,root));</span><br><span class="line">        <span class="comment">/*printf(&quot;i=%d \n&quot;,i);</span></span><br><span class="line"><span class="comment">        dfs(root);</span></span><br><span class="line"><span class="comment">        cout&lt;&lt;&#x27;\n&#x27;;*/</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//while(1);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="splay">splay:</h3>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 200006</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> M 999911659</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span>&#123;</span><br><span class="line">    <span class="type">int</span> ch[<span class="number">2</span>],sz,num,fa,val;</span><br><span class="line">&#125;;</span><br><span class="line">Node a[N];</span><br><span class="line"><span class="type">int</span> rt,cnt;</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pushup</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!x) <span class="keyword">return</span> ;</span><br><span class="line">    a[x].sz=a[x].num+a[a[x].ch[<span class="number">0</span>]].sz+a[a[x].ch[<span class="number">1</span>]].sz;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getson</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a[a[x].fa].ch[<span class="number">1</span>]==x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">rot</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> f=a[x].fa,ff=a[f].fa,w=<span class="built_in">getson</span>(x),ww=<span class="built_in">getson</span>(f);</span><br><span class="line">    a[f].ch[w]=a[x].ch[w^<span class="number">1</span>]; a[a[f].ch[w]].fa=f;</span><br><span class="line">    a[x].ch[w^<span class="number">1</span>]=f; a[f].fa=x;</span><br><span class="line">    a[x].fa=ff;</span><br><span class="line">    <span class="keyword">if</span>(ff) a[ff].ch[ww]=x;</span><br><span class="line">    <span class="built_in">pushup</span>(f); <span class="built_in">pushup</span>(x);</span><br><span class="line">    <span class="keyword">if</span>(ff) <span class="built_in">pushup</span>(ff);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">splay</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(a[x].fa)&#123;</span><br><span class="line">        <span class="keyword">if</span>(a[a[x].fa].fa)&#123;</span><br><span class="line">            <span class="built_in">rot</span>(<span class="built_in">getson</span>(x)==<span class="built_in">getson</span>(a[x].fa)?a[x].fa:x);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">rot</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    rt=x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ins</span><span class="params">(<span class="type">int</span> val,<span class="type">int</span> &amp;x,<span class="type">int</span> f)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x==<span class="number">0</span>)&#123;</span><br><span class="line">        ++cnt; x=cnt;</span><br><span class="line">        a[cnt].sz=a[cnt].num=<span class="number">1</span>;</span><br><span class="line">        a[cnt].ch[<span class="number">0</span>]=a[cnt].ch[<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">        a[cnt].fa=f; a[cnt].val=val;</span><br><span class="line">        <span class="keyword">if</span>(f) a[f].ch[val&gt;a[f].val]=cnt;</span><br><span class="line">        <span class="built_in">splay</span>(cnt);</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(val==a[x].val)&#123;</span><br><span class="line">        ++a[x].num; ++a[x].sz;</span><br><span class="line">        <span class="built_in">splay</span>(x);</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">ins</span>(val,a[x].ch[val&gt;a[x].val],x);</span><br><span class="line">    <span class="built_in">pushup</span>(x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">kth</span><span class="params">(<span class="type">int</span> K)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> now=rt;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(K&lt;=a[a[now].ch[<span class="number">0</span>]].sz) now=a[now].ch[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="type">int</span> temp=a[a[now].ch[<span class="number">0</span>]].sz+a[now].num;</span><br><span class="line">            <span class="keyword">if</span>(K&lt;=temp) &#123;<span class="built_in">splay</span>(now); <span class="keyword">return</span> a[now].val;&#125;</span><br><span class="line">            <span class="keyword">else</span> K-=temp,now=a[now].ch[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">rk</span><span class="params">(<span class="type">int</span> val)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> now=rt,res=<span class="number">1</span>,temp;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        temp=a[now].num+a[a[now].ch[<span class="number">0</span>]].sz;</span><br><span class="line">        <span class="keyword">if</span>(a[now].val&lt;val) res+=temp,now=a[now].ch[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(a[now].val==val) &#123;res+=a[a[now].ch[<span class="number">0</span>]].sz; <span class="built_in">splay</span>(now); <span class="keyword">return</span> res;&#125;</span><br><span class="line">        <span class="keyword">else</span> now=a[now].ch[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">pre</span><span class="params">(<span class="type">int</span> val)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> now=rt,res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(now)&#123;</span><br><span class="line">        <span class="keyword">if</span>(val&gt;a[now].val) res=now,now=a[now].ch[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">else</span> now=a[now].ch[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> a[res].val;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">nxt</span><span class="params">(<span class="type">int</span> val)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> now=rt,res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(now)&#123;</span><br><span class="line">        <span class="keyword">if</span>(val&lt;a[now].val) res=now,now=a[now].ch[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">else</span> now=a[now].ch[<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> a[res].val;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">del</span><span class="params">(<span class="type">int</span> val,<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(val==a[x].val)&#123;</span><br><span class="line">        <span class="keyword">if</span>(a[x].num&gt;<span class="number">1</span>)&#123;</span><br><span class="line">            --a[x].num; --a[x].sz;</span><br><span class="line">            <span class="built_in">splay</span>(x); <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">splay</span>(x);</span><br><span class="line">            <span class="keyword">if</span>(a[x].ch[<span class="number">0</span>]==<span class="number">0</span>)&#123;</span><br><span class="line">                rt=a[x].ch[<span class="number">1</span>];</span><br><span class="line">                a[rt].fa=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">return</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(a[x].ch[<span class="number">1</span>]==<span class="number">0</span>)&#123;</span><br><span class="line">                rt=a[x].ch[<span class="number">0</span>];</span><br><span class="line">                a[rt].fa=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">return</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                a[a[rt].ch[<span class="number">0</span>]].fa=<span class="number">0</span>;</span><br><span class="line">                <span class="type">int</span> temp=a[x].ch[<span class="number">0</span>];</span><br><span class="line">                <span class="keyword">while</span>(a[temp].ch[<span class="number">1</span>]) temp=a[temp].ch[<span class="number">1</span>];</span><br><span class="line">                <span class="built_in">splay</span>(temp);</span><br><span class="line">                a[temp].ch[<span class="number">1</span>]=a[x].ch[<span class="number">1</span>];</span><br><span class="line">                a[a[x].ch[<span class="number">1</span>]].fa=temp;</span><br><span class="line">                <span class="built_in">pushup</span>(rt);</span><br><span class="line">                <span class="keyword">return</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">del</span>(val,a[x].ch[val&gt;a[x].val]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> opt,temp;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;opt,&amp;temp);</span><br><span class="line">        <span class="keyword">switch</span>(opt)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>: <span class="built_in">ins</span>(temp,rt,<span class="number">0</span>); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>: <span class="built_in">del</span>(temp,rt); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span>: <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">rk</span>(temp)); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">4</span>: <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">kth</span>(temp)); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">5</span>: <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">pre</span>(temp)); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">6</span>: <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">nxt</span>(temp)); <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="p3391-模板文艺平衡树"><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3391">P3391
【模板】文艺平衡树</a></h2>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 100006</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> M 999911659</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span>&#123;</span><br><span class="line">    <span class="type">int</span> ch[<span class="number">2</span>],fa,val,fla,sz;</span><br><span class="line">&#125;;</span><br><span class="line">Node a[N];</span><br><span class="line"><span class="type">int</span> cnt,rt;</span><br><span class="line"><span class="type">int</span> n,m;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pushup</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    a[x].sz=a[a[x].ch[<span class="number">0</span>]].sz+a[a[x].ch[<span class="number">1</span>]].sz+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pushdown</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(a[x].fla)&#123;</span><br><span class="line">        <span class="keyword">if</span>(a[x].ch[<span class="number">0</span>]) a[a[x].ch[<span class="number">0</span>]].fla^=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(a[x].ch[<span class="number">1</span>]) a[a[x].ch[<span class="number">1</span>]].fla^=<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">swap</span>(a[x].ch[<span class="number">0</span>],a[x].ch[<span class="number">1</span>]);</span><br><span class="line">        a[x].fla=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">getson</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x==a[a[x].fa].ch[<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> &amp;x,<span class="type">int</span> fa)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l&gt;r) &#123; x=<span class="number">0</span>; <span class="keyword">return</span> ; &#125;</span><br><span class="line">    <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    x=++cnt;</span><br><span class="line">    a[x].val=mid<span class="number">-1</span>;</span><br><span class="line">    a[x].fa=fa;</span><br><span class="line">    <span class="built_in">build</span>(l,mid<span class="number">-1</span>,a[x].ch[<span class="number">0</span>],x);</span><br><span class="line">    <span class="built_in">build</span>(mid+<span class="number">1</span>,r,a[x].ch[<span class="number">1</span>],x);</span><br><span class="line">    <span class="built_in">pushup</span>(x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">rot</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> f=a[x].fa,ff=a[f].fa,w=<span class="built_in">getson</span>(x),ww=<span class="built_in">getson</span>(f);</span><br><span class="line">    a[f].ch[w]=a[x].ch[w^<span class="number">1</span>]; a[a[f].ch[w]].fa=f;</span><br><span class="line">    a[x].ch[w^<span class="number">1</span>]=f; a[f].fa=x;</span><br><span class="line">    a[x].fa=ff;</span><br><span class="line">    <span class="keyword">if</span>(ff) a[ff].ch[ww]=x;</span><br><span class="line">    <span class="built_in">pushup</span>(f); <span class="built_in">pushup</span>(x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">splay</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> ter)</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(a[x].fa!=ter)&#123;</span><br><span class="line">        <span class="keyword">if</span>(a[a[x].fa].fa!=ter)</span><br><span class="line">            <span class="built_in">rot</span>(<span class="built_in">getson</span>(x)==<span class="built_in">getson</span>(a[x].fa)?a[x].fa:x);</span><br><span class="line">        <span class="built_in">rot</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!ter) rt=x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">kth</span><span class="params">(<span class="type">int</span> K)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> x=rt;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="built_in">pushdown</span>(x);</span><br><span class="line">        <span class="keyword">if</span>(K&lt;=a[a[x].ch[<span class="number">0</span>]].sz) x=a[x].ch[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(K==a[a[x].ch[<span class="number">0</span>]].sz+<span class="number">1</span>) <span class="keyword">return</span> x;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            K-=(a[a[x].ch[<span class="number">0</span>]].sz+<span class="number">1</span>);</span><br><span class="line">            x=a[x].ch[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">rev</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="built_in">splay</span>(<span class="built_in">kth</span>(l),<span class="number">0</span>); <span class="built_in">splay</span>(<span class="built_in">kth</span>(r+<span class="number">2</span>),rt);</span><br><span class="line">    a[a[a[rt].ch[<span class="number">1</span>]].ch[<span class="number">0</span>]].fla^=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">putout</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!x) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="built_in">pushdown</span>(x);</span><br><span class="line">    <span class="built_in">putout</span>(a[x].ch[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">if</span>(a[x].val!=<span class="number">0</span>&amp;&amp;a[x].val!=n+<span class="number">1</span>)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,a[x].val);</span><br><span class="line">    <span class="built_in">putout</span>(a[x].ch[<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> t1,t2;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">    <span class="built_in">build</span>(<span class="number">1</span>,n+<span class="number">2</span>,rt,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;++i)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;t1,&amp;t2);</span><br><span class="line">        <span class="built_in">rev</span>(t1,t2);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">putout</span>(rt);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="lca">LCA</h1>
<h2 id="o1-lca">O(1) LCA</h2>
<p>https://www.luogu.com.cn/blog/Rainbowsjy/st-table-lca</p>
<h1 id="lct">LCT</h1>
<h2 id="p3690-模板动态树link-cut-tree"><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3690">P3690 【模板】动态树（Link
Cut Tree）</a></h2>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> dd double</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod 998244353</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> maxn=<span class="number">100006</span>;</span><br><span class="line"><span class="type">int</span> n,m;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LCT</span>&#123;</span><br><span class="line">    <span class="type">int</span> val[maxn],fa[maxn],ch[maxn][<span class="number">2</span>],xors[maxn];</span><br><span class="line">    <span class="type">bool</span> laz[maxn];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pushup</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        xors[x]=xors[ch[x][<span class="number">0</span>]]^xors[ch[x][<span class="number">1</span>]]^val[x];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pushdown</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(laz[x])&#123;</span><br><span class="line">            <span class="type">int</span> tmp;</span><br><span class="line">            laz[ch[x][<span class="number">0</span>]]^=<span class="number">1</span>; laz[ch[x][<span class="number">1</span>]]^=<span class="number">1</span>;</span><br><span class="line">            tmp=ch[x][<span class="number">0</span>]; <span class="built_in">swap</span>(ch[tmp][<span class="number">0</span>],ch[tmp][<span class="number">1</span>]);</span><br><span class="line">            tmp=ch[x][<span class="number">1</span>]; <span class="built_in">swap</span>(ch[tmp][<span class="number">0</span>],ch[tmp][<span class="number">1</span>]);</span><br><span class="line">            laz[x]=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">jpos</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ch[fa[x]][<span class="number">1</span>]==x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">notrt</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (ch[fa[x]][<span class="number">0</span>]==x)||(ch[fa[x]][<span class="number">1</span>]==x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">rot</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="type">int</span> y=fa[x],z=fa[y],k=<span class="built_in">jpos</span>(x),c=ch[x][k^<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">notrt</span>(y)) ch[z][<span class="built_in">jpos</span>(y)]=x; ch[x][k^<span class="number">1</span>]=y; ch[y][k]=c;</span><br><span class="line">        <span class="keyword">if</span>(c) fa[c]=y; fa[y]=x; fa[x]=z;</span><br><span class="line">        <span class="built_in">pushup</span>(y); <span class="built_in">pushup</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">splay</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        stack&lt;<span class="type">int</span>&gt; sta;</span><br><span class="line">        sta.<span class="built_in">push</span>(x);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=x;<span class="built_in">notrt</span>(i);i=fa[i]) sta.<span class="built_in">push</span>(fa[i]);</span><br><span class="line">        <span class="keyword">for</span>(;sta.<span class="built_in">size</span>();sta.<span class="built_in">pop</span>()) <span class="built_in">pushdown</span>(sta.<span class="built_in">top</span>());</span><br><span class="line">        <span class="keyword">while</span>(<span class="built_in">notrt</span>(x))&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">notrt</span>(fa[x])) <span class="built_in">rot</span>(<span class="built_in">jpos</span>(x)==<span class="built_in">jpos</span>(fa[x])?fa[x]:x);</span><br><span class="line">            <span class="built_in">rot</span>(x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">access</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> y=<span class="number">0</span>;x;y=x,x=fa[x])&#123;</span><br><span class="line">            <span class="built_in">splay</span>(x); ch[x][<span class="number">1</span>]=y;</span><br><span class="line">            <span class="built_in">pushup</span>(x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">findrt</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="built_in">access</span>(x); <span class="built_in">splay</span>(x);</span><br><span class="line">        <span class="keyword">for</span>(;ch[x][<span class="number">0</span>];x=ch[x][<span class="number">0</span>])&#123;</span><br><span class="line">            <span class="built_in">pushdown</span>(x);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">splay</span>(x);</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">makert</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="built_in">access</span>(x); <span class="built_in">splay</span>(x);</span><br><span class="line">        <span class="built_in">swap</span>(ch[x][<span class="number">0</span>],ch[x][<span class="number">1</span>]);</span><br><span class="line">        laz[x]^=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">split</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">        <span class="built_in">makert</span>(x); <span class="built_in">access</span>(y);</span><br><span class="line">        <span class="built_in">splay</span>(y);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">link</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">        <span class="built_in">makert</span>(x);</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">findrt</span>(y)!=x) fa[x]=y;</span><br><span class="line">        <span class="built_in">access</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">cut</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">        <span class="built_in">makert</span>(x);</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">findrt</span>(y)!=x) <span class="keyword">return</span> ;</span><br><span class="line">        <span class="keyword">if</span>(fa[y]==x&amp;&amp;!ch[y][<span class="number">0</span>])</span><br><span class="line">            fa[y]=ch[x][<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">pushup</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">        <span class="built_in">split</span>(x,y);</span><br><span class="line">        <span class="keyword">return</span> xors[y];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;T;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;1.txt&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;2.txt&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="type">int</span> t1,t2,t3;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;T.val[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(m--)&#123;</span><br><span class="line">        <span class="type">int</span> opt;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;opt,&amp;t1,&amp;t2);</span><br><span class="line">        <span class="keyword">if</span>(opt==<span class="number">0</span>) <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,T.<span class="built_in">query</span>(t1,t2));</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(opt==<span class="number">1</span>) T.<span class="built_in">link</span>(t1,t2);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(opt==<span class="number">2</span>) T.<span class="built_in">cut</span>(t1,t2);</span><br><span class="line">        <span class="keyword">else</span> T.<span class="built_in">splay</span>(t1),T.val[t1]=t2,T.<span class="built_in">pushup</span>(t1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="p3203-hnoi2010弹飞绵羊">[P3203 <a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3203">HNOI2010]弹飞绵羊</a></h2>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> dd double</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod 998244353</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> maxn=<span class="number">200006</span>;</span><br><span class="line"><span class="type">int</span> n,m,k[maxn];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LCT</span>&#123;</span><br><span class="line">    <span class="type">int</span> fa[maxn],ch[maxn][<span class="number">2</span>],sz[maxn],laz[maxn];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pushup</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        sz[x]=sz[ch[x][<span class="number">0</span>]]+sz[ch[x][<span class="number">1</span>]]+<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pushdown</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(laz[x])&#123;</span><br><span class="line">            laz[ch[x][<span class="number">0</span>]]^=<span class="number">1</span>; laz[ch[x][<span class="number">1</span>]]^=<span class="number">1</span>; laz[x]=<span class="number">0</span>;</span><br><span class="line">            <span class="type">int</span> tmp=ch[x][<span class="number">0</span>]; <span class="built_in">swap</span>(ch[tmp][<span class="number">0</span>],ch[tmp][<span class="number">1</span>]);</span><br><span class="line">            tmp=ch[x][<span class="number">1</span>]; <span class="built_in">swap</span>(ch[tmp][<span class="number">0</span>],ch[tmp][<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">jpos</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ch[fa[x]][<span class="number">1</span>]==x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">notrt</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (ch[fa[x]][<span class="number">0</span>]==x)||(ch[fa[x]][<span class="number">1</span>]==x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">rot</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="type">int</span> y=fa[x],z=fa[y],k=<span class="built_in">jpos</span>(x),c=ch[x][k^<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">notrt</span>(y)) ch[z][<span class="built_in">jpos</span>(y)]=x; ch[x][k^<span class="number">1</span>]=y; ch[y][k]=c;</span><br><span class="line">        fa[x]=z; fa[y]=x; <span class="keyword">if</span>(c) fa[c]=y;</span><br><span class="line">        <span class="built_in">pushup</span>(y); <span class="built_in">pushup</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">splay</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        stack&lt;<span class="type">int</span>&gt; sta;</span><br><span class="line">        sta.<span class="built_in">push</span>(x);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> y=x;<span class="built_in">notrt</span>(y);y=fa[y]) sta.<span class="built_in">push</span>(fa[y]);</span><br><span class="line">        <span class="keyword">for</span>(;sta.<span class="built_in">size</span>();sta.<span class="built_in">pop</span>()) <span class="built_in">pushdown</span>(sta.<span class="built_in">top</span>());</span><br><span class="line">        <span class="keyword">while</span>(<span class="built_in">notrt</span>(x))&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">notrt</span>(fa[x]))</span><br><span class="line">                <span class="built_in">rot</span>((<span class="built_in">jpos</span>(fa[x])==<span class="built_in">jpos</span>(x))?fa[x]:x);</span><br><span class="line">            <span class="built_in">rot</span>(x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">access</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> y=<span class="number">0</span>;x;y=x,x=fa[x])&#123;</span><br><span class="line">            <span class="built_in">splay</span>(x); ch[x][<span class="number">1</span>]=y;</span><br><span class="line">            <span class="built_in">pushup</span>(x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">findrt</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="built_in">access</span>(x); <span class="built_in">splay</span>(x);</span><br><span class="line">        <span class="keyword">for</span>(;ch[x][<span class="number">0</span>];x=ch[x][<span class="number">0</span>])</span><br><span class="line">            <span class="built_in">pushdown</span>(x);</span><br><span class="line">        <span class="built_in">splay</span>(x);</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">makert</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="built_in">access</span>(x); <span class="built_in">splay</span>(x);</span><br><span class="line">        laz[x]^=<span class="number">1</span>; <span class="built_in">swap</span>(ch[x][<span class="number">0</span>],ch[x][<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">split</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">        <span class="built_in">makert</span>(x); <span class="built_in">access</span>(y); <span class="built_in">splay</span>(y);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">link</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">        <span class="built_in">makert</span>(x);</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">findrt</span>(y)!=x) fa[x]=y;</span><br><span class="line">        <span class="built_in">access</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">cut</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">        <span class="built_in">makert</span>(x);</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">findrt</span>(y)!=x) <span class="keyword">return</span> ;</span><br><span class="line">        <span class="keyword">if</span>(fa[y]==x&amp;&amp;!ch[y][<span class="number">0</span>])&#123;</span><br><span class="line">            fa[y]=ch[x][<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">pushup</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;T;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;1.txt&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;2.txt&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="type">int</span> t1,t2,t3;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;k[i]);</span><br><span class="line">        T.<span class="built_in">link</span>(i,<span class="built_in">min</span>(i+k[i],n+<span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;m);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;++i)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;t1,&amp;t2);</span><br><span class="line">        ++t2;</span><br><span class="line">        <span class="keyword">if</span>(t1==<span class="number">1</span>)&#123;</span><br><span class="line">            T.<span class="built_in">split</span>(t2,n+<span class="number">1</span>);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,T.sz[n+<span class="number">1</span>]<span class="number">-1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;t3);</span><br><span class="line">            T.<span class="built_in">cut</span>(t2,<span class="built_in">min</span>(t2+k[t2],n+<span class="number">1</span>));</span><br><span class="line">            T.<span class="built_in">link</span>(t2,<span class="built_in">min</span>(t2+t3,n+<span class="number">1</span>));</span><br><span class="line">            k[t2]=t3;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="p4299-首都"><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4299">P4299 首都</a></h2>
<p>需要维护一个点侧枝的子树大小。。。在LCT上二分</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> dd double</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod 998244353</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> maxn=<span class="number">100006</span>;</span><br><span class="line"><span class="type">int</span> n,m,xors,fa[maxn];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">fin</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (fa[x]==x)?x:(fa[x]=<span class="built_in">fin</span>(fa[x]));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LCA</span>&#123;</span><br><span class="line">    <span class="type">int</span> fa[maxn],s[maxn],si[maxn],ch[maxn][<span class="number">2</span>],laz[maxn],sta[maxn],he;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pushup</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(x) s[x]=s[ch[x][<span class="number">0</span>]]+s[ch[x][<span class="number">1</span>]]+si[x]+<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pushdown</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(laz[x])&#123;</span><br><span class="line">            laz[x]=<span class="number">0</span>; laz[ch[x][<span class="number">0</span>]]^=<span class="number">1</span>; laz[ch[x][<span class="number">1</span>]]^=<span class="number">1</span>;</span><br><span class="line">            <span class="type">int</span> tmp=ch[x][<span class="number">0</span>]; <span class="built_in">swap</span>(ch[tmp][<span class="number">0</span>],ch[tmp][<span class="number">1</span>]);</span><br><span class="line">            tmp=ch[x][<span class="number">1</span>]; <span class="built_in">swap</span>(ch[tmp][<span class="number">0</span>],ch[tmp][<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">jpos</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ch[fa[x]][<span class="number">1</span>]==x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">notrt</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (ch[fa[x]][<span class="number">0</span>]==x)||(ch[fa[x]][<span class="number">1</span>]==x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">rot</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="type">int</span> y=fa[x],z=fa[y],k=<span class="built_in">jpos</span>(x),c=ch[x][k^<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">notrt</span>(y)) ch[z][<span class="built_in">jpos</span>(y)]=x; ch[x][k^<span class="number">1</span>]=y; ch[y][k]=c;</span><br><span class="line">        <span class="keyword">if</span>(c) fa[c]=y; fa[y]=x; fa[x]=z;</span><br><span class="line">        <span class="built_in">pushup</span>(y); <span class="built_in">pushup</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">splay</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        he=<span class="number">0</span>;</span><br><span class="line">        sta[++he]=x;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> y=x;<span class="built_in">notrt</span>(y);y=fa[y]) sta[++he]=fa[y];</span><br><span class="line">        <span class="keyword">while</span>(he) <span class="built_in">pushdown</span>(sta[he--]);</span><br><span class="line">        <span class="keyword">while</span>(<span class="built_in">notrt</span>(x))&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">notrt</span>(fa[x])) <span class="built_in">rot</span>((<span class="built_in">jpos</span>(x)==<span class="built_in">jpos</span>(fa[x]))?fa[x]:x);</span><br><span class="line">            <span class="built_in">rot</span>(x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">access</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> y=<span class="number">0</span>;x;y=x,x=fa[x])&#123;</span><br><span class="line">            <span class="built_in">splay</span>(x);</span><br><span class="line">            si[x]+=s[ch[x][<span class="number">1</span>]]; si[x]-=s[y];</span><br><span class="line">            ch[x][<span class="number">1</span>]=y; <span class="built_in">pushup</span>(x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">makert</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="built_in">access</span>(x); <span class="built_in">splay</span>(x);</span><br><span class="line">        laz[x]^=<span class="number">1</span>; <span class="built_in">swap</span>(ch[x][<span class="number">0</span>],ch[x][<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">split</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">        <span class="built_in">makert</span>(x); <span class="built_in">access</span>(y); <span class="built_in">splay</span>(y);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">link</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">        <span class="built_in">split</span>(x,y); fa[x]=y; si[y]+=s[x];</span><br><span class="line">        <span class="built_in">pushup</span>(y);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">upd</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="type">int</span> allsiz=s[x],rnum=<span class="number">0</span>,lnum=<span class="number">0</span>,ans=<span class="number">1e9</span>;</span><br><span class="line">        <span class="keyword">while</span>(x)&#123;</span><br><span class="line">            <span class="built_in">pushdown</span>(x);</span><br><span class="line">            <span class="keyword">if</span>(lnum+s[ch[x][<span class="number">0</span>]]&lt;=allsiz/<span class="number">2</span>&amp;&amp;rnum+s[ch[x][<span class="number">1</span>]]&lt;=allsiz/<span class="number">2</span>)&#123;</span><br><span class="line">                ans=<span class="built_in">min</span>(ans,x);</span><br><span class="line">                <span class="keyword">if</span>(allsiz&amp;<span class="number">1</span>) <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(lnum+s[ch[x][<span class="number">0</span>]]&gt;rnum+s[ch[x][<span class="number">1</span>]])&#123;</span><br><span class="line">                rnum+=(si[x]+<span class="number">1</span>+s[ch[x][<span class="number">1</span>]]); x=ch[x][<span class="number">0</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                lnum+=(si[x]+<span class="number">1</span>+s[ch[x][<span class="number">0</span>]]); x=ch[x][<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;T;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;1.txt&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;2.txt&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="type">int</span> t1,t2; <span class="type">char</span> opt[<span class="number">10</span>];</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">    xors=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123;</span><br><span class="line">        fa[i]=i; T.s[i]=<span class="number">1</span>;</span><br><span class="line">        xors^=i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;++i)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,opt+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span>(opt[<span class="number">1</span>]==<span class="string">&#x27;Q&#x27;</span>)&#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;t1);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">fin</span>(t1));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(opt[<span class="number">1</span>]==<span class="string">&#x27;X&#x27;</span>)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,xors);</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;t1,&amp;t2);</span><br><span class="line">            <span class="type">int</span> x=<span class="built_in">fin</span>(t1),y=<span class="built_in">fin</span>(t2),z;</span><br><span class="line">            T.<span class="built_in">link</span>(t1,t2);</span><br><span class="line">            T.<span class="built_in">split</span>(x,y);</span><br><span class="line">            z=T.<span class="built_in">upd</span>(y);</span><br><span class="line">            fa[x]=fa[y]=fa[z]=z;</span><br><span class="line">            xors^=(x^y^z);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="sp2939-qtree5---query-on-a-tree-v"><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/SP2939">SP2939 QTREE5 - Query on
a tree V</a></h2>
<h1 id="树的性质">树的性质</h1>
<h2 id="重心">重心</h2>
<figure>
<img src="/1970/01/01/banzi/未命名图片_1.png" alt="未命名图片">
<figcaption aria-hidden="true">未命名图片</figcaption>
</figure>
<h1 id="扩展域并查集">扩展域并查集</h1>
<h2 id="e.-prefix-enlightenment"><a target="_blank" rel="noopener" href="https://vjudge.net/problem/CodeForces-1291E/origin">E. Prefix
Enlightenment</a></h2>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 300006</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> dd double</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod 998244353</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> n,m,ch[N][<span class="number">2</span>];</span><br><span class="line"><span class="type">char</span> s[N];</span><br><span class="line"><span class="type">int</span> fa[N&lt;&lt;<span class="number">1</span>],sz[N&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">fin</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (fa[x]==x)?x:(fa[x]=<span class="built_in">fin</span>(fa[x]));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">uni</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> rx=<span class="built_in">fin</span>(x),ry=<span class="built_in">fin</span>(y);</span><br><span class="line">    <span class="keyword">if</span>(!rx) <span class="built_in">swap</span>(rx,ry);</span><br><span class="line">    <span class="keyword">if</span>(ry) sz[ry]+=sz[rx];</span><br><span class="line">    fa[rx]=ry;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">calc</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> rx=<span class="built_in">fin</span>(x),ry=<span class="built_in">fin</span>(x+m);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">min</span>(sz[rx],sz[ry]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;1.txt&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;2.txt&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="type">int</span> t1,t2;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%s&quot;</span>,&amp;n,&amp;m,s+<span class="number">1</span>);</span><br><span class="line">    sz[<span class="number">0</span>]=<span class="number">1e9</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;++i)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;t1);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=t1;++j)&#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;t2);</span><br><span class="line">            <span class="keyword">if</span>(ch[t2][<span class="number">0</span>]) ch[t2][<span class="number">1</span>]=i;</span><br><span class="line">            <span class="keyword">else</span> ch[t2][<span class="number">0</span>]=i;</span><br><span class="line">        &#125;</span><br><span class="line">        sz[i]=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=(m&lt;&lt;<span class="number">1</span>);++i) fa[i]=i;</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123;</span><br><span class="line">        <span class="type">int</span> x,y,rx,ry,rxm,rym;</span><br><span class="line">        x=ch[i][<span class="number">0</span>]; y=ch[i][<span class="number">1</span>];</span><br><span class="line">        rx=<span class="built_in">fin</span>(x); rxm=<span class="built_in">fin</span>(x+m);</span><br><span class="line">        ry=<span class="built_in">fin</span>(y); rym=<span class="built_in">fin</span>(y+m);</span><br><span class="line">        <span class="keyword">if</span>(!y)&#123;</span><br><span class="line">            ans-=<span class="built_in">calc</span>(x);</span><br><span class="line">            <span class="keyword">if</span>(s[i]==<span class="string">&#x27;0&#x27;</span>) fa[rxm]=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span> fa[rx]=<span class="number">0</span>;</span><br><span class="line">            ans+=<span class="built_in">calc</span>(x);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(s[i]==<span class="string">&#x27;0&#x27;</span>&amp;&amp;rx!=rym)&#123;</span><br><span class="line">            ans-=<span class="built_in">calc</span>(x); ans-=<span class="built_in">calc</span>(y);</span><br><span class="line">            <span class="built_in">uni</span>(rx,rym); <span class="built_in">uni</span>(ry,rxm);</span><br><span class="line">            ans+=<span class="built_in">calc</span>(x);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(s[i]==<span class="string">&#x27;1&#x27;</span>&amp;&amp;rx!=ry)&#123;</span><br><span class="line">            ans-=<span class="built_in">calc</span>(x); ans-=<span class="built_in">calc</span>(y);</span><br><span class="line">            <span class="built_in">uni</span>(rx,ry); <span class="built_in">uni</span>(rxm,rym);</span><br><span class="line">            ans+=<span class="built_in">calc</span>(x);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="p1525-noip2010-提高组-关押罪犯">[P1525 <a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1525">NOIP2010 提高组]
关押罪犯</a></h2>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 100006</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> dd double</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod 998244353</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> n,m;</span><br><span class="line"><span class="type">int</span> a[N],b[N],c[N],ind[N];</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span><span class="params">(<span class="type">int</span> t1,<span class="type">int</span> t2)</span></span>&#123;<span class="keyword">return</span> c[t1]&gt;c[t2];&#125;</span><br><span class="line"><span class="type">int</span> fa[N&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">fin</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (fa[x]==x)?x:(fa[x]=<span class="built_in">fin</span>(fa[x]));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">uni</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> rx=<span class="built_in">fin</span>(x),ry=<span class="built_in">fin</span>(y);</span><br><span class="line">    <span class="keyword">if</span>(rx!=ry) fa[rx]=ry;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;1.txt&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;2.txt&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;++i)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;a[i],&amp;b[i],&amp;c[i]);</span><br><span class="line">        ind[i]=i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=(n&lt;&lt;<span class="number">1</span>);++i) fa[i]=i;</span><br><span class="line">    <span class="built_in">sort</span>(ind+<span class="number">1</span>,ind+<span class="number">1</span>+m,cmp);</span><br><span class="line">    <span class="type">int</span> fla=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;++i)&#123;</span><br><span class="line">        <span class="type">int</span> x=a[ind[i]],y=b[ind[i]];</span><br><span class="line">        <span class="type">int</span> rx,ry,rxn,ryn;</span><br><span class="line">        rx=<span class="built_in">fin</span>(x); ry=<span class="built_in">fin</span>(y);</span><br><span class="line">        rxn=<span class="built_in">fin</span>(x+n); ryn=<span class="built_in">fin</span>(y+n);</span><br><span class="line">        <span class="keyword">if</span>(rx==ry||rxn==ryn)&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,c[ind[i]]);</span><br><span class="line">            fla=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(rx==ryn) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">uni</span>(rx,ryn); <span class="built_in">uni</span>(ry,rxn);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!fla) <span class="built_in">printf</span>(<span class="string">&quot;0\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="p2024-noi2001-食物链">[P2024 <a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2024">NOI2001] 食物链</a></h2>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 100006</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> dd double</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod 998244353</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> n,m;</span><br><span class="line"><span class="type">int</span> fa[N*<span class="number">3</span>];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">fin</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (fa[x]==x)?x:(fa[x]=<span class="built_in">fin</span>(fa[x]));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">uni</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> rx=<span class="built_in">fin</span>(x),ry=<span class="built_in">fin</span>(y);</span><br><span class="line">    <span class="keyword">if</span>(rx!=ry) fa[rx]=ry;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;1.txt&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;2.txt&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="type">int</span> t1,t2,t3,ans=<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=n*<span class="number">3</span>;i;--i) fa[i]=i;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;++i)&#123;</span><br><span class="line">        <span class="type">int</span> x,y,rx,rx1,rx2,ry,ry1,ry2; <span class="comment">// self enemy eat</span></span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;t1,&amp;t2,&amp;t3);</span><br><span class="line">        <span class="keyword">if</span>(t2&gt;n||t3&gt;n)&#123;++ans;<span class="keyword">continue</span>;&#125;</span><br><span class="line">        x=t2; y=t3; rx=<span class="built_in">fin</span>(x); rx1=<span class="built_in">fin</span>(x+n); rx2=<span class="built_in">fin</span>(x+(n&lt;&lt;<span class="number">1</span>));</span><br><span class="line">        ry=<span class="built_in">fin</span>(y); ry1=<span class="built_in">fin</span>(y+n); ry2=<span class="built_in">fin</span>(y+(n&lt;&lt;<span class="number">1</span>));</span><br><span class="line">        <span class="keyword">if</span>(t1==<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(rx==ry2||ry==rx2)&#123;++ans;<span class="keyword">continue</span>;&#125;</span><br><span class="line">            <span class="built_in">uni</span>(rx,ry); <span class="built_in">uni</span>(rx1,ry1); <span class="built_in">uni</span>(rx2,ry2);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(rx==ry||ry2==rx||rx1==ry)&#123;++ans;<span class="keyword">continue</span>;&#125;</span><br><span class="line">            <span class="built_in">uni</span>(rx2,ry); <span class="built_in">uni</span>(ry1,rx); <span class="built_in">uni</span>(rx1,ry2);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="边带权并查集">边带权并查集</h1>
<h2 id="p1196-noi2002-银河英雄传说">[P1196 <a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1196">NOI2002]
银河英雄传说</a></h2>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 30006</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> dd double</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod 998244353</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> fa[N],sz[N],d[N],T;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">30000</span>;++i) sz[i]=<span class="number">1</span>,fa[i]=i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">fin</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(fa[x]==x) <span class="keyword">return</span> x;</span><br><span class="line">    <span class="type">int</span> tmp=<span class="built_in">fin</span>(fa[x]);</span><br><span class="line">    d[x]+=d[fa[x]];</span><br><span class="line">    <span class="keyword">return</span> fa[x]=tmp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">uni</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> rx=<span class="built_in">fin</span>(x),ry=<span class="built_in">fin</span>(y);</span><br><span class="line">    d[rx]+=sz[ry];</span><br><span class="line">    sz[ry]+=sz[rx];</span><br><span class="line">    fa[rx]=ry;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;1.txt&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;2.txt&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">Init</span>();</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;T);</span><br><span class="line">    <span class="keyword">while</span>(T--)&#123;</span><br><span class="line">        <span class="type">char</span> s[<span class="number">10</span>]; <span class="type">int</span> t1,t2;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s%d%d&quot;</span>,s+<span class="number">1</span>,&amp;t1,&amp;t2);</span><br><span class="line">        <span class="keyword">if</span>(s[<span class="number">1</span>]==<span class="string">&#x27;M&#x27;</span>)&#123;</span><br><span class="line">            <span class="built_in">uni</span>(<span class="built_in">fin</span>(t1),<span class="built_in">fin</span>(t2));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="type">int</span> rx=<span class="built_in">fin</span>(t1),ry=<span class="built_in">fin</span>(t2);</span><br><span class="line">            <span class="keyword">if</span>(rx!=ry) <span class="built_in">printf</span>(<span class="string">&quot;-1\n&quot;</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">abs</span>(d[t1]-d[t2])<span class="number">-1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="虚树">虚树</h1>
<h2 id="sdoi2011消耗战"><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2495">SDOI2011]消耗战</a></h2>
<p>虚数模板。。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 250006</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> dd double</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> ll mod=<span class="number">998244353</span>;</span><br><span class="line"><span class="type">int</span> n,m,dfn[N],st[N][<span class="number">21</span>],stmin[N][<span class="number">21</span>],tim,dep[N],sou[N],num;</span><br><span class="line"><span class="type">bool</span> fla[N];</span><br><span class="line"><span class="type">int</span> head[N],cnt,nxt[N&lt;&lt;<span class="number">1</span>],v[N&lt;&lt;<span class="number">1</span>],val[N&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> t1,<span class="type">int</span> t2,<span class="type">int</span> t3)</span></span>&#123;</span><br><span class="line">    ++cnt;</span><br><span class="line">    nxt[cnt]=head[t1];</span><br><span class="line">    head[t1]=cnt;</span><br><span class="line">    v[cnt]=t2;</span><br><span class="line">    val[cnt]=t3;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs1</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> ff)</span></span>&#123;</span><br><span class="line">    dfn[x]=++tim;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=head[x];i;i=nxt[i])</span><br><span class="line">        <span class="keyword">if</span>(v[i]!=ff)&#123;</span><br><span class="line">            st[v[i]][<span class="number">0</span>]=x;</span><br><span class="line">            stmin[v[i]][<span class="number">0</span>]=val[i];</span><br><span class="line">            dep[v[i]]=dep[x]+<span class="number">1</span>;</span><br><span class="line">            <span class="built_in">dfs1</span>(v[i],x);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(st,<span class="number">-1</span>,<span class="built_in">sizeof</span>(st));</span><br><span class="line">    <span class="built_in">memset</span>(stmin,<span class="number">127</span>,<span class="built_in">sizeof</span>(stmin));</span><br><span class="line">    <span class="built_in">dfs1</span>(<span class="number">1</span>,<span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;<span class="number">21</span>;++j)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123;</span><br><span class="line">            <span class="keyword">if</span>(st[i][j<span class="number">-1</span>]!=<span class="number">-1</span>) st[i][j]=st[st[i][j<span class="number">-1</span>]][j<span class="number">-1</span>],stmin[i][j]=<span class="built_in">min</span>(stmin[i][j<span class="number">-1</span>],stmin[st[i][j<span class="number">-1</span>]][j<span class="number">-1</span>]);</span><br><span class="line">            <span class="keyword">else</span> st[i][j]=<span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span><span class="params">(<span class="type">int</span> t1,<span class="type">int</span> t2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> dfn[t1]&lt;dfn[t2];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">LCA</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(dep[x]&lt;dep[y]) <span class="built_in">swap</span>(x,y);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">20</span>;j&gt;=<span class="number">0</span>;--j)</span><br><span class="line">        <span class="keyword">if</span>(st[x][j]!=<span class="number">-1</span>&amp;&amp;dep[st[x][j]]&gt;=dep[y])</span><br><span class="line">            x=st[x][j];</span><br><span class="line">    <span class="keyword">if</span>(x==y) <span class="keyword">return</span> x;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">20</span>;j&gt;=<span class="number">0</span>;--j)</span><br><span class="line">        <span class="keyword">if</span>(st[x][j]!=<span class="number">-1</span>&amp;&amp;st[x][j]!=st[y][j])</span><br><span class="line">            x=st[x][j],y=st[y][j];</span><br><span class="line">    <span class="keyword">return</span> st[x][<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">LCAMIN</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">1e9</span>;</span><br><span class="line">    <span class="keyword">if</span>(dep[x]&lt;dep[y]) <span class="built_in">swap</span>(x,y);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">20</span>;j&gt;=<span class="number">0</span>;--j)</span><br><span class="line">        <span class="keyword">if</span>(st[x][j]!=<span class="number">-1</span>&amp;&amp;dep[st[x][j]]&gt;=dep[y])</span><br><span class="line">            res=<span class="built_in">min</span>(res,stmin[x][j]),x=st[x][j];</span><br><span class="line">    <span class="keyword">if</span>(x==y) <span class="keyword">return</span> res;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">20</span>;j&gt;=<span class="number">0</span>;--j)</span><br><span class="line">        <span class="keyword">if</span>(st[x][j]!=<span class="number">-1</span>&amp;&amp;st[x][j]!=st[y][j])</span><br><span class="line">            res=<span class="built_in">min</span>(res,<span class="built_in">min</span>(stmin[x][j],stmin[y][j])),x=st[x][j],y=st[y][j];</span><br><span class="line">    res=<span class="built_in">min</span>(res,stmin[x][<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> sta[N],he,whitocl[N],he2;</span><br><span class="line">ll dp[N];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; g[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> len=g[x].<span class="built_in">size</span>(); dp[x]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;++i)&#123;</span><br><span class="line">        <span class="type">int</span> thiv=<span class="built_in">LCAMIN</span>(x,g[x][i]);</span><br><span class="line">        <span class="built_in">dfs</span>(g[x][i]);</span><br><span class="line">        <span class="keyword">if</span>(fla[g[x][i]]) dp[x]+=thiv;</span><br><span class="line">        <span class="keyword">else</span> dp[x]+=<span class="built_in">min</span>(<span class="number">1ll</span>*thiv,dp[g[x][i]]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">sort</span>(sou+<span class="number">1</span>,sou+<span class="number">1</span>+num,cmp);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=num;++i) fla[sou[i]]=<span class="number">1</span>;</span><br><span class="line">    he=he2=<span class="number">0</span>; sta[++he]=<span class="number">1</span>; whitocl[++he2]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=num;++i)&#123;</span><br><span class="line">        <span class="type">int</span> lca=<span class="built_in">LCA</span>(sou[i],sta[he]);</span><br><span class="line">        <span class="keyword">while</span>(he&amp;&amp;dep[sta[he]]&gt;dep[lca])&#123;</span><br><span class="line">            <span class="type">int</span> ff=dep[lca]&gt;dep[sta[he<span class="number">-1</span>]]?lca:sta[he<span class="number">-1</span>];</span><br><span class="line">            g[ff].<span class="built_in">emplace_back</span>(sta[he--]); whitocl[++he2]=ff;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(dep[lca]&gt;dep[sta[he]]) sta[++he]=lca; sta[++he]=sou[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(he&gt;<span class="number">1</span>) g[sta[he<span class="number">-1</span>]].<span class="built_in">emplace_back</span>(sta[he--]),whitocl[++he2]=sta[he];</span><br><span class="line">    <span class="built_in">dfs</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=num;++i) fla[sou[i]]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=he2;++i)</span><br><span class="line">        <span class="keyword">if</span>(g[whitocl[i]].<span class="built_in">size</span>())</span><br><span class="line">            g[whitocl[i]].<span class="built_in">clear</span>();</span><br><span class="line">    <span class="keyword">return</span> dp[<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;1.txt&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;2.txt&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;++i)&#123;</span><br><span class="line">        <span class="type">int</span> t1,t2,t3;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;t1,&amp;t2,&amp;t3);</span><br><span class="line">        <span class="built_in">add</span>(t1,t2,t3);</span><br><span class="line">        <span class="built_in">add</span>(t2,t1,t3);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">Init</span>();</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;m);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;++i)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;num);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=num;++j) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;sou[j]);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,<span class="built_in">solve</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="g.-yet-another-lcp-problem"><a target="_blank" rel="noopener" href="https://codeforces.com/contest/1073/problem/G">G. Yet Another LCP
Problem</a></h2>
<p>把串反过来建一个sam，原串的两个后缀的最长前缀就是sam中对应两个节点的LCA</p>
<p>根据每次询问给出的两个点集建出来对应parent树的虚树，然后在虚树上dp就行了</p>
<p>lca的length就是lcp的大小，对于每个点维护一下子树中两个集合点的个数，算一下。。。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 400006</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> dd double</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> ll mod=<span class="number">998244353</span>;</span><br><span class="line"><span class="type">int</span> pos[N];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; g[N],g2[N];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SAM</span>&#123;</span><br><span class="line">    <span class="type">int</span> link[N],ch[N][<span class="number">26</span>],cnt,len[N],las;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Init</span><span class="params">()</span></span>&#123;</span><br><span class="line">        las=<span class="number">0</span>;</span><br><span class="line">        cnt=<span class="number">1</span>;</span><br><span class="line">        link[<span class="number">0</span>]=<span class="number">-1</span>;</span><br><span class="line">        <span class="built_in">memset</span>(ch[<span class="number">0</span>],<span class="number">0</span>,<span class="built_in">sizeof</span>(ch[<span class="number">0</span>]));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> poss,<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="type">int</span> now=cnt++; pos[poss]=cnt<span class="number">-1</span>;</span><br><span class="line">        len[now]=len[las]+<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> p=las;</span><br><span class="line">        <span class="keyword">while</span>(p!=<span class="number">-1</span>&amp;&amp;!ch[p][x])&#123;</span><br><span class="line">            ch[p][x]=now;</span><br><span class="line">            p=link[p];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(p==<span class="number">-1</span>) link[now]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="type">int</span> q=ch[p][x];</span><br><span class="line">            <span class="keyword">if</span>(len[q]==len[p]+<span class="number">1</span>) link[now]=q;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="type">int</span> clone=cnt++;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">26</span>;++i) ch[clone][i]=ch[q][i];</span><br><span class="line">                len[clone]=len[p]+<span class="number">1</span>;</span><br><span class="line">                link[clone]=link[q];</span><br><span class="line">                link[q]=link[now]=clone;</span><br><span class="line">                <span class="keyword">while</span>(p!=<span class="number">-1</span>&amp;&amp;ch[p][x]==q)&#123;</span><br><span class="line">                    ch[p][x]=clone;</span><br><span class="line">                    p=link[p];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        las=now;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;cnt;++i)</span><br><span class="line">            <span class="keyword">if</span>(link[i]!=<span class="number">-1</span>)</span><br><span class="line">                g[link[i]].<span class="built_in">emplace_back</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;sam;</span><br><span class="line"><span class="type">int</span> n,q,seta[N],setb[N],dep[N],dfn[N],tim,st[N][<span class="number">21</span>],dpa[N],dpb[N];</span><br><span class="line"><span class="type">char</span> s[N];</span><br><span class="line"><span class="type">bool</span> visa[N],visb[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs1</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    dfn[x]=++tim; <span class="type">int</span> len=g[x].<span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;++i)&#123;</span><br><span class="line">        dep[g[x][i]]=dep[x]+<span class="number">1</span>;</span><br><span class="line">        st[g[x][i]][<span class="number">0</span>]=x;</span><br><span class="line">        <span class="built_in">dfs1</span>(g[x][i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> sta[N],sta2[N],he,he2,vec[N],tot;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span><span class="params">(<span class="type">int</span> t1,<span class="type">int</span> t2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> dfn[t1]&lt;dfn[t2];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(st,<span class="number">-1</span>,<span class="built_in">sizeof</span>(st));</span><br><span class="line">    <span class="built_in">dfs1</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;<span class="number">21</span>;++j)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;sam.cnt;++i)&#123;</span><br><span class="line">            <span class="keyword">if</span>(st[i][j<span class="number">-1</span>]!=<span class="number">-1</span>) st[i][j]=st[st[i][j<span class="number">-1</span>]][j<span class="number">-1</span>];</span><br><span class="line">            <span class="keyword">else</span> st[i][j]=<span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">LCA</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(dep[x]&lt;dep[y]) <span class="built_in">swap</span>(x,y);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">20</span>;j&gt;=<span class="number">0</span>;--j)</span><br><span class="line">        <span class="keyword">if</span>(st[x][j]!=<span class="number">-1</span>&amp;&amp;dep[st[x][j]]&gt;=dep[y])</span><br><span class="line">            x=st[x][j];</span><br><span class="line">    <span class="keyword">if</span>(x==y) <span class="keyword">return</span> x;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">20</span>;j&gt;=<span class="number">0</span>;--j)</span><br><span class="line">        <span class="keyword">if</span>(st[x][j]!=<span class="number">-1</span>&amp;&amp;st[x][j]!=st[y][j])</span><br><span class="line">            x=st[x][j],y=st[y][j];</span><br><span class="line">    <span class="keyword">return</span> st[x][<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line">ll ans;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> len=g2[x].<span class="built_in">size</span>();</span><br><span class="line">    dpa[x]=visa[x]; dpb[x]=visb[x];</span><br><span class="line">    <span class="keyword">if</span>(visa[x]&amp;&amp;visb[x]) ans+=<span class="number">1ll</span>*sam.len[x];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;++i)&#123;</span><br><span class="line">        <span class="built_in">dfs</span>(g2[x][i]);</span><br><span class="line">        ans+=<span class="number">1ll</span>*sam.len[x]*dpa[g2[x][i]]*dpb[x];</span><br><span class="line">        ans+=<span class="number">1ll</span>*sam.len[x]*dpb[g2[x][i]]*dpa[x];</span><br><span class="line">        dpa[x]+=dpa[g2[x][i]];</span><br><span class="line">        dpb[x]+=dpb[g2[x][i]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> sza,szb; <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;sza,&amp;szb); tot=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=sza;++i) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;seta[i]),visa[pos[seta[i]]]=<span class="number">1</span>,vec[++tot]=pos[seta[i]];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=szb;++i) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;setb[i]),visb[pos[setb[i]]]=<span class="number">1</span>,vec[++tot]=pos[setb[i]];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=he2;++i) g2[sta2[i]].<span class="built_in">clear</span>(),dpa[sta2[i]]=<span class="number">0</span>,dpb[sta2[i]]=<span class="number">0</span>;</span><br><span class="line">    he=he2=<span class="number">0</span>; <span class="built_in">sort</span>(vec+<span class="number">1</span>,vec+<span class="number">1</span>+tot);</span><br><span class="line">    tot=<span class="built_in">unique</span>(vec+<span class="number">1</span>,vec+<span class="number">1</span>+tot)-vec<span class="number">-1</span>;</span><br><span class="line">    <span class="built_in">sort</span>(vec+<span class="number">1</span>,vec+<span class="number">1</span>+tot,cmp);</span><br><span class="line">    sta[++he]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=tot;++i)&#123;</span><br><span class="line">        <span class="type">int</span> lca=<span class="built_in">LCA</span>(sta[he],vec[i]);</span><br><span class="line">        <span class="keyword">while</span>(he&amp;&amp;dep[lca]&lt;dep[sta[he]])&#123;</span><br><span class="line">            <span class="type">int</span> ff=dep[lca]&gt;dep[sta[he<span class="number">-1</span>]]?lca:sta[he<span class="number">-1</span>];</span><br><span class="line">            g2[ff].<span class="built_in">emplace_back</span>(sta[he--]); sta2[++he2]=ff;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(dep[lca]&gt;dep[sta[he]]) sta[++he]=lca; sta[++he]=vec[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(he&gt;=<span class="number">2</span>) g2[sta[he<span class="number">-1</span>]].<span class="built_in">emplace_back</span>(sta[he--]),sta2[++he2]=sta[he];</span><br><span class="line">    ans=<span class="number">0</span>; <span class="built_in">dfs</span>(<span class="number">0</span>); <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=sza;++i) visa[pos[seta[i]]]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=szb;++i) visb[pos[setb[i]]]=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;1.txt&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;2.txt&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%s&quot;</span>,&amp;n,&amp;q,s+<span class="number">1</span>);</span><br><span class="line">    sam.<span class="built_in">Init</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=n;i;--i) sam.<span class="built_in">insert</span>(i,s[i]-<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">    sam.<span class="built_in">build</span>();</span><br><span class="line">    <span class="built_in">Init</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=q;++i) <span class="built_in">solve</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="p4426-hnoiahoi2018毒瘤"><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4426">P4426
[HNOI/AHOI2018]毒瘤</a></h2>
<p>求稀疏图的独立集个数</p>
<p>边数很少，拉出来一棵树，对非树边涉及的关键点枚举状态，对关键点建虚树，预处理虚树上一个点选还是不选对其父亲选还是不选的贡献，暴搜关键点状态+虚树上DP</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 100006</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ull unsigned long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> dd double</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> mod=<span class="number">998244353</span>;</span><br><span class="line"><span class="type">int</span> n,m;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; g[N],g2[N],g3[N];</span><br><span class="line"><span class="type">int</span> fa[N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">fin</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;<span class="keyword">return</span> (fa[x]==x)?x:(fa[x]=<span class="built_in">fin</span>(fa[x]));&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">uni</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;fa[<span class="built_in">fin</span>(x)]=<span class="built_in">fin</span>(y);&#125;</span><br><span class="line"><span class="type">bool</span> lefvec[N],vir[N];</span><br><span class="line"><span class="type">int</span> st[N][<span class="number">25</span>],dep[N],dfn[N],tim,sou[N],vnum,numvir[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs1</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> ff)</span></span>&#123;</span><br><span class="line">    dfn[x]=++tim;</span><br><span class="line">    <span class="type">int</span> len=g[x].<span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;++i)</span><br><span class="line">        <span class="keyword">if</span>(g[x][i]!=ff)&#123;</span><br><span class="line">            dep[g[x][i]]=dep[x]+<span class="number">1</span>;</span><br><span class="line">            st[g[x][i]][<span class="number">0</span>]=x;</span><br><span class="line">            <span class="built_in">dfs1</span>(g[x][i],x);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs11</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> ff)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> len=g[x].<span class="built_in">size</span>(); numvir[x]=vir[x];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;++i)</span><br><span class="line">        <span class="keyword">if</span>(g[x][i]!=ff)&#123;</span><br><span class="line">            <span class="built_in">dfs11</span>(g[x][i],x);</span><br><span class="line">            numvir[x]+=numvir[g[x][i]];</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">LCA</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(dep[x]&lt;dep[y]) <span class="built_in">swap</span>(x,y);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">24</span>;j&gt;=<span class="number">0</span>;--j) <span class="keyword">if</span>(st[x][j]!=<span class="number">-1</span>&amp;&amp;dep[st[x][j]]&gt;=dep[y])</span><br><span class="line">        x=st[x][j];</span><br><span class="line">    <span class="keyword">if</span>(x==y) <span class="keyword">return</span> x;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">24</span>;j&gt;=<span class="number">0</span>;--j) <span class="keyword">if</span>(st[x][j]!=<span class="number">-1</span>&amp;&amp;st[x][j]!=st[y][j])</span><br><span class="line">        x=st[x][j],y=st[y][j];</span><br><span class="line">    <span class="keyword">return</span> st[x][<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(st,<span class="number">-1</span>,<span class="built_in">sizeof</span>(st)); <span class="built_in">dfs1</span>(<span class="number">1</span>,<span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;<span class="number">25</span>;++j) <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)</span><br><span class="line">        <span class="keyword">if</span>(st[i][j<span class="number">-1</span>]!=<span class="number">-1</span>) st[i][j]=st[st[i][j<span class="number">-1</span>]][j<span class="number">-1</span>];</span><br><span class="line">        <span class="keyword">else</span> st[i][j]=<span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span><span class="params">(<span class="type">int</span> t1,<span class="type">int</span> t2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> dfn[t1]&lt;dfn[t2];</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> sta[<span class="number">1000</span>],he;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i) <span class="keyword">if</span>(lefvec[i]) sou[++vnum]=i;</span><br><span class="line">    <span class="built_in">sort</span>(sou+<span class="number">1</span>,sou+<span class="number">1</span>+vnum,cmp);</span><br><span class="line">    he=<span class="number">0</span>; sta[++he]=<span class="number">1</span>; vir[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=vnum;++i)&#123;</span><br><span class="line">        <span class="keyword">if</span>(sou[i]==<span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="type">int</span> lca=<span class="built_in">LCA</span>(sou[i],sta[he]);</span><br><span class="line">        <span class="keyword">while</span>(he&amp;&amp;dep[sta[he]]&gt;dep[lca])&#123;</span><br><span class="line">            <span class="type">int</span> ff=dep[lca]&gt;dep[sta[he<span class="number">-1</span>]]?lca:sta[he<span class="number">-1</span>];</span><br><span class="line">            g2[ff].<span class="built_in">emplace_back</span>(sta[he--]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(dep[lca]&gt;dep[sta[he]]) sta[++he]=lca,vir[sta[he]]=<span class="number">1</span>;</span><br><span class="line">        sta[++he]=sou[i]; vir[sta[he]]=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(he&gt;=<span class="number">2</span>) g2[sta[he<span class="number">-1</span>]].<span class="built_in">emplace_back</span>(sta[he--]);</span><br><span class="line">    <span class="built_in">dfs11</span>(<span class="number">1</span>,<span class="number">-1</span>);</span><br><span class="line">&#125;</span><br><span class="line">ll dp[N][<span class="number">2</span>],k[N][<span class="number">2</span>][<span class="number">2</span>],dp2[N][<span class="number">2</span>],f[N][<span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs2</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> ff)</span></span>&#123;</span><br><span class="line">    dp[x][<span class="number">0</span>]=dp[x][<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> len=g[x].<span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;++i)</span><br><span class="line">        <span class="keyword">if</span>(g[x][i]!=ff)&#123;</span><br><span class="line">            <span class="built_in">dfs2</span>(g[x][i],x);</span><br><span class="line">            dp[x][<span class="number">0</span>]=dp[x][<span class="number">0</span>]*((dp[g[x][i]][<span class="number">1</span>]+dp[g[x][i]][<span class="number">0</span>])%mod)%mod;</span><br><span class="line">            dp[x][<span class="number">1</span>]=dp[x][<span class="number">1</span>]*dp[g[x][i]][<span class="number">0</span>]%mod; <span class="comment">// 这里怎么写成1了 QAQ</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs3</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> ff,<span class="type">int</span> ban)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x==ban) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="type">int</span> len=g[x].<span class="built_in">size</span>();</span><br><span class="line">    dp2[x][<span class="number">1</span>]=dp2[x][<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;++i)</span><br><span class="line">        <span class="keyword">if</span>(g[x][i]!=ff)&#123;</span><br><span class="line">            <span class="built_in">dfs3</span>(g[x][i],x,ban);</span><br><span class="line">            dp2[x][<span class="number">1</span>]=dp2[x][<span class="number">1</span>]*dp2[g[x][i]][<span class="number">0</span>]%mod;</span><br><span class="line">            dp2[x][<span class="number">0</span>]=dp2[x][<span class="number">0</span>]*((dp2[g[x][i]][<span class="number">1</span>]+dp2[g[x][i]][<span class="number">0</span>])%mod)%mod;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> len=g2[x].<span class="built_in">size</span>(),len2=g[x].<span class="built_in">size</span>();</span><br><span class="line">    dp[x][<span class="number">0</span>]=dp[x][<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;len2;++i)</span><br><span class="line">        <span class="keyword">if</span>(st[x][<span class="number">0</span>]!=g[x][i]&amp;&amp;!numvir[g[x][i]])&#123;</span><br><span class="line">            <span class="built_in">dfs2</span>(g[x][i],x);</span><br><span class="line">            dp[x][<span class="number">0</span>]=dp[x][<span class="number">0</span>]*((dp[g[x][i]][<span class="number">0</span>]+dp[g[x][i]][<span class="number">1</span>])%mod)%mod;</span><br><span class="line">            dp[x][<span class="number">1</span>]=dp[x][<span class="number">1</span>]*dp[g[x][i]][<span class="number">0</span>]%mod;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;++i)&#123;</span><br><span class="line">        <span class="type">int</span> sour=g2[x][i];</span><br><span class="line">        <span class="keyword">while</span>(st[sour][<span class="number">0</span>]!=x) sour=st[sour][<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">        dp2[g2[x][i]][<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">        dp2[g2[x][i]][<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">dfs3</span>(sour,x,g2[x][i]);</span><br><span class="line">        k[g2[x][i]][<span class="number">1</span>][<span class="number">0</span>]=(dp2[sour][<span class="number">0</span>]+dp2[sour][<span class="number">1</span>])%mod;</span><br><span class="line">        k[g2[x][i]][<span class="number">1</span>][<span class="number">1</span>]=dp2[sour][<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">        dp2[g2[x][i]][<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">        dp2[g2[x][i]][<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">dfs3</span>(sour,x,g2[x][i]);</span><br><span class="line">        k[g2[x][i]][<span class="number">0</span>][<span class="number">0</span>]=(dp2[sour][<span class="number">0</span>]+dp2[sour][<span class="number">1</span>])%mod;</span><br><span class="line">        k[g2[x][i]][<span class="number">0</span>][<span class="number">1</span>]=dp2[sour][<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">        <span class="built_in">dfs</span>(g2[x][i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> virr[N],vhe,val[N];</span><br><span class="line">ll ans;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs5</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(lefvec[x]) f[x][val[x]]=<span class="number">1</span>,f[x][val[x]^<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> f[x][<span class="number">0</span>]=f[x][<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> len=g2[x].<span class="built_in">size</span>();</span><br><span class="line">    f[x][<span class="number">0</span>]=dp[x][<span class="number">0</span>]*f[x][<span class="number">0</span>]; f[x][<span class="number">1</span>]=dp[x][<span class="number">1</span>]*f[x][<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;++i)&#123;</span><br><span class="line">        <span class="built_in">dfs5</span>(g2[x][i]);</span><br><span class="line">        f[x][<span class="number">1</span>]=f[x][<span class="number">1</span>]*((f[g2[x][i]][<span class="number">0</span>]*k[g2[x][i]][<span class="number">0</span>][<span class="number">1</span>]%mod+f[g2[x][i]][<span class="number">1</span>]*k[g2[x][i]][<span class="number">1</span>][<span class="number">1</span>]%mod)%mod)%mod;</span><br><span class="line">        f[x][<span class="number">0</span>]=f[x][<span class="number">0</span>]*((f[g2[x][i]][<span class="number">0</span>]*k[g2[x][i]][<span class="number">0</span>][<span class="number">0</span>]%mod+f[g2[x][i]][<span class="number">1</span>]*k[g2[x][i]][<span class="number">1</span>][<span class="number">0</span>]%mod)%mod)%mod;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">check</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> len=g3[x].<span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;++i)</span><br><span class="line">        <span class="keyword">if</span>(val[g3[x][i]])</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs4</span><span class="params">(<span class="type">int</span> pos)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(pos&gt;vhe)&#123;</span><br><span class="line">        <span class="built_in">dfs5</span>(<span class="number">1</span>);</span><br><span class="line">        ans=(ans+f[<span class="number">1</span>][<span class="number">1</span>]+f[<span class="number">1</span>][<span class="number">0</span>])%mod;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">check</span>(virr[pos])) val[virr[pos]]=<span class="number">1</span>,<span class="built_in">dfs4</span>(pos+<span class="number">1</span>);</span><br><span class="line">    val[virr[pos]]=<span class="number">0</span>; <span class="built_in">dfs4</span>(pos+<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">dfs</span>(<span class="number">1</span>); vhe=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i) <span class="keyword">if</span>(lefvec[i])</span><br><span class="line">        virr[++vhe]=i;</span><br><span class="line">    ans=<span class="number">0</span>; <span class="built_in">dfs4</span>(<span class="number">1</span>); <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;1.txt&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;2.txt&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i) fa[i]=i;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;++i)&#123;</span><br><span class="line">        <span class="type">int</span> t1,t2; <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;t1,&amp;t2);</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">fin</span>(t1)!=<span class="built_in">fin</span>(t2)) <span class="built_in">uni</span>(t1,t2),g[t1].<span class="built_in">emplace_back</span>(t2),g[t2].<span class="built_in">emplace_back</span>(t1);</span><br><span class="line">        <span class="keyword">else</span> lefvec[t1]=lefvec[t2]=<span class="number">1</span>,g3[t1].<span class="built_in">emplace_back</span>(t2),g3[t2].<span class="built_in">emplace_back</span>(t1);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(m==n<span class="number">-1</span>)&#123;</span><br><span class="line">        <span class="built_in">dfs2</span>(<span class="number">1</span>,<span class="number">-1</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,((dp[<span class="number">1</span>][<span class="number">0</span>]+dp[<span class="number">1</span>][<span class="number">1</span>])%mod+mod)%mod);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">Init</span>();</span><br><span class="line">    <span class="built_in">build</span>();</span><br><span class="line">    <span class="built_in">solve</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="segment-tree-beats">segment tree beats</h1>
<h2 id="f.-stations"><a target="_blank" rel="noopener" href="https://codeforces.com/contest/1572/problem/F">F.
Stations</a></h2>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">200006</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> mod=<span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Bittree</span>&#123;</span><br><span class="line">    ll h[N],h2[N];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Init</span><span class="params">()</span></span>&#123;<span class="built_in">memset</span>(h,<span class="number">0</span>,<span class="built_in">sizeof</span>(h));<span class="built_in">memset</span>(h2,<span class="number">0</span>,<span class="built_in">sizeof</span>(h2));&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> pos,<span class="type">int</span> val)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=pos;i&lt;N;i+=(i&amp;(-i)))</span><br><span class="line">            h[i]+=val,h2[i]+=<span class="number">1ll</span>*pos*val;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> val)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(l&gt;r) <span class="keyword">return</span> ;</span><br><span class="line">        <span class="built_in">add</span>(l,val); <span class="built_in">add</span>(r+<span class="number">1</span>,-val);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">ll <span class="title">que</span><span class="params">(<span class="type">int</span> pos)</span></span>&#123;</span><br><span class="line">        ll res=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=pos;i;i-=(i&amp;(-i)))</span><br><span class="line">            res+=(h[i]*(pos+<span class="number">1</span>)-h2[i]);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">ll <span class="title">que</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(l&gt;r) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">que</span>(r)-<span class="built_in">que</span>(l<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;bt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">segtree</span>&#123;</span><br><span class="line">    <span class="type">int</span> mx[N&lt;&lt;<span class="number">2</span>],se[N&lt;&lt;<span class="number">2</span>],cnt[N&lt;&lt;<span class="number">2</span>],lz[N&lt;&lt;<span class="number">2</span>];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">psu</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        mx[x]=<span class="built_in">max</span>(mx[x&lt;&lt;<span class="number">1</span>],mx[x&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]); cnt[x]=<span class="number">0</span>;</span><br><span class="line">        cnt[x]+=(mx[x]==mx[x&lt;&lt;<span class="number">1</span>])*cnt[x&lt;&lt;<span class="number">1</span>];</span><br><span class="line">        cnt[x]+=(mx[x]==mx[x&lt;&lt;<span class="number">1</span>|<span class="number">1</span>])*cnt[x&lt;&lt;<span class="number">1</span>|<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span>(mx[x&lt;&lt;<span class="number">1</span>]==mx[x&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]) se[x]=<span class="built_in">max</span>(se[x&lt;&lt;<span class="number">1</span>],se[x&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(mx[x&lt;&lt;<span class="number">1</span>]&lt;mx[x&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]) se[x]=<span class="built_in">max</span>(mx[x&lt;&lt;<span class="number">1</span>],se[x&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">else</span> se[x]=<span class="built_in">max</span>(se[x&lt;&lt;<span class="number">1</span>],mx[x&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">cov</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> val)</span></span>&#123;<span class="keyword">if</span>(mx[x]&lt;=val)<span class="keyword">return</span> ;mx[x]=lz[x]=val;&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">psd</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;<span class="keyword">if</span>(~lz[x])&#123;<span class="built_in">cov</span>(x&lt;&lt;<span class="number">1</span>,lz[x]);<span class="built_in">cov</span>(x&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,lz[x]);lz[x]=<span class="number">-1</span>;&#125;&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(l&gt;r) <span class="keyword">return</span> ; lz[x]=<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">if</span>(l==r)&#123;se[x]=<span class="number">0</span>;mx[x]=l;cnt[x]=<span class="number">1</span>;<span class="keyword">return</span> ;&#125;</span><br><span class="line">        <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">build</span>(l,mid,x&lt;&lt;<span class="number">1</span>); <span class="built_in">build</span>(mid+<span class="number">1</span>,r,x&lt;&lt;<span class="number">1</span>|<span class="number">1</span>); <span class="built_in">psu</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">modi</span><span class="params">(<span class="type">int</span> L,<span class="type">int</span> R,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(L&gt;R||l&gt;r||l&gt;R||r&lt;L) <span class="keyword">return</span> ;</span><br><span class="line">        <span class="keyword">if</span>(mx[x]&lt;=R) <span class="keyword">return</span> ;</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=l&amp;&amp;r&lt;=R&amp;&amp;se[x]&lt;R)&#123;</span><br><span class="line">            bt.<span class="built_in">add</span>(R+<span class="number">1</span>,mx[x],-cnt[x]);</span><br><span class="line">            <span class="built_in">cov</span>(x,R); <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">psd</span>(x); <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">modi</span>(L,R,l,mid,x&lt;&lt;<span class="number">1</span>); <span class="built_in">modi</span>(L,R,mid+<span class="number">1</span>,r,x&lt;&lt;<span class="number">1</span>|<span class="number">1</span>); <span class="built_in">psu</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">modip</span><span class="params">(<span class="type">int</span> pos,<span class="type">int</span> val,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(l&gt;r||l&gt;pos||r&lt;pos) <span class="keyword">return</span> ;</span><br><span class="line">        <span class="keyword">if</span>(l==r)&#123;bt.<span class="built_in">add</span>(pos,mx[x],<span class="number">-1</span>);mx[x]=val;bt.<span class="built_in">add</span>(pos,mx[x],<span class="number">1</span>);lz[x]=<span class="number">-1</span>;<span class="keyword">return</span> ;&#125;</span><br><span class="line">        <span class="built_in">psd</span>(x); <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(pos&lt;=mid) <span class="built_in">modip</span>(pos,val,l,mid,x&lt;&lt;<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">modip</span>(pos,val,mid+<span class="number">1</span>,r,x&lt;&lt;<span class="number">1</span>|<span class="number">1</span>); <span class="built_in">psu</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;st;</span><br><span class="line"><span class="type">int</span> n,q;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;1.txt&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;2.txt&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;q);</span><br><span class="line">    st.<span class="built_in">build</span>(<span class="number">1</span>,n,<span class="number">1</span>);</span><br><span class="line">    bt.<span class="built_in">Init</span>(); bt.<span class="built_in">add</span>(<span class="number">1</span>,n,<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=q;++i)&#123;</span><br><span class="line">        <span class="type">int</span> opt,t1,t2;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;opt,&amp;t1,&amp;t2);</span><br><span class="line">        <span class="keyword">if</span>(opt==<span class="number">1</span>)&#123;</span><br><span class="line">            st.<span class="built_in">modip</span>(t1,t2,<span class="number">1</span>,n,<span class="number">1</span>);</span><br><span class="line">            st.<span class="built_in">modi</span>(<span class="number">1</span>,t1<span class="number">-1</span>,<span class="number">1</span>,n,<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,bt.<span class="built_in">que</span>(t1,t2));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="gorgeous-sequence"><a target="_blank" rel="noopener" href="https://acm.hdu.edu.cn/showproblem.php?pid=5306">Gorgeous
Sequence</a></h2>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1000006</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> mod=<span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line"><span class="type">int</span> T,n,m;</span><br><span class="line">ll a[N];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">segtree</span>&#123;</span><br><span class="line">    ll lz[N&lt;&lt;<span class="number">2</span>],mx[N&lt;&lt;<span class="number">2</span>],se[N&lt;&lt;<span class="number">2</span>],ct[N&lt;&lt;<span class="number">2</span>],sm[N&lt;&lt;<span class="number">2</span>];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">psu</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        mx[x]=<span class="built_in">max</span>(mx[x&lt;&lt;<span class="number">1</span>],mx[x&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]);</span><br><span class="line">        sm[x]=sm[x&lt;&lt;<span class="number">1</span>]+sm[x&lt;&lt;<span class="number">1</span>|<span class="number">1</span>];</span><br><span class="line">        ct[x]=<span class="number">1ll</span>*(mx[x&lt;&lt;<span class="number">1</span>]==mx[x])*ct[x&lt;&lt;<span class="number">1</span>]+<span class="number">1ll</span>*(mx[x&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]==mx[x])*ct[x&lt;&lt;<span class="number">1</span>|<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span>(mx[x&lt;&lt;<span class="number">1</span>]==mx[x&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]) se[x]=<span class="built_in">max</span>(se[x&lt;&lt;<span class="number">1</span>],se[x&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(mx[x&lt;&lt;<span class="number">1</span>]&lt;mx[x&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]) se[x]=<span class="built_in">max</span>(mx[x&lt;&lt;<span class="number">1</span>],se[x&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">else</span> se[x]=<span class="built_in">max</span>(se[x&lt;&lt;<span class="number">1</span>],mx[x&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">cov</span><span class="params">(<span class="type">int</span> x,ll val)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(val&gt;=mx[x]) <span class="keyword">return</span> ;</span><br><span class="line">        sm[x]-=(mx[x]-val)*ct[x];</span><br><span class="line">        mx[x]=lz[x]=val;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">psd</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(~lz[x])&#123;</span><br><span class="line">            <span class="built_in">cov</span>(x&lt;&lt;<span class="number">1</span>,lz[x]); <span class="built_in">cov</span>(x&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,lz[x]);</span><br><span class="line">            lz[x]=<span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(l&gt;r) <span class="keyword">return</span> ; lz[x]=<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">if</span>(l==r)&#123;mx[x]=a[l];se[x]=<span class="number">0</span>;sm[x]=a[l];ct[x]=<span class="number">1</span>;<span class="keyword">return</span> ;&#125;</span><br><span class="line">        <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>; <span class="built_in">build</span>(l,mid,x&lt;&lt;<span class="number">1</span>);</span><br><span class="line">        <span class="built_in">build</span>(mid+<span class="number">1</span>,r,x&lt;&lt;<span class="number">1</span>|<span class="number">1</span>); <span class="built_in">psu</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">modi</span><span class="params">(<span class="type">int</span> L,<span class="type">int</span> R,<span class="type">int</span> val,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(l&gt;r||L&gt;R||l&gt;R||r&lt;L) <span class="keyword">return</span> ;</span><br><span class="line">        <span class="keyword">if</span>(val&gt;=mx[x]) <span class="keyword">return</span> ;</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=l&amp;&amp;r&lt;=R&amp;&amp;val&gt;se[x])&#123;<span class="built_in">cov</span>(x,val);<span class="keyword">return</span> ;&#125;</span><br><span class="line">        <span class="built_in">psd</span>(x); <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">modi</span>(L,R,val,l,mid,x&lt;&lt;<span class="number">1</span>); <span class="built_in">modi</span>(L,R,val,mid+<span class="number">1</span>,r,x&lt;&lt;<span class="number">1</span>|<span class="number">1</span>);</span><br><span class="line">        <span class="built_in">psu</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">ll <span class="title">quemx</span><span class="params">(<span class="type">int</span> L,<span class="type">int</span> R,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(l&gt;r||L&gt;R||l&gt;R||r&lt;L) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=l&amp;&amp;r&lt;=R) <span class="keyword">return</span> mx[x];</span><br><span class="line">        <span class="built_in">psd</span>(x); <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">max</span>(<span class="built_in">quemx</span>(L,R,l,mid,x&lt;&lt;<span class="number">1</span>),<span class="built_in">quemx</span>(L,R,mid+<span class="number">1</span>,r,x&lt;&lt;<span class="number">1</span>|<span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">ll <span class="title">quesm</span><span class="params">(<span class="type">int</span> L,<span class="type">int</span> R,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(l&gt;r||L&gt;R||l&gt;R||r&lt;L) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=l&amp;&amp;r&lt;=R) <span class="keyword">return</span> sm[x];</span><br><span class="line">        <span class="built_in">psd</span>(x); <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">quesm</span>(L,R,l,mid,x&lt;&lt;<span class="number">1</span>)+<span class="built_in">quesm</span>(L,R,mid+<span class="number">1</span>,r,x&lt;&lt;<span class="number">1</span>|<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;st;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;1.txt&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;2.txt&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;T);</span><br><span class="line">    <span class="keyword">while</span>(T--)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i) <span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>,a+i);</span><br><span class="line">        st.<span class="built_in">build</span>(<span class="number">1</span>,n,<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;++i)&#123;</span><br><span class="line">            <span class="type">int</span> opt,x,y,t;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;opt);</span><br><span class="line">            <span class="keyword">if</span>(opt==<span class="number">0</span>) <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;x,&amp;y,&amp;t),st.<span class="built_in">modi</span>(x,y,t,<span class="number">1</span>,n,<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(opt==<span class="number">1</span>) <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;x,&amp;y),<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,st.<span class="built_in">quemx</span>(x,y,<span class="number">1</span>,n,<span class="number">1</span>));</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;x,&amp;y),<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,st.<span class="built_in">quesm</span>(x,y,<span class="number">1</span>,n,<span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="合并线段树">合并线段树</h1>
<h2 id="合并01trie异或树"><a target="_blank" rel="noopener" href="https://acm.ecnu.edu.cn/contest/463/problem/E/">合并01trie:异或树</a></h2>
<p>不能把子节点合并到父节点上，要把父节点合并到子节点上</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> dd double</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ld long double</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 500006</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> mod=<span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span>&#123;</span><br><span class="line">    <span class="type">int</span> ch[<span class="number">2</span>],num;</span><br><span class="line">&#125;a[N*<span class="number">64</span>];</span><br><span class="line"><span class="type">int</span> n,k,b[N],nowk[N],tot,rt[N];</span><br><span class="line"><span class="type">int</span> head[N],cnt,v[N&lt;&lt;<span class="number">1</span>],nxt[N&lt;&lt;<span class="number">1</span>];</span><br><span class="line">priority_queue&lt;pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt;,vector&lt;pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt;&gt;,less&lt;pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt;&gt; &gt; q;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">adde</span><span class="params">(<span class="type">int</span> t1,<span class="type">int</span> t2)</span></span>&#123;</span><br><span class="line">    ++cnt;</span><br><span class="line">    nxt[cnt]=head[t1];</span><br><span class="line">    head[t1]=cnt;</span><br><span class="line">    v[cnt]=t2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ins</span><span class="params">(<span class="type">int</span> las,<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> r1=rt[las],r2=rt[x],val=b[x];</span><br><span class="line">    a[r2].num=a[r1].num+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">30</span>;i&gt;=<span class="number">0</span>;--i)&#123;</span><br><span class="line">        <span class="type">int</span> fl=((<span class="number">1</span>&lt;&lt;i)&amp;val)&gt;&gt;i;</span><br><span class="line">        a[r2].ch[fl^<span class="number">1</span>]=a[r1].ch[fl^<span class="number">1</span>];</span><br><span class="line">        a[r2].ch[fl]=++tot;</span><br><span class="line">        a[a[r2].ch[fl]].num=a[a[r1].ch[fl]].num+<span class="number">1</span>;</span><br><span class="line">        r1=a[r1].ch[fl]; r2=a[r2].ch[fl];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">que</span><span class="params">(<span class="type">int</span> rk,<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> now=rt[x],val=b[x];</span><br><span class="line">    <span class="keyword">if</span>(rk&gt;a[now].num) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">30</span>;i&gt;=<span class="number">0</span>;--i)&#123;</span><br><span class="line">        <span class="type">int</span> fl=((<span class="number">1</span>&lt;&lt;i)&amp;val)&gt;&gt;i;</span><br><span class="line">        <span class="keyword">if</span>(rk&lt;=a[a[now].ch[fl^<span class="number">1</span>]].num) res+=(<span class="number">1</span>&lt;&lt;i),now=a[now].ch[fl^<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">else</span> rk-=a[a[now].ch[fl^<span class="number">1</span>]].num,now=a[now].ch[fl];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs1</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> ff)</span></span>&#123;</span><br><span class="line">    rt[x]=++tot; <span class="built_in">ins</span>(ff,x);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=head[x];i;i=nxt[i]) <span class="keyword">if</span>(v[i]!=ff) <span class="built_in">dfs1</span>(v[i],x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;1.txt&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;2.txt&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;k);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;++i)&#123;</span><br><span class="line">        <span class="type">int</span> t1,t2;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;t1,&amp;t2);</span><br><span class="line">        <span class="built_in">adde</span>(t1,t2); <span class="built_in">adde</span>(t2,t1);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,b+i);</span><br><span class="line">    rt[<span class="number">0</span>]=++tot; <span class="built_in">dfs1</span>(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i) q.<span class="built_in">push</span>(&#123;<span class="built_in">que</span>(++nowk[i],i),i&#125;);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=k;++i)&#123;</span><br><span class="line">        <span class="keyword">auto</span> tmp=q.<span class="built_in">top</span>(); q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,tmp.first);</span><br><span class="line">        q.<span class="built_in">push</span>(&#123;<span class="built_in">que</span>(++nowk[tmp.second],tmp.second),tmp.second&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="拉格朗日插值法">拉格朗日插值法</h1>
<h2 id="f---cumulative-sum-拉格朗日插值法">F - Cumulative Sum
拉格朗日插值法</h2>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/jcgf/p/14941842.html#/c/subject/p/14941842.html">拉格朗日插值学习笔记</a></p>
<figure>
<img src="/1970/01/01/banzi/Untitled%20picture.png" alt="Untitled picture">
<figcaption aria-hidden="true">Untitled picture</figcaption>
</figure>
<figure>
<img src="/1970/01/01/banzi/Untitled%20picture-16335074699661.png" alt="Untitled picture">
<figcaption aria-hidden="true">Untitled picture</figcaption>
</figure>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Silymtics/p/14972735.html"><strong>AtCoder
ABC208 F - Cumulative Sum 题解</strong></a></p>
<figure>
<img src="/1970/01/01/banzi/未命名图片.png" alt="未命名图片">
<figcaption aria-hidden="true">未命名图片</figcaption>
</figure>
<figure>
<img src="/1970/01/01/banzi/未命名图片2.png" alt="未命名图片2">
<figcaption aria-hidden="true">未命名图片2</figcaption>
</figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 3000006</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod 1000000007</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function">ll <span class="title">poww</span><span class="params">(ll x,ll y)</span></span>&#123;</span><br><span class="line">    ll res=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(y)&#123;</span><br><span class="line">        <span class="keyword">if</span>(y&amp;<span class="number">1</span>)</span><br><span class="line">            res=res*x%Mod;</span><br><span class="line">        x=x*x%Mod;</span><br><span class="line">        y&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line">ll n,m,k,mk,res,temp;</span><br><span class="line">ll t[N],y[N],pre[N],suf[N],fac[N],ni[N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld%lld&quot;</span>,&amp;n,&amp;m,&amp;k);</span><br><span class="line">    mk=m+k;</span><br><span class="line">    <span class="keyword">if</span>(n==<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;0\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(m==<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,<span class="built_in">poww</span>(n%Mod,k));</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=mk;++i)</span><br><span class="line">        y[i]=<span class="built_in">poww</span>(i,k);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=m;++j)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=mk;++i)</span><br><span class="line">            t[i]=y[i];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=mk;++i)</span><br><span class="line">            y[i]=(y[i<span class="number">-1</span>]+t[i])%Mod;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(n&lt;=mk)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,y[n]);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    fac[<span class="number">0</span>]=<span class="number">1</span>; pre[<span class="number">0</span>]=n%Mod; suf[mk+<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    ni[<span class="number">1</span>]=<span class="number">1</span>; ni[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=mk;++i)</span><br><span class="line">        ni[i]=ni[Mod%i]*(Mod-Mod/i)%Mod;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=mk;++i)&#123;</span><br><span class="line">        <span class="comment">// fac[i]=fac[i-1]*i%Mod;</span></span><br><span class="line">        fac[i]=fac[i<span class="number">-1</span>]*ni[i]%Mod;</span><br><span class="line">        pre[i]=pre[i<span class="number">-1</span>]*((n-i)%Mod)%Mod;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=mk;i&gt;=<span class="number">0</span>;--i)</span><br><span class="line">        suf[i]=suf[i+<span class="number">1</span>]*((n-i)%Mod)%Mod;</span><br><span class="line">    res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=mk;++i)&#123;</span><br><span class="line">        temp=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(i&gt;<span class="number">0</span>)</span><br><span class="line">            temp=temp*pre[i<span class="number">-1</span>]%Mod;</span><br><span class="line">        temp=temp*suf[i+<span class="number">1</span>]%Mod;</span><br><span class="line">        <span class="comment">// temp=temp*poww(fac[i]*fac[mk-i]%Mod,Mod-2)%Mod;</span></span><br><span class="line">        temp=temp*fac[i]%Mod*fac[mk-i]%Mod;</span><br><span class="line">        <span class="keyword">if</span>((mk-i)&amp;<span class="number">1</span>)</span><br><span class="line">            temp=-temp;</span><br><span class="line">        temp=temp*y[i]%Mod;</span><br><span class="line">        res=(res+temp)%Mod;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,(res+Mod)%Mod);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="数论分块">数论分块</h1>
<h2 id="p2261-cqoi2007余数求和">[P2261 <a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2261">CQOI2007]余数求和</a></h2>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">P2261 [CQOI2007]余数求和</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 2006</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod 1000000007</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ull unsigned long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line">ll n,k;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ll temp;</span><br><span class="line">    ll res=<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld&quot;</span>,&amp;n,&amp;k);</span><br><span class="line">    res=n*k;</span><br><span class="line">    <span class="keyword">for</span>(ll i=<span class="number">1</span>;i&lt;=n;i=temp+<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(i&lt;=k) temp=<span class="built_in">min</span>(n,k/(k/i));</span><br><span class="line">        <span class="keyword">else</span> temp=n;</span><br><span class="line">        res=res-(k/i)*(i+temp)*(temp-i+<span class="number">1</span>)/<span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    cout&lt;&lt;res&lt;&lt;endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="莫比乌斯">莫比乌斯</h1>
<h2 id="莫比乌斯函数">莫比乌斯函数</h2>
<figure>
<img src="/1970/01/01/banzi/1.png" alt="1">
<figcaption aria-hidden="true">1</figcaption>
</figure>
<figure>
<img src="/1970/01/01/banzi/2.png" alt="2">
<figcaption aria-hidden="true">2</figcaption>
</figure>
<figure>
<img src="/1970/01/01/banzi/3.png" alt="3">
<figcaption aria-hidden="true">3</figcaption>
</figure>
<figure>
<img src="/1970/01/01/banzi/4.png" alt="4">
<figcaption aria-hidden="true">4</figcaption>
</figure>
<h2 id="p2522-haoi2011problem-b">[P2522 <a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2522">HAOI2011]Problem
b</a></h2>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 50006</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> mu[N],prime[N],cnt,pre[N];</span><br><span class="line"><span class="type">bool</span> vis[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    mu[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;N;++i)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!vis[i])&#123;</span><br><span class="line">            prime[++cnt]=i;</span><br><span class="line">            mu[i]=<span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=cnt&amp;&amp;i*prime[j]&lt;N;++j)&#123;</span><br><span class="line">            vis[i*prime[j]]=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(i%prime[j]==<span class="number">0</span>)&#123;</span><br><span class="line">                mu[i*prime[j]]=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            mu[i*prime[j]]=-mu[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    pre[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;N;++i)</span><br><span class="line">        pre[i]=pre[i<span class="number">-1</span>]+mu[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> T,a,b,c,d,k;</span><br><span class="line"><span class="function">ll <span class="title">cal</span><span class="params">(<span class="type">int</span> n,<span class="type">int</span> m)</span></span>&#123;</span><br><span class="line">    n/=k; m/=k;</span><br><span class="line">    <span class="keyword">if</span>(!n||!m) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> mn=<span class="built_in">min</span>(m,n);</span><br><span class="line">    ll res=<span class="number">0</span>,temp;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=mn;i=temp+<span class="number">1</span>)&#123;</span><br><span class="line">        temp=<span class="built_in">min</span>(n/(n/i),m/(m/i));</span><br><span class="line">        res+=((ll)pre[temp]-pre[i<span class="number">-1</span>])*(n/i)*(m/i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">Init</span>();</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;T);</span><br><span class="line">    <span class="keyword">while</span>(T--)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d%d%d&quot;</span>,&amp;a,&amp;b,&amp;c,&amp;d,&amp;k);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,<span class="built_in">cal</span>(b,d)-<span class="built_in">cal</span>(a<span class="number">-1</span>,d)-<span class="built_in">cal</span>(b,c<span class="number">-1</span>)+<span class="built_in">cal</span>(a<span class="number">-1</span>,c<span class="number">-1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="lcmsum---lcm-sum"><a target="_blank" rel="noopener" href="https://www.spoj.com/problems/LCMSUM/">LCMSUM - LCM Sum</a></h2>
<figure>
<img src="/1970/01/01/banzi/1-16335077197532.png" alt="1">
<figcaption aria-hidden="true">1</figcaption>
</figure>
<figure>
<img src="/1970/01/01/banzi/2-16335077221143.png" alt="2">
<figcaption aria-hidden="true">2</figcaption>
</figure>
<figure>
<img src="/1970/01/01/banzi/3.jpg" alt="3">
<figcaption aria-hidden="true">3</figcaption>
</figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 1000006</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line">ll prime[N],cnt;</span><br><span class="line"><span class="type">bool</span> vis[N];</span><br><span class="line">ll b[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    b[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(ll i=<span class="number">2</span>;i&lt;N;++i)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!vis[i])&#123;</span><br><span class="line">            prime[++cnt]=i;</span><br><span class="line">            b[i]=i*(i<span class="number">-1</span>)+<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=cnt&amp;&amp;prime[j]*i&lt;N;++j)&#123;</span><br><span class="line">            vis[prime[j]*i]=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(i%prime[j]==<span class="number">0</span>)&#123;</span><br><span class="line">                b[i*prime[j]]=b[i]+(b[i]-b[i/prime[j]])*prime[j]*prime[j];</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            b[i*prime[j]]=b[i]*b[prime[j]];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> T,n;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">Init</span>();</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;T);</span><br><span class="line">    <span class="keyword">while</span>(T--)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,(b[n]+<span class="number">1</span>)*n/<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="p1829-国家集训队crash的数字表格-jzptab">[P1829 <a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1829">国家集训队]Crash的数字表格
/ JZPTAB</a></h2>
<figure>
<img src="/1970/01/01/banzi/1.jpg" alt="1">
<figcaption aria-hidden="true">1</figcaption>
</figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 10000006</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod 20101009</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function">ll <span class="title">mi</span><span class="params">(ll x,ll y)</span></span>&#123;</span><br><span class="line">    ll res=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(y)&#123;</span><br><span class="line">        <span class="keyword">if</span>(y&amp;<span class="number">1</span>)</span><br><span class="line">            res=res*x%Mod;</span><br><span class="line">        x=x*x%Mod;</span><br><span class="line">        y&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line">ll mu[N],prime[N],cnt,pre[N],bb;</span><br><span class="line"><span class="type">bool</span> vis[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    mu[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;N;++i)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!vis[i])&#123;</span><br><span class="line">            prime[++cnt]=i;</span><br><span class="line">            mu[i]=<span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=cnt&amp;&amp;prime[j]*i&lt;N;++j)&#123;</span><br><span class="line">            vis[prime[j]*i]=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(i%prime[j]==<span class="number">0</span>)&#123;</span><br><span class="line">                mu[i*prime[j]]=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            mu[i*prime[j]]=-mu[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// for(int i=1;i&lt;=10;++i)</span></span><br><span class="line">        <span class="comment">// printf(&quot;i=%d mu=%d\n&quot;,i,mu[i]);</span></span><br><span class="line">    pre[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(ll i=<span class="number">2</span>;i&lt;N;++i)</span><br><span class="line">        pre[i]=(pre[i<span class="number">-1</span>]+mu[i]*i*i%Mod+Mod)%Mod;</span><br><span class="line">    bb=<span class="built_in">mi</span>(<span class="number">2</span>,Mod<span class="number">-2</span>);</span><br><span class="line">&#125;</span><br><span class="line">ll n,m;</span><br><span class="line"><span class="function">ll <span class="title">cal2</span><span class="params">(ll a,ll b)</span></span>&#123;</span><br><span class="line">    ll t1=a*(a+<span class="number">1</span>)/<span class="number">2</span>,t2=b*(b+<span class="number">1</span>)/<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">return</span> (t1%Mod)*(t2%Mod)%Mod;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">cal</span><span class="params">(ll a,ll b)</span></span>&#123;</span><br><span class="line">    ll temp,res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(ll i=<span class="number">1</span>;i&lt;=a;i=temp+<span class="number">1</span>)&#123;</span><br><span class="line">        temp=<span class="built_in">min</span>(a/(a/i),b/(b/i));</span><br><span class="line">        res=(res+(pre[temp]-pre[i<span class="number">-1</span>]+Mod)%Mod*<span class="built_in">cal2</span>(a/i,b/i)%Mod)%Mod;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">work</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ll res=<span class="number">0</span>,t1,t2,temp;</span><br><span class="line">    <span class="keyword">if</span>(n&gt;m) <span class="built_in">swap</span>(n,m);</span><br><span class="line">    <span class="keyword">for</span>(ll i=<span class="number">1</span>;i&lt;=n;i=t1+<span class="number">1</span>)&#123;</span><br><span class="line">        t1=<span class="built_in">min</span>(n/(n/i),m/(m/i));</span><br><span class="line">        temp=<span class="built_in">cal</span>(n/i,m/i);</span><br><span class="line">        res=(res+(i+t1)*(t1-i+<span class="number">1</span>)%Mod*bb%Mod*temp%Mod)%Mod;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (res+Mod)%Mod;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">Init</span>();</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,<span class="built_in">work</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="sdoi2015约数个数和"><a target="_blank" rel="noopener" href="https://loj.ac/p/2185">#2185.
「SDOI2015」约数个数和</a></h2>
<figure>
<img src="/1970/01/01/banzi/1-16335077867434.jpg" alt="1">
<figcaption aria-hidden="true">1</figcaption>
</figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 50006</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod 20101009</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line">ll t[N],prime[N],cnt,mu[N],pre[N],d[N]; <span class="comment">// t[N] 是最小质因子的个数</span></span><br><span class="line"><span class="type">bool</span> vis[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    t[<span class="number">1</span>]=<span class="number">0</span>; d[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;N;++i)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!vis[i])&#123;</span><br><span class="line">            prime[++cnt]=i;</span><br><span class="line">            t[i]=<span class="number">1</span>;</span><br><span class="line">            d[i]=<span class="number">2</span>;</span><br><span class="line">            mu[i]=<span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=cnt&amp;&amp;prime[j]*i&lt;N;++j)&#123;</span><br><span class="line">            vis[i*prime[j]]=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(i%prime[j]==<span class="number">0</span>)&#123;</span><br><span class="line">                t[i*prime[j]]=t[i]+<span class="number">1</span>;</span><br><span class="line">                d[i*prime[j]]=d[i]/(t[i]+<span class="number">1</span>)*(t[i]+<span class="number">2</span>);</span><br><span class="line">                mu[prime[j]*i]=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            t[i*prime[j]]=<span class="number">1</span>;</span><br><span class="line">            d[i*prime[j]]=d[i]&lt;&lt;<span class="number">1</span>;</span><br><span class="line">            mu[prime[j]*i]=-mu[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    pre[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;N;++i)</span><br><span class="line">        pre[i]=pre[i<span class="number">-1</span>]+mu[i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;N;++i)</span><br><span class="line">        d[i]+=d[i<span class="number">-1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> T;</span><br><span class="line">ll n,m;</span><br><span class="line"><span class="function">ll <span class="title">work</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(n&gt;m) <span class="built_in">swap</span>(n,m);</span><br><span class="line">    ll temp,res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(ll i=<span class="number">1</span>;i&lt;=n;i=temp+<span class="number">1</span>)&#123;</span><br><span class="line">        temp=<span class="built_in">min</span>(n/(n/i),m/(m/i));</span><br><span class="line">        res+=(pre[temp]-pre[i<span class="number">-1</span>])*d[n/i]*d[m/i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">Init</span>();</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;T);</span><br><span class="line">    <span class="keyword">while</span>(T--)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,<span class="built_in">work</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="p3768-简单的数学题"><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3768">P3768
简单的数学题</a></h2>
<p>sc 60：</p>
<figure>
<img src="/1970/01/01/banzi/1-16335078265535.jpg" alt="1">
<figcaption aria-hidden="true">1</figcaption>
</figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 1000006</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> T;</span><br><span class="line">ll n,m,p;</span><br><span class="line">ll prime[N],cnt,mu[N],pre[N],d3[N];</span><br><span class="line"><span class="type">bool</span> vis[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    mu[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(ll i=<span class="number">2</span>;i&lt;N;++i)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!vis[i])&#123;</span><br><span class="line">            prime[++cnt]=i;</span><br><span class="line">            mu[i]=<span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=cnt&amp;&amp;prime[j]*i&lt;N;++j)&#123;</span><br><span class="line">            vis[i*prime[j]]=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(i%prime[j]==<span class="number">0</span>)&#123;</span><br><span class="line">                mu[prime[j]*i]=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            mu[prime[j]*i]=-mu[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    pre[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(ll i=<span class="number">2</span>;i&lt;N;++i)</span><br><span class="line">        pre[i]=(pre[i<span class="number">-1</span>]+mu[i]*i%p*i%p)%p;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(ll i=<span class="number">1</span>;i&lt;N;++i)</span><br><span class="line">        d3[i]=(d3[i<span class="number">-1</span>]+i*i%p*i%p)%p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">cal2</span><span class="params">(ll a)</span></span>&#123;</span><br><span class="line">    ll t1=a*(a+<span class="number">1</span>)/<span class="number">2</span>%p,t2=a*(a+<span class="number">1</span>)/<span class="number">2</span>%p;</span><br><span class="line">    <span class="keyword">return</span> t1*t2%p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">cal</span><span class="params">(ll a)</span></span>&#123;</span><br><span class="line">    ll temp,res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(ll i=<span class="number">1</span>;i&lt;=a;i=temp+<span class="number">1</span>)&#123;</span><br><span class="line">        temp=a/(a/i);</span><br><span class="line">        res=(res+(pre[temp]-pre[i<span class="number">-1</span>]+p)%p*<span class="built_in">cal2</span>(a/i)%p)%p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (res+p)%p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">work</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ll temp,res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(ll i=<span class="number">1</span>;i&lt;=n;i=temp+<span class="number">1</span>)&#123;</span><br><span class="line">        temp=n/(n/i);</span><br><span class="line">        res=(res+(d3[temp]-d3[i<span class="number">-1</span>]+p)%p*<span class="built_in">cal</span>(n/i)%p)%p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (res+p)%p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld&quot;</span>,&amp;p,&amp;n);</span><br><span class="line">    <span class="built_in">Init</span>();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,<span class="built_in">work</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>sc 100：</p>
<figure>
<img src="/1970/01/01/banzi/1-16335078537076.jpg" alt="1">
<figcaption aria-hidden="true">1</figcaption>
</figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 5000006</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function">ll <span class="title">mi</span><span class="params">(ll x,ll y,ll p)</span></span>&#123;</span><br><span class="line">    ll res=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(y)&#123;</span><br><span class="line">        <span class="keyword">if</span>(y&amp;<span class="number">1</span>)</span><br><span class="line">            res=res*x%p;</span><br><span class="line">        x=x*x%p;</span><br><span class="line">        y&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> T;</span><br><span class="line">ll n,p;</span><br><span class="line">map&lt;ll,ll&gt; m;</span><br><span class="line">ll prime[N],cnt,mu[N],pre[N],ni6,ni2,ou[N],tt[N];</span><br><span class="line"><span class="type">bool</span> vis[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    mu[<span class="number">1</span>]=<span class="number">1</span>; ou[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(ll i=<span class="number">2</span>;i&lt;N;++i)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!vis[i])&#123;</span><br><span class="line">            prime[++cnt]=i;</span><br><span class="line">            mu[i]=<span class="number">-1</span>;</span><br><span class="line">            ou[i]=i<span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=cnt&amp;&amp;prime[j]*i&lt;N;++j)&#123;</span><br><span class="line">            vis[i*prime[j]]=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(i%prime[j]==<span class="number">0</span>)&#123;</span><br><span class="line">                mu[prime[j]*i]=<span class="number">0</span>;</span><br><span class="line">                ou[prime[j]*i]=ou[i]*prime[j];</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            mu[prime[j]*i]=-mu[i];</span><br><span class="line">            ou[prime[j]*i]=ou[i]*(prime[j]<span class="number">-1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(ll i=<span class="number">1</span>;i&lt;N;++i)</span><br><span class="line">        tt[i]=(tt[i<span class="number">-1</span>]+i*i%p*ou[i]%p)%p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">F</span><span class="params">(ll x)</span></span>&#123;</span><br><span class="line">    x%=p;</span><br><span class="line">    <span class="keyword">return</span> x*(x+<span class="number">1</span>)%p*ni2%p*x%p*(x+<span class="number">1</span>)%p*ni2%p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">n2pre</span><span class="params">(ll x)</span></span>&#123;</span><br><span class="line">    x%=p;</span><br><span class="line">    <span class="keyword">return</span> x*(x+<span class="number">1</span>)%p*(x*<span class="number">2</span>+<span class="number">1</span>)%p*ni6%p;</span><br><span class="line">&#125; </span><br><span class="line"><span class="function">ll <span class="title">S</span><span class="params">(ll x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;N) <span class="keyword">return</span> tt[x];</span><br><span class="line">    <span class="keyword">if</span>(m[x]) <span class="keyword">return</span> m[x];</span><br><span class="line">    ll res=<span class="built_in">F</span>(x),temp,pre=<span class="number">1</span>,cur;</span><br><span class="line">    <span class="keyword">for</span>(ll i=<span class="number">2</span>;i&lt;=x;i=temp+<span class="number">1</span>)&#123;</span><br><span class="line">        temp=x/(x/i);</span><br><span class="line">        cur=<span class="built_in">n2pre</span>(temp);</span><br><span class="line">        res=(res-<span class="built_in">S</span>(x/i)*(cur-pre)%p)%p;</span><br><span class="line">        pre=cur;</span><br><span class="line">    &#125;</span><br><span class="line">    res=(res+p)%p;</span><br><span class="line">    m[x]=res;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">work</span><span class="params">(ll x)</span></span>&#123;</span><br><span class="line">    ll res=<span class="number">0</span>,temp,pre=<span class="number">0</span>,cur;</span><br><span class="line">    <span class="keyword">for</span>(ll i=<span class="number">1</span>;i&lt;=x;i=temp+<span class="number">1</span>)&#123;</span><br><span class="line">        temp=x/(x/i);</span><br><span class="line">        cur=<span class="built_in">S</span>(temp);</span><br><span class="line">        res=(res+(cur-pre)%p*<span class="built_in">F</span>(x/i)%p)%p;</span><br><span class="line">        pre=cur;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (res+p)%p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld&quot;</span>,&amp;p,&amp;n);</span><br><span class="line">    ni6=<span class="built_in">mi</span>(<span class="number">6</span>,p<span class="number">-2</span>,p);</span><br><span class="line">    ni2=<span class="built_in">mi</span>(<span class="number">2</span>,p<span class="number">-2</span>,p);</span><br><span class="line">    <span class="built_in">Init</span>();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,<span class="built_in">work</span>(n));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="杜教筛">杜教筛</h1>
<h2 id="杜教筛公式">杜教筛公式</h2>
<figure>
<img src="/1970/01/01/banzi/1.png" alt="1">
<figcaption aria-hidden="true">1</figcaption>
</figure>
<figure>
<img src="/1970/01/01/banzi/2-16335079634039.png" alt="2">
<figcaption aria-hidden="true">2</figcaption>
</figure>
<h2 id="p3768-简单的数学题-1"><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3768">P3768
简单的数学题</a></h2>
<p><span class="math display">\[
\sum_{i=1}^{n}\sum_{j=1}^{n}ijgcd(i,j)=\sum_{i=1}^{n}\sum_{j=1}^{n}ij\sum_{d|i,d|j}\phi(d)
\]</span></p>
<p><span class="math display">\[
=\sum_{d=1}^{n}\phi(d)\sum_{i=1}^{n}\sum_{j=1}^{n}ij[d|i,d|j]
\]</span></p>
<p><span class="math display">\[
=\sum_{d|i,d|j}^{n}\phi(d)d^2\sum_{i=1}^{\lfloor\frac{n}{d}\rfloor}\sum_{j=1}^{\lfloor\frac{n}{d}\rfloor}ij
\]</span></p>
<p><span class="math display">\[
=\sum_{d=1}^nd^2\phi(d)F(\lfloor\frac{n}{d}\rfloor)
(F(n)=\frac{n^2(n+1)^2}{4})
\]</span></p>
<p>令<span class="math inline">\(f(n)=n^2\phi(n)\)</span>,<span class="math inline">\(s(n)=\sum_{i=1}^nf(i)\)</span>,<span class="math inline">\(g(n)=n^2\)</span> <span class="math display">\[
\sum_{i=1}^ngf(n)=\sum_{i=1}^n\sum_{d|i}d^2(\frac{i}{d})^2\phi(d)
\]</span></p>
<p><span class="math display">\[
=\sum_{i=1}^ni^2\sum_{d|i}\phi(d)
\]</span></p>
<p><span class="math display">\[
=\sum_{i=1}^ni^3=\frac{1}{4}n^2(n+1)^2
\]</span></p>
<p><span class="math display">\[
S(n)=\sum_{i=1}^ngf(n)-\sum_{i=2}^ng(i)S(\lfloor\frac{n}{i}\rfloor)
\]</span></p>
<p><span class="math display">\[
S(n)=\frac{1}{4}n^2(n+1)^2-\sum_{i=2}^ni^2S(\lfloor\frac{n}{i}\rfloor)
\]</span></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 5000006</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function">ll <span class="title">mi</span><span class="params">(ll x,ll y,ll p)</span></span>&#123;</span><br><span class="line">    ll res=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(y)&#123;</span><br><span class="line">        <span class="keyword">if</span>(y&amp;<span class="number">1</span>)</span><br><span class="line">            res=res*x%p;</span><br><span class="line">        x=x*x%p;</span><br><span class="line">        y&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> T;</span><br><span class="line">ll n,p;</span><br><span class="line">map&lt;ll,ll&gt; m;</span><br><span class="line">ll prime[N],cnt,mu[N],pre[N],ni6,ni2,ou[N],tt[N];</span><br><span class="line"><span class="type">bool</span> vis[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    mu[<span class="number">1</span>]=<span class="number">1</span>; ou[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(ll i=<span class="number">2</span>;i&lt;N;++i)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!vis[i])&#123;</span><br><span class="line">            prime[++cnt]=i;</span><br><span class="line">            mu[i]=<span class="number">-1</span>;</span><br><span class="line">            ou[i]=i<span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=cnt&amp;&amp;prime[j]*i&lt;N;++j)&#123;</span><br><span class="line">            vis[i*prime[j]]=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(i%prime[j]==<span class="number">0</span>)&#123;</span><br><span class="line">                mu[prime[j]*i]=<span class="number">0</span>;</span><br><span class="line">                ou[prime[j]*i]=ou[i]*prime[j];</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            mu[prime[j]*i]=-mu[i];</span><br><span class="line">            ou[prime[j]*i]=ou[i]*(prime[j]<span class="number">-1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(ll i=<span class="number">1</span>;i&lt;N;++i)</span><br><span class="line">        tt[i]=(tt[i<span class="number">-1</span>]+i*i%p*ou[i]%p)%p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">F</span><span class="params">(ll x)</span></span>&#123;</span><br><span class="line">    x%=p;</span><br><span class="line">    <span class="keyword">return</span> x*(x+<span class="number">1</span>)%p*ni2%p*x%p*(x+<span class="number">1</span>)%p*ni2%p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">n2pre</span><span class="params">(ll x)</span></span>&#123;</span><br><span class="line">    x%=p;</span><br><span class="line">    <span class="keyword">return</span> x*(x+<span class="number">1</span>)%p*(x*<span class="number">2</span>+<span class="number">1</span>)%p*ni6%p;</span><br><span class="line">&#125; </span><br><span class="line"><span class="function">ll <span class="title">S</span><span class="params">(ll x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;N) <span class="keyword">return</span> tt[x];</span><br><span class="line">    <span class="keyword">if</span>(m[x]) <span class="keyword">return</span> m[x];</span><br><span class="line">    ll res=<span class="built_in">F</span>(x),temp,pre=<span class="number">1</span>,cur;</span><br><span class="line">    <span class="keyword">for</span>(ll i=<span class="number">2</span>;i&lt;=x;i=temp+<span class="number">1</span>)&#123;</span><br><span class="line">        temp=x/(x/i);</span><br><span class="line">        cur=<span class="built_in">n2pre</span>(temp);</span><br><span class="line">        res=(res-<span class="built_in">S</span>(x/i)*(cur-pre)%p)%p;</span><br><span class="line">        pre=cur;</span><br><span class="line">    &#125;</span><br><span class="line">    res=(res+p)%p;</span><br><span class="line">    m[x]=res;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">work</span><span class="params">(ll x)</span></span>&#123;</span><br><span class="line">    ll res=<span class="number">0</span>,temp,pre=<span class="number">0</span>,cur;</span><br><span class="line">    <span class="keyword">for</span>(ll i=<span class="number">1</span>;i&lt;=x;i=temp+<span class="number">1</span>)&#123;</span><br><span class="line">        temp=x/(x/i);</span><br><span class="line">        cur=<span class="built_in">S</span>(temp);</span><br><span class="line">        res=(res+(cur-pre)%p*<span class="built_in">F</span>(x/i)%p)%p;</span><br><span class="line">        pre=cur;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (res+p)%p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld&quot;</span>,&amp;p,&amp;n);</span><br><span class="line">    ni6=<span class="built_in">mi</span>(<span class="number">6</span>,p<span class="number">-2</span>,p);</span><br><span class="line">    ni2=<span class="built_in">mi</span>(<span class="number">2</span>,p<span class="number">-2</span>,p);</span><br><span class="line">    <span class="built_in">Init</span>();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,<span class="built_in">work</span>(n));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="e---huntian-oy"><a target="_blank" rel="noopener" href="https://vjudge.net/contest/458799#problem/E">E - huntian
oy</a></h2>
<figure>
<img src="/1970/01/01/banzi/1-163350805284711.png" alt="1">
<figcaption aria-hidden="true">1</figcaption>
</figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 5000006</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> mod=<span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line"><span class="function">ll <span class="title">qpow</span><span class="params">(ll x,ll y)</span></span>&#123;</span><br><span class="line">    ll ans=<span class="number">1ll</span>; <span class="keyword">while</span>(y)&#123;</span><br><span class="line">        <span class="keyword">if</span>(y&amp;<span class="number">1</span>) ans=<span class="number">1ll</span>*ans*x%mod;</span><br><span class="line">        x=<span class="number">1ll</span>*x*x%mod; y&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> T,cnt;</span><br><span class="line"><span class="type">int</span> inv6,inv2,ou[N],prime[N];</span><br><span class="line"><span class="type">bool</span> vis[N];</span><br><span class="line">unordered_map&lt;<span class="type">int</span>,<span class="type">int</span>&gt; mp;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    inv2=<span class="built_in">qpow</span>(<span class="number">2</span>,mod<span class="number">-2</span>); inv6=<span class="built_in">qpow</span>(<span class="number">6</span>,mod<span class="number">-2</span>); ou[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;N;++i)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!vis[i])&#123;prime[++cnt]=i;ou[i]=i<span class="number">-1</span>;&#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=cnt&amp;&amp;prime[j]*i&lt;N;++j)&#123;</span><br><span class="line">            vis[prime[j]*i]=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(i%prime[j]==<span class="number">0</span>)&#123;ou[prime[j]*i]=<span class="number">1ll</span>*ou[i]*prime[j]%mod;<span class="keyword">break</span>;&#125;</span><br><span class="line">            ou[prime[j]*i]=<span class="number">1ll</span>*ou[i]*(prime[j]<span class="number">-1</span>)%mod;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;N;++i) ou[i]=((ll)ou[i<span class="number">-1</span>]+<span class="number">1ll</span>*i*ou[i]%mod)%mod;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">n2</span><span class="params">(ll x)</span></span>&#123;<span class="keyword">return</span> <span class="number">1ll</span>*x*(x+<span class="number">1ll</span>)%mod*inv2%mod;&#125;</span><br><span class="line"><span class="function">ll <span class="title">n3</span><span class="params">(ll x)</span></span>&#123;<span class="keyword">return</span> <span class="number">1ll</span>*x*(x+<span class="number">1ll</span>)%mod*(<span class="number">2ll</span>*x+<span class="number">1ll</span>)%mod*inv6%mod;&#125;</span><br><span class="line"><span class="function">ll <span class="title">workS</span><span class="params">(<span class="type">int</span> n)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(n&lt;N) <span class="keyword">return</span> ou[n];</span><br><span class="line">    <span class="keyword">if</span>(mp[n]) <span class="keyword">return</span> mp[n];</span><br><span class="line">    ll ans=<span class="number">0</span>; <span class="type">int</span> tmp;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=n;i=tmp+<span class="number">1</span>)&#123;</span><br><span class="line">        tmp=n/(n/i);</span><br><span class="line">        ans=(ans+<span class="number">1ll</span>*((ll)(tmp-i+<span class="number">1</span>)*(i+tmp)/<span class="number">2ll</span>)%mod*<span class="built_in">workS</span>(n/i)%mod)%mod;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> mp[n]=((<span class="built_in">n3</span>(n)-ans+mod)%mod);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;1.txt&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="built_in">Init</span>();</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;T);</span><br><span class="line">    <span class="type">int</span> t1,t2,n;</span><br><span class="line">    <span class="keyword">while</span>(T--)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;n,&amp;t1,&amp;t2);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,<span class="number">1ll</span>*(<span class="built_in">workS</span>(n)<span class="number">-1ll</span>+mod)%mod*inv2%mod);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="平均最小公倍数"><a target="_blank" rel="noopener" href="https://www.51nod.com/Challenge/Problem.html#problemId=1227">1227
平均最小公倍数</a></h2>
<figure>
<img src="/1970/01/01/banzi/1-163350812960914.jpg" alt="1">
<figcaption aria-hidden="true">1</figcaption>
</figure>
<figure>
<img src="/1970/01/01/banzi/2-163350813644915.png" alt="2">
<figcaption aria-hidden="true">2</figcaption>
</figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 5000006</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> dd double</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> ll mod=<span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line"><span class="function">ll <span class="title">qpow</span><span class="params">(ll x,ll y)</span></span>&#123;</span><br><span class="line">    ll res=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(y)&#123;</span><br><span class="line">        <span class="keyword">if</span>(y&amp;<span class="number">1</span>) res=res*x%mod;</span><br><span class="line">        y&gt;&gt;=<span class="number">1</span>; x=x*x%mod;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line">ll prime[N],phi[N],cnt,a,b,inv2,inv6;</span><br><span class="line"><span class="type">bool</span> vis[N];</span><br><span class="line">map&lt;ll,ll&gt; mp;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    phi[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;N;++i)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!vis[i])&#123;</span><br><span class="line">            prime[++cnt]=i;</span><br><span class="line">            phi[i]=i<span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=cnt&amp;&amp;prime[j]*i&lt;N;++j)&#123;</span><br><span class="line">            vis[prime[j]*i]=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(i%prime[j]==<span class="number">0</span>)&#123;</span><br><span class="line">                phi[i*prime[j]]=phi[i]*prime[j]%mod;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            phi[i*prime[j]]=phi[i]*(prime[j]<span class="number">-1</span>)%mod;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(ll i=<span class="number">1</span>;i&lt;N;++i)&#123;</span><br><span class="line">        phi[i]=(phi[i<span class="number">-1</span>]+phi[i]*i%mod)%mod;</span><br><span class="line">    &#125;</span><br><span class="line">    inv2=<span class="built_in">qpow</span>(<span class="number">2</span>,mod<span class="number">-2</span>); inv6=<span class="built_in">qpow</span>(<span class="number">6</span>,mod<span class="number">-2</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">calc</span><span class="params">(ll n)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(n&lt;N) <span class="keyword">return</span> phi[n];</span><br><span class="line">    ll tmp=mp[n];</span><br><span class="line">    <span class="keyword">if</span>(tmp) <span class="keyword">return</span> tmp;</span><br><span class="line">    ll ans=<span class="number">1ll</span>*n*(n+<span class="number">1ll</span>)%mod*(n*<span class="number">2ll</span>+<span class="number">1ll</span>)%mod*inv6%mod;</span><br><span class="line">    <span class="keyword">for</span>(ll i=<span class="number">2</span>;i&lt;=n;i=tmp+<span class="number">1</span>)&#123;</span><br><span class="line">        tmp=<span class="built_in">min</span>(n,n/(n/i));</span><br><span class="line">        ans=(ans-(i+tmp)*(tmp-i+<span class="number">1ll</span>)%mod*inv2%mod*<span class="built_in">calc</span>(n/i)%mod)%mod;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> mp[n]=(<span class="number">1ll</span>*ans+mod)%mod;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">F</span><span class="params">(ll n)</span></span>&#123;</span><br><span class="line">    ll las=<span class="number">0</span>,thi,ans=<span class="number">0</span>,tmp;</span><br><span class="line">    <span class="keyword">for</span>(ll i=<span class="number">1</span>;i&lt;=n;i=tmp+<span class="number">1</span>)&#123;</span><br><span class="line">        tmp=<span class="built_in">min</span>(n,n/(n/i));</span><br><span class="line">        thi=<span class="built_in">calc</span>(tmp);</span><br><span class="line">        ans=(ans+(thi-las+mod)%mod*(n/i)%mod)%mod;</span><br><span class="line">        las=thi;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ((ans+mod)%mod*inv2%mod+n*inv2%mod)%mod;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;1.txt&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;2.txt&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">Init</span>();</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld&quot;</span>,&amp;a,&amp;b);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,(<span class="built_in">F</span>(b)%mod-<span class="built_in">F</span>(a<span class="number">-1</span>)%mod+mod)%mod);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="约数之和"><a target="_blank" rel="noopener" href="https://www.51nod.com/Challenge/Problem.html#problemId=1220">1220
约数之和</a></h2>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/TheRoadToTheGold/p/8228969.html">线筛约数和以及约数个数和</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhugezy/p/11312301.html"><strong>51nod
1220 约数之和（杜教筛 + 推推推推推公式）</strong></a></p>
<figure>
<img src="/1970/01/01/banzi/1-163350823239916.png" alt="1">
<figcaption aria-hidden="true">1</figcaption>
</figure>
<figure>
<img src="/1970/01/01/banzi/2-163350823482917.png" alt="2">
<figcaption aria-hidden="true">2</figcaption>
</figure>
<figure>
<img src="/1970/01/01/banzi/3-163350823723018.png" alt="3">
<figcaption aria-hidden="true">3</figcaption>
</figure>
<figure>
<img src="/1970/01/01/banzi/4-163350823951519.png" alt="4">
<figcaption aria-hidden="true">4</figcaption>
</figure>
<h2 id="gcd-and-lcm"><a target="_blank" rel="noopener" href="http://www.51nod.com/Challenge/Problem.html#problemId=2026">Gcd
and Lcm</a></h2>
<figure>
<img src="/1970/01/01/banzi/image-20211006161742331.png" alt="image-20211006161742331">
<figcaption aria-hidden="true">image-20211006161742331</figcaption>
</figure>
<h1 id="min25筛">min25筛</h1>
<p><span class="math display">\[
\large F_k(n)=\sum_{k\leq i,p_i^2\leq n}\sum_{c\geq 1,p_i^{c+1}\leq
n}(f(p_i^c)F_{i+1}(\frac{n}{p_i^c})+f(p_i^{c+1}))+F_{prime}(n)-F_{prime}(p_{k-1})
\]</span></p>
<p><span class="math display">\[
\large G_k(n)=G_{k-1}(n)-[p_k^2\leq
n]g(p_k)(G_{k-1}(\frac{n}{p_k})-G_{k-1}(p_{k-1}))
\]</span></p>
<h1 id="fft">FFT</h1>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// FFT</span></span><br><span class="line"><span class="type">const</span> <span class="type">long</span> <span class="type">double</span> PI=<span class="built_in">asin</span>(<span class="number">1.0</span>)*<span class="number">2.0</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">z</span>&#123;</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> x,y;</span><br><span class="line">    <span class="built_in">z</span>(<span class="type">long</span> <span class="type">double</span> t1=<span class="number">0.0</span>,<span class="type">long</span> <span class="type">double</span> t2=<span class="number">0.0</span>)&#123;x=t1;y=t2;&#125;</span><br><span class="line">    <span class="keyword">friend</span> z <span class="keyword">operator</span> * (z a,z b)&#123;<span class="keyword">return</span> <span class="built_in">z</span>(a.x*b.x-a.y*b.y,a.x*b.y+a.y*b.x);&#125;</span><br><span class="line">    <span class="keyword">friend</span> z <span class="keyword">operator</span> + (z a,z b)&#123;<span class="keyword">return</span> <span class="built_in">z</span>(a.x+b.x,a.y+b.y);&#125;</span><br><span class="line">    <span class="keyword">friend</span> z <span class="keyword">operator</span> - (z a,z b)&#123;<span class="keyword">return</span> <span class="built_in">z</span>(a.x-b.x,a.y-b.y);&#125;</span><br><span class="line">&#125;w[N&lt;&lt;<span class="number">2</span>];</span><br><span class="line"><span class="type">int</span> r[N&lt;&lt;<span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Glim</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;<span class="type">int</span> res=<span class="number">1</span>;<span class="keyword">while</span>(res&lt;x)res&lt;&lt;=<span class="number">1</span>;<span class="keyword">return</span> res;&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> lim=<span class="built_in">Glim</span>(N&lt;&lt;<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;lim;i&lt;&lt;=<span class="number">1</span>)&#123;</span><br><span class="line">        z wn=<span class="built_in">z</span>(<span class="built_in">cos</span>(PI/i),<span class="built_in">sin</span>(PI/i)),nw=<span class="built_in">z</span>(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;i;++j,nw=nw*wn) w[i+j]=nw;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dft</span><span class="params">(vector&lt;z&gt; &amp;a,<span class="type">int</span> lim,<span class="type">int</span> fl)</span></span>&#123;</span><br><span class="line">    a.<span class="built_in">resize</span>(lim);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;lim;++i) <span class="keyword">if</span>(i&gt;r[i]) <span class="built_in">swap</span>(a[i],a[r[i]]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;lim;i&lt;&lt;=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;lim;j+=(i&lt;&lt;<span class="number">1</span>))</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;i;++k)&#123;</span><br><span class="line">                z x=a[j+k],y=a[j+i+k]*<span class="built_in">z</span>(w[i+k].x,w[i+k].y*fl);</span><br><span class="line">                a[j+k]=x+y; a[j+i+k]=x-y;</span><br><span class="line">            &#125;</span><br><span class="line">&#125;</span><br><span class="line">vector&lt;z&gt; <span class="keyword">operator</span> * (vector&lt;z&gt; a,vector&lt;z&gt; b)&#123;</span><br><span class="line">    <span class="type">int</span> n=a.<span class="built_in">size</span>()+b.<span class="built_in">size</span>(),lim=<span class="built_in">Glim</span>(n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;lim;++i) r[i]=(r[i&gt;&gt;<span class="number">1</span>]&gt;&gt;<span class="number">1</span>)+(i&amp;<span class="number">1</span>)*(lim&gt;&gt;<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">dft</span>(a,lim,<span class="number">1</span>); <span class="built_in">dft</span>(b,lim,<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;lim;++i) a[i]=a[i]*b[i];</span><br><span class="line">    <span class="built_in">dft</span>(a,lim,<span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;lim;++i) a[i].x/=lim;</span><br><span class="line">    a.<span class="built_in">resize</span>(n); <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">vector&lt;<span class="type">long</span> <span class="type">long</span>&gt; <span class="title">trans</span><span class="params">(vector&lt;z&gt; ve)</span></span>&#123;</span><br><span class="line">    vector&lt;<span class="type">long</span> <span class="type">long</span>&gt; res;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> xx:ve) res.<span class="built_in">push_back</span>((<span class="type">long</span> <span class="type">long</span>)(xx.x&gt;<span class="number">0</span>?xx.x+<span class="number">0.5</span>:xx.x<span class="number">-0.5</span>));</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// usage</span></span><br><span class="line">vector&lt;z&gt; fa,fb;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;(r-l+<span class="number">1</span>);++i)&#123;</span><br><span class="line">    fa.<span class="built_in">push_back</span>(<span class="built_in">z</span>(f[l+i],<span class="number">0</span>));</span><br><span class="line">    fb.<span class="built_in">push_back</span>(<span class="built_in">z</span>(c[r-i],<span class="number">0</span>));</span><br><span class="line">&#125;</span><br><span class="line">vector&lt;<span class="type">long</span> <span class="type">long</span>&gt; fans=<span class="built_in">trans</span>(fa*fb);</span><br><span class="line">mx[n-(r-l)+i]+=fans[<span class="number">2</span>*(r-l)-i];</span><br></pre></td></tr></table></figure>
<h1 id="ntt">NTT</h1>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// NTT</span></span><br><span class="line"><span class="type">int</span> r[N],lo[N];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">z</span>&#123;</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    <span class="built_in">z</span>(<span class="type">int</span> x=<span class="number">0</span>):<span class="built_in">x</span>(x)&#123;&#125;</span><br><span class="line">    <span class="keyword">friend</span> z <span class="keyword">operator</span> +(z a,z b)&#123;<span class="keyword">return</span> (a.x+=b.x)&gt;=mod?a.x-mod:a.x;&#125;</span><br><span class="line">    <span class="keyword">friend</span> z <span class="keyword">operator</span> -(z a,z b)&#123;<span class="keyword">return</span> (a.x-=b.x)&lt;<span class="number">0</span>?a.x+mod:a.x;&#125;</span><br><span class="line">    <span class="keyword">friend</span> z <span class="keyword">operator</span> *(z a,z b)&#123;<span class="keyword">return</span> <span class="number">1ll</span>*a.x*b.x%mod;&#125;</span><br><span class="line">&#125;w[N],inv[N];</span><br><span class="line"><span class="function">z <span class="title">power</span><span class="params">(z x,<span class="type">int</span> y)</span></span>&#123;z t=<span class="number">1</span>;<span class="keyword">for</span>(;y;y&gt;&gt;=<span class="number">1</span>,x=x*x)<span class="keyword">if</span>(y&amp;<span class="number">1</span>)t=t*x;<span class="keyword">return</span> t;&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Glim</span><span class="params">(<span class="type">int</span> n)</span></span>&#123;<span class="type">int</span> t=<span class="number">1</span>;<span class="keyword">while</span>(t&lt;n)t&lt;&lt;=<span class="number">1</span>;<span class="keyword">return</span> t;&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span> n)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> lim=<span class="built_in">Glim</span>(n);inv[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=lim;i++)inv[i]=mod-mod/i*inv[mod%i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>,j=<span class="number">0</span>;i&lt;=lim;i&lt;&lt;=<span class="number">1</span>,j++)lo[i]=j;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;lim;i&lt;&lt;=<span class="number">1</span>)&#123;</span><br><span class="line">        z Wn=<span class="built_in">power</span>(<span class="number">3</span>,(mod<span class="number">-1</span>)/(i&lt;&lt;<span class="number">1</span>)),W=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;i;j++,W=W*Wn)w[i+j]=W;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dft</span><span class="params">(vector&lt;z&gt; &amp;a,<span class="type">int</span> lim)</span></span>&#123;</span><br><span class="line">    a.<span class="built_in">resize</span>(lim);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;lim;i++)r[i]=r[i&gt;&gt;<span class="number">1</span>]&gt;&gt;<span class="number">1</span>^(i&amp;<span class="number">1</span>)&lt;&lt;lo[lim];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;lim;i++)<span class="keyword">if</span>(i&gt;r[i])<span class="built_in">swap</span>(a[i],a[r[i]]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;lim;i&lt;&lt;=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;lim;j+=i&lt;&lt;<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;i;k++)&#123;</span><br><span class="line">                z x=a[j+k],y=a[i+j+k]*w[i+k];</span><br><span class="line">                a[j+k]=x+y;a[i+j+k]=x-y;</span><br><span class="line">            &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">idft</span><span class="params">(vector&lt;z&gt; &amp;a,<span class="type">int</span> lim)</span></span>&#123;</span><br><span class="line">    <span class="built_in">dft</span>(a,lim);<span class="built_in">reverse</span>(&amp;a[<span class="number">1</span>],&amp;a[lim]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;lim;i++)a[i]=a[i]*inv[lim];</span><br><span class="line">&#125;</span><br><span class="line">vector&lt;z&gt; <span class="keyword">operator</span> *(vector&lt;z&gt; a,vector&lt;z&gt; b)&#123;</span><br><span class="line">    <span class="type">int</span> n=a.<span class="built_in">size</span>()+b.<span class="built_in">size</span>()<span class="number">-1</span>,lim=<span class="built_in">Glim</span>(n);</span><br><span class="line">    <span class="built_in">dft</span>(a,lim);<span class="built_in">dft</span>(b,lim);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;lim;i++)a[i]=a[i]*b[i];</span><br><span class="line">    <span class="built_in">idft</span>(a,lim);a.<span class="built_in">resize</span>(n); <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="bsgs">BSGS</h1>
<h2 id="pass"><a target="_blank" rel="noopener" href="http://acm.hdu.edu.cn/showproblem.php?pid=6956">Pass!</a></h2>
<p>通过奇怪的推导得到奇怪的式子</p>
<p>使用BSGS求解</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MOD 76543</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod 998244353</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> hs[MOD], head[MOD], next[MOD], id[MOD], top;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">min</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x:y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> k = x % MOD;</span><br><span class="line">    hs[top] = x;</span><br><span class="line">    id[top] = y;</span><br><span class="line">    next[top] = head[k];</span><br><span class="line">    head[k] = top++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> k = x % MOD;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = head[k]; i != <span class="number">-1</span>; i = next[i])</span><br><span class="line">        <span class="keyword">if</span> (hs[i] == x)</span><br><span class="line">            <span class="keyword">return</span> id[i];</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">BSGS</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(head, <span class="number">-1</span>, <span class="built_in">sizeof</span>(head));</span><br><span class="line">    top = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (b == <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> m = <span class="built_in">sqrt</span>(n * <span class="number">1.0</span>), j;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> x = <span class="number">1</span>, p = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i++, p = p * a % n)</span><br><span class="line">        <span class="built_in">insert</span>(p * b % n, i);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">long</span> <span class="type">long</span> i = m; ; i += m)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> ((j = <span class="built_in">find</span>(x = x * p % n)) != <span class="number">-1</span>)</span><br><span class="line">            <span class="keyword">return</span> i - j;</span><br><span class="line">        <span class="keyword">if</span> (i &gt; n)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> T,n,x;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;T);</span><br><span class="line">    <span class="keyword">while</span>(T--)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;x);</span><br><span class="line">        <span class="type">int</span> tmp=<span class="built_in">BSGS</span>(n<span class="number">-1</span>,((ll)n*x%Mod+n<span class="number">-1</span>)%Mod,Mod),tmp1;</span><br><span class="line">        <span class="keyword">if</span>(tmp!=<span class="number">-1</span>&amp;&amp;!(tmp&amp;<span class="number">1</span>))</span><br><span class="line">            tmp=<span class="number">-1</span>;</span><br><span class="line">        tmp1=<span class="built_in">BSGS</span>(n<span class="number">-1</span>,((ll)n*x%Mod-n+<span class="number">1</span>+Mod)%Mod,Mod);</span><br><span class="line">        <span class="keyword">if</span>(tmp1!=<span class="number">-1</span>&amp;&amp;(tmp1&amp;<span class="number">1</span>))</span><br><span class="line">            tmp1=<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">if</span>(tmp==<span class="number">-1</span>&amp;&amp;tmp1==<span class="number">-1</span>)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;-1\n&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(tmp==<span class="number">-1</span>)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,tmp1);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(tmp1==<span class="number">-1</span>)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,tmp);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">min</span>(tmp,tmp1));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="burnside-and-polya">Burnside and Polya</h1>
<h2 id="讲解网址">讲解网址</h2>
<p>https://zhuanlan.zhihu.com/p/80261375</p>
<h1 id="crt">CRT</h1>
<h2 id="p2480-sdoi2010古代猪文">[P2480 <a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2480">SDOI2010]古代猪文</a></h2>
<p>CRT+Lucas定理</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 100006</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> M 999911659</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function">ll <span class="title">mi</span><span class="params">(ll x,ll y,ll Mod)</span></span>&#123;</span><br><span class="line">    ll ans=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(y)&#123;</span><br><span class="line">        <span class="keyword">if</span>(y&amp;<span class="number">1</span>)</span><br><span class="line">            ans=ans*x%Mod;</span><br><span class="line">        x=x*x%Mod;</span><br><span class="line">        y&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line">ll n,g;</span><br><span class="line">ll c[<span class="number">10</span>]=&#123;<span class="number">0</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4679</span>,<span class="number">35617</span>&#125;;</span><br><span class="line">ll ni[<span class="number">5</span>][N],tni[<span class="number">5</span>][N];</span><br><span class="line">ll k[N],cnt;</span><br><span class="line">ll jie[<span class="number">5</span>][N];</span><br><span class="line"><span class="function">ll <span class="title">C</span><span class="params">(ll n,ll m,<span class="type">int</span> ind)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(n&lt;m) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(n==m) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(m==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> jie[ind][n]*ni[ind][m]%c[ind]*ni[ind][n-m]%c[ind];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">Lucas</span><span class="params">(ll n,ll m,<span class="type">int</span> ind)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(n&lt;m) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(m==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(n==m) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Lucas</span>(n/c[ind],m/c[ind],ind)*<span class="built_in">C</span>(n%c[ind],m%c[ind],ind)%c[ind];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">4</span>;++i)&#123;</span><br><span class="line">        ni[i][<span class="number">1</span>]=tni[i][<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(ll j=<span class="number">2</span>;j&lt;c[i];++j)&#123;</span><br><span class="line">            tni[i][j]=(c[i]-c[i]/j)*tni[i][c[i]%j]%c[i];</span><br><span class="line">            ni[i][j]=tni[i][j]*ni[i][j<span class="number">-1</span>]%c[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(ll i=<span class="number">1</span>;i*i&lt;=n;++i)</span><br><span class="line">        <span class="keyword">if</span>(n%i==<span class="number">0</span>)&#123;</span><br><span class="line">            k[++cnt]=i;</span><br><span class="line">            <span class="keyword">if</span>(n/i!=i) k[++cnt]=n/i;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">4</span>;++i)&#123;</span><br><span class="line">        jie[i][<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(ll j=<span class="number">1</span>;j&lt;<span class="number">36006</span>;++j)</span><br><span class="line">            jie[i][j]=jie[i][j<span class="number">-1</span>]*j%c[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">work</span><span class="params">(<span class="type">int</span> ind)</span></span>&#123;</span><br><span class="line">    ll m=(M<span class="number">-1</span>)/c[ind];</span><br><span class="line">    ll mni=<span class="built_in">mi</span>(m,c[ind]<span class="number">-2</span>,c[ind]),res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=cnt;++i)</span><br><span class="line">        res=(res+<span class="built_in">Lucas</span>(n,k[i],ind))%c[ind];</span><br><span class="line">    <span class="keyword">return</span> res*m*mni;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ll res=<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld&quot;</span>,&amp;n,&amp;g);</span><br><span class="line">    <span class="keyword">if</span>(g%M==<span class="number">0</span>)&#123;</span><br><span class="line">        cout&lt;&lt;<span class="number">0</span>&lt;&lt;endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">Init</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">4</span>;++i)</span><br><span class="line">        res=(res+<span class="built_in">work</span>(i))%(M<span class="number">-1</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,<span class="built_in">mi</span>(g,res,M)); <span class="comment">// 如果g是M的倍数，且res=0的时候ans wrong</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="多项式求逆">多项式求逆</h1>
<h2 id="b---basel-problem"><a target="_blank" rel="noopener" href="https://vjudge.net/contest/458623#problem/B">B - Basel
Problem</a></h2>
<p>黎曼函数和伯努利函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span>  </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span>  </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span>  </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span>  </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span>  </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span>  </span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;  </span><br><span class="line">  </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LL long long  </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> eps 1e-8  </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> inf 0x3f3f3f3f  </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MP make_pair  </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 1000020</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> M 1000020</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(linker, <span class="string">&quot;/STACK:1024000000,1024000000&quot;</span>)  </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Pi acos(-1.0)  </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ls (i &lt;&lt; 1)  </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rs (ls | 1)  </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> md (ll + rr) &gt;&gt; 1  </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> lson (ll, md, ls)  </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rson (md + 1, rr, rs);</span></span><br><span class="line"><span class="comment">//const LL P = 50000000001507329LL; //190734863287 * 2 ^ 18 + 1 G = 3 常数巨大</span></span><br><span class="line"><span class="comment">// const int P = 1004535809; //479 * 2 ^ 21 + 1 G = 3</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> P = <span class="number">998244353</span>; <span class="comment">// 119 * 2 ^ 23 + 1 G = 3</span></span><br><span class="line"><span class="comment">//const int P = 104857601;  // 25 * 2 ^ 22 + 1 G = 3</span></span><br><span class="line"><span class="comment">//const int P = 167772161; // 5 * 2 ^ 25 + 1 G = 3   </span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> G = <span class="number">3</span>;    </span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> wn[<span class="number">25</span>]; </span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line">LL pow2[N];</span><br><span class="line"> </span><br><span class="line"><span class="function">LL <span class="title">mul</span><span class="params">(LL x, LL y)</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> (x * y - (LL)(x / (<span class="type">long</span> <span class="type">double</span>)P * y + <span class="number">1e-3</span>) * P + P) % P;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">qpow</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> k, <span class="type">int</span> p)</span> </span>&#123;    </span><br><span class="line">    <span class="type">int</span> ret = <span class="number">1</span>;    </span><br><span class="line">    <span class="keyword">while</span>(k) &#123;    </span><br><span class="line">        <span class="keyword">if</span>(k &amp; <span class="number">1</span>) ret = <span class="number">1LL</span> * ret * x % p;    </span><br><span class="line">        k &gt;&gt;= <span class="number">1</span>;    </span><br><span class="line">        x = <span class="number">1LL</span> * x * x % p;    </span><br><span class="line">    &#125;    </span><br><span class="line">    <span class="keyword">return</span> ret;    </span><br><span class="line">&#125;    </span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">getwn</span><span class="params">()</span> </span>&#123;    </span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">21</span>; ++i) &#123;    </span><br><span class="line">        <span class="type">int</span> t = <span class="number">1</span> &lt;&lt; i;    </span><br><span class="line">        wn[i] = <span class="built_in">qpow</span>(G, (P - <span class="number">1</span>) / t, P);    </span><br><span class="line">    &#125;    </span><br><span class="line">&#125;    </span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">change</span><span class="params">(<span class="type">int</span> *y, <span class="type">int</span> len)</span> </span>&#123;    </span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>, j = len / <span class="number">2</span>; i &lt; len - <span class="number">1</span>; ++i) &#123;    </span><br><span class="line">        <span class="keyword">if</span>(i &lt; j) <span class="built_in">swap</span>(y[i], y[j]);    </span><br><span class="line">        <span class="type">int</span> k = len / <span class="number">2</span>;    </span><br><span class="line">        <span class="keyword">while</span>(j &gt;= k) &#123;    </span><br><span class="line">            j -= k;    </span><br><span class="line">            k /= <span class="number">2</span>;    </span><br><span class="line">        &#125;    </span><br><span class="line">        j += k;    </span><br><span class="line">    &#125;    </span><br><span class="line">&#125;    </span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">NTT</span><span class="params">(<span class="type">int</span> *y, <span class="type">int</span> len, <span class="type">int</span> on)</span> </span>&#123;    </span><br><span class="line">    <span class="built_in">change</span>(y, len);    </span><br><span class="line">    <span class="type">int</span> id = <span class="number">0</span>;    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> h = <span class="number">2</span>; h &lt;= len; h &lt;&lt;= <span class="number">1</span>) &#123;    </span><br><span class="line">        ++id;    </span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; len; j += h) &#123;    </span><br><span class="line">            <span class="type">int</span> w = <span class="number">1</span>;    </span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> k = j; k &lt; j + h / <span class="number">2</span>; ++k) &#123;    </span><br><span class="line">                <span class="type">int</span> u = y[k];    </span><br><span class="line">                <span class="type">int</span> t = <span class="number">1LL</span> * y[k+h/<span class="number">2</span>] * w % P;    </span><br><span class="line">                y[k] = u + t;    </span><br><span class="line">                <span class="keyword">if</span>(y[k] &gt;= P) y[k] -= P;    </span><br><span class="line">                y[k+h/<span class="number">2</span>] = u - t + P;    </span><br><span class="line">                <span class="keyword">if</span>(y[k+h/<span class="number">2</span>] &gt;= P) y[k+h/<span class="number">2</span>] -= P;    </span><br><span class="line">                w = <span class="number">1LL</span> * w * wn[id] % P;    </span><br><span class="line">            &#125;    </span><br><span class="line">        &#125;    </span><br><span class="line">    &#125;    </span><br><span class="line">    <span class="keyword">if</span>(on == <span class="number">-1</span>) &#123;    </span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt; len / <span class="number">2</span>; ++i) <span class="built_in">swap</span>(y[i], y[len-i]);    </span><br><span class="line">        <span class="type">int</span> inv = <span class="built_in">qpow</span>(len, P - <span class="number">2</span>, P);    </span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)    </span><br><span class="line">            y[i] = <span class="number">1LL</span> * y[i] * inv % P;    </span><br><span class="line">    &#125;    </span><br><span class="line">&#125;  </span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> B[N];</span><br><span class="line"><span class="type">int</span> f[N], nf[N];</span><br><span class="line"><span class="type">int</span> a[N];</span><br><span class="line"><span class="type">int</span> tmp[N];</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">get_inv</span><span class="params">(<span class="type">int</span> A[], <span class="type">int</span> A0[], <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(t == <span class="number">1</span>) &#123;</span><br><span class="line">        A0[<span class="number">0</span>] = <span class="built_in">qpow</span>(A[<span class="number">0</span>], P - <span class="number">2</span>, P);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">get_inv</span>(A, A0, t / <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; t; ++i) tmp[i] = A[i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = t; i &lt; <span class="number">2</span> * t; ++i) tmp[i] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = t / <span class="number">2</span>; i &lt; <span class="number">2</span> * t; ++i) A0[i] = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">NTT</span>(tmp, <span class="number">2</span> * t, <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">NTT</span>(A0, <span class="number">2</span> * t, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span> * t; ++i) &#123;</span><br><span class="line">        tmp[i] = (<span class="number">2</span> - <span class="number">1LL</span> * tmp[i] * A0[i] % P) % P;</span><br><span class="line">        <span class="keyword">if</span>(tmp[i] &lt; <span class="number">0</span>) tmp[i] += P;</span><br><span class="line">        A0[i] = <span class="number">1LL</span> * A0[i] * tmp[i] % P;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">NTT</span>(A0, <span class="number">2</span> * t, <span class="number">-1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    pow2[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;N;++i) pow2[i]=pow2[i<span class="number">-1</span>]*<span class="number">2ll</span>%P;</span><br><span class="line">    f[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt; N; ++i) f[i] = <span class="number">1LL</span> * f[i<span class="number">-1</span>] * i % P;</span><br><span class="line">    nf[N<span class="number">-1</span>] = <span class="built_in">qpow</span>(f[N<span class="number">-1</span>], P - <span class="number">2</span>, P);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = N - <span class="number">2</span>; i &gt;= <span class="number">0</span>; --i) &#123;</span><br><span class="line">        nf[i] = <span class="number">1LL</span> * nf[i+<span class="number">1</span>] * (i + <span class="number">1</span>) % P;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; N - <span class="number">1</span>; ++i) a[i] = nf[i+<span class="number">1</span>];</span><br><span class="line">    <span class="type">int</span> len = <span class="number">1</span> &lt;&lt; <span class="number">18</span>;</span><br><span class="line">    <span class="built_in">get_inv</span>(a, B, len);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">        B[i] = <span class="number">1LL</span> * B[i] * f[i] % P;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;1.txt&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="built_in">getwn</span>();</span><br><span class="line">    <span class="built_in">init</span>();</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="type">int</span> cas;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;cas);</span><br><span class="line">    <span class="keyword">while</span>(cas--) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">        <span class="comment">// printf(&quot;liman=%d\n&quot;,B[n]);</span></span><br><span class="line">        LL tmp;</span><br><span class="line">        <span class="keyword">if</span>((n&gt;&gt;<span class="number">1</span>)&amp;<span class="number">1</span>) tmp=(B[n]+P)%P;</span><br><span class="line">        <span class="keyword">else</span> tmp=(-B[n]+P)%P;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,pow2[n<span class="number">-1</span>]*tmp%P*(LL)nf[n]%P);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="矩阵求逆高斯消元">矩阵求逆(高斯消元)</h1>
<h2 id="p4783-模板矩阵求逆"><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4783">P4783
【模板】矩阵求逆</a></h2>
<figure>
<img src="/1970/01/01/banzi/1-163350893337220.png" alt="1">
<figcaption aria-hidden="true">1</figcaption>
</figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 406</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod 1000000007</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function">ll <span class="title">qpow</span><span class="params">(ll x,ll y)</span></span>&#123;</span><br><span class="line">    ll ans=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(y)&#123;</span><br><span class="line">        <span class="keyword">if</span>(y&amp;<span class="number">1</span>)&#123;</span><br><span class="line">            ans=ans*x%Mod;</span><br><span class="line">        &#125;</span><br><span class="line">        x=x*x%Mod;</span><br><span class="line">        y&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line">ll a[N][N&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">calc</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123;</span><br><span class="line">        <span class="type">int</span> tx=i;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=i+<span class="number">1</span>;j&lt;=n;++j)&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">abs</span>(a[j][i])&gt;<span class="built_in">abs</span>(a[tx][i]))&#123;</span><br><span class="line">                tx=j;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(tx!=i)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=n*<span class="number">2</span>;++j)&#123;</span><br><span class="line">                <span class="built_in">swap</span>(a[tx][j],a[i][j]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!a[i][i])&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ll inv=<span class="built_in">qpow</span>(a[i][i],Mod<span class="number">-2</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=n*<span class="number">2</span>;++j)&#123;</span><br><span class="line">            a[i][j]=a[i][j]*inv%Mod;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=n;++j)&#123;</span><br><span class="line">            <span class="keyword">if</span>(j==i)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> k=n*<span class="number">2</span>;k&gt;=i;--k)&#123; <span class="comment">// 必须得倒着来，不然a[j][i]一开始就被改掉了</span></span><br><span class="line">                a[j][k]=(a[j][k]-a[i][k]*a[j][i]%Mod+Mod)%Mod;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=n;++j)&#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>,&amp;a[i][j]);</span><br><span class="line">            a[i][j]=(a[i][j]+Mod)%Mod;</span><br><span class="line">        &#125;</span><br><span class="line">        a[i][i+n]=<span class="number">1ll</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">calc</span>()==<span class="number">-1</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;No Solution\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=n+<span class="number">1</span>;j&lt;=(n&lt;&lt;<span class="number">1</span>);++j)&#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%lld%c&quot;</span>,a[i][j],<span class="string">&quot; \n&quot;</span>[j==(n&lt;&lt;<span class="number">1</span>)]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="random-walk-2"><a target="_blank" rel="noopener" href="https://acm.hdu.edu.cn/showproblem.php?pid=7016">Random Walk
2</a></h2>
<p>设<span class="math inline">\(p[i][j]\)</span>表示从<span class="math inline">\(i\)</span>走到<span class="math inline">\(j\)</span>的概率，并且规定<span class="math inline">\(i\)</span>不等于<span class="math inline">\(j\)</span>,<span class="math inline">\(p[i][i]=0\)</span></p>
<p><span class="math inline">\(f[i][j]\)</span>表示从<span class="math inline">\(i\)</span>走到<span class="math inline">\(j\)</span>没有连续经过一个点两次的概率，则<span class="math inline">\(f[i][j]=I+I*p+I*p^2+I*p^3+…\)</span></p>
<p>等比数列求和得 <span class="math inline">\(f[i][j]=I/(I-p)\)</span></p>
<p>最后<span class="math inline">\(ans[i][j]=f[i][j]*p[j][j]\)</span></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 306</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod 998244353</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function">ll <span class="title">qpow</span><span class="params">(ll x,ll y)</span></span>&#123;</span><br><span class="line">    ll ans=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(y)&#123;</span><br><span class="line">        <span class="keyword">if</span>(y&amp;<span class="number">1</span>)&#123;</span><br><span class="line">            ans=ans*x%Mod;</span><br><span class="line">        &#125;</span><br><span class="line">        x=x*x%Mod;</span><br><span class="line">        y&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> T,n;</span><br><span class="line">ll a[N][N&lt;&lt;<span class="number">1</span>],w[N][N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">calc</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123;</span><br><span class="line">        <span class="type">int</span> tx=i;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=i+<span class="number">1</span>;j&lt;=n;++j)&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">abs</span>(a[j][i])&gt;<span class="built_in">abs</span>(a[tx][i]))&#123;</span><br><span class="line">                tx=j;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(tx!=i)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=n*<span class="number">2</span>;++j)&#123;</span><br><span class="line">                <span class="built_in">swap</span>(a[tx][j],a[i][j]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!a[i][i])&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ll inv=<span class="built_in">qpow</span>(a[i][i],Mod<span class="number">-2</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=n*<span class="number">2</span>;++j)&#123;</span><br><span class="line">            a[i][j]=a[i][j]*inv%Mod;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=n;++j)&#123;</span><br><span class="line">            <span class="keyword">if</span>(j==i)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> k=n*<span class="number">2</span>;k&gt;=i;--k)&#123; <span class="comment">// 必须得倒着来，不然a[j][i]一开始就被改掉了</span></span><br><span class="line">                a[j][k]=(a[j][k]-a[i][k]*a[j][i]%Mod+Mod)%Mod;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=(n&lt;&lt;<span class="number">1</span>);++j)&#123;</span><br><span class="line">            a[i][j]=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        a[i][i+n]=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;2.txt&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;T);</span><br><span class="line">    <span class="keyword">while</span>(T--)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">        <span class="built_in">Init</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123;</span><br><span class="line">            w[i][<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=n;++j)&#123;</span><br><span class="line">                <span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>,&amp;w[i][j]);</span><br><span class="line">                w[i][<span class="number">0</span>]+=w[i][j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123;</span><br><span class="line">            ll t1=<span class="built_in">qpow</span>(w[i][<span class="number">0</span>],Mod<span class="number">-2</span>);</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=n;++j)&#123;</span><br><span class="line">                w[i][j]=w[i][j]*t1%Mod;</span><br><span class="line">                <span class="keyword">if</span>(i==j)&#123;</span><br><span class="line">                    a[i][j]=<span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    a[i][j]=(-w[i][j]%Mod+Mod)%Mod;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// for(int i=1;i&lt;=n;++i)&#123;</span></span><br><span class="line">        <span class="comment">//     for(int j=1;j&lt;=(n&lt;&lt;1);++j)&#123;</span></span><br><span class="line">        <span class="comment">//         printf(&quot;%lld%c&quot;,a[i][j],&quot; \n&quot;[j==(n&lt;&lt;1)]);</span></span><br><span class="line">        <span class="comment">//     &#125;</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">        <span class="comment">// printf(&quot;%d\n&quot;,calc());</span></span><br><span class="line">        <span class="built_in">calc</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=n+<span class="number">1</span>;j&lt;=(n&lt;&lt;<span class="number">1</span>);++j)&#123;</span><br><span class="line">                a[i][j]=a[i][j]*w[j-n][j-n]%Mod;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%lld%c&quot;</span>,a[i][j],<span class="string">&quot; \n&quot;</span>[j==(n&lt;&lt;<span class="number">1</span>)]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="线性基">线性基</h1>
<h2 id="e---odd-subrectangles"><a target="_blank" rel="noopener" href="https://atcoder.jp/contests/yahoo-procon2019-qual/tasks/yahoo_procon2019_qual_e">E
- Odd Subrectangles</a></h2>
<p>先确定行，然后考虑列，每列加和为奇数的个数为a，为偶数的是b，<span class="math inline">\(ans=2^{a-1}2^{b}=2^{m-1}\)</span></p>
<p>所以只需要求出行的组合中行异或起来为0的个数，假设矩阵的秩为c,<span class="math inline">\(num=2^n-2^{n-r}\)</span></p>
<p><span class="math inline">\(ans=2^{m-1}(2^n-2^{n-r})\)</span></p>
<h1 id="tarjan">tarjan</h1>
<h2 id="割点">割点</h2>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 200006</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> mod=<span class="number">998244353</span>;</span><br><span class="line"><span class="type">int</span> n,m;</span><br><span class="line"><span class="type">int</span> head[N],cnt,v[N],nxt[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">adde</span><span class="params">(<span class="type">int</span> t1,<span class="type">int</span> t2)</span></span>&#123;</span><br><span class="line">    ++cnt;</span><br><span class="line">    nxt[cnt]=head[t1];</span><br><span class="line">    head[t1]=cnt;</span><br><span class="line">    v[cnt]=t2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> dfn[N],low[N],tim;</span><br><span class="line"><span class="type">bool</span> fl[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> ff)</span></span>&#123;</span><br><span class="line">    dfn[x]=low[x]=++tim; <span class="type">int</span> num=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=head[x];i;i=nxt[i])</span><br><span class="line">        <span class="keyword">if</span>(v[i]!=ff)&#123;</span><br><span class="line">            <span class="keyword">if</span>(!dfn[v[i]])&#123;</span><br><span class="line">                ++num;</span><br><span class="line">                <span class="built_in">dfs</span>(v[i],x);</span><br><span class="line">                <span class="keyword">if</span>(low[x]&gt;low[v[i]]) low[x]=low[v[i]];</span><br><span class="line">                <span class="keyword">if</span>(ff!=<span class="number">-1</span>&amp;&amp;low[v[i]]&gt;=dfn[x]) fl[x]=<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(low[x]&gt;dfn[v[i]]) low[x]=dfn[v[i]];</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">if</span>(ff==<span class="number">-1</span>&amp;&amp;num&gt;<span class="number">1</span>) fl[x]=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;1.txt&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;2.txt&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="type">int</span> t1,t2;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;++i) <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;t1,&amp;t2),<span class="built_in">adde</span>(t1,t2),<span class="built_in">adde</span>(t2,t1);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i) <span class="keyword">if</span>(!dfn[i]) <span class="built_in">dfs</span>(i,<span class="number">-1</span>);</span><br><span class="line">    <span class="type">int</span> num=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i) <span class="keyword">if</span>(fl[i]) ++num;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,num);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i) <span class="keyword">if</span>(fl[i]) <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,i); <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="sam">SAM</h1>
<h2 id="p4070-sdoi2016生成魔咒">[P4070 <a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4070">SDOI2016]生成魔咒</a></h2>
<p>求一个串本质不同子串就是所有状态p len[p]-len[link[p]] 加和</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 100006</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> M 19270813</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod 20000007</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span>&#123;</span><br><span class="line">    <span class="type">int</span> len,link;</span><br><span class="line">    map&lt;<span class="type">int</span>,<span class="type">int</span>&gt; nx;</span><br><span class="line">&#125;;</span><br><span class="line">Node a[N*<span class="number">2</span>];</span><br><span class="line"><span class="type">int</span> sz,las;</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line">ll ans;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ++sz;</span><br><span class="line">    a[<span class="number">0</span>].len=<span class="number">0</span>;</span><br><span class="line">    a[<span class="number">0</span>].link=<span class="number">-1</span>;</span><br><span class="line">    las=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ins</span><span class="params">(<span class="type">int</span> c)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> now=sz++,p=las,q;</span><br><span class="line">    a[now].len=a[las].len+<span class="number">1</span>;</span><br><span class="line">    las=now;</span><br><span class="line">    <span class="keyword">while</span>(p!=<span class="number">-1</span>&amp;&amp;!a[p].nx[c])&#123;</span><br><span class="line">        a[p].nx[c]=now;</span><br><span class="line">        p=a[p].link;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(p==<span class="number">-1</span>)</span><br><span class="line">        a[now].link=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        q=a[p].nx[c];</span><br><span class="line">        <span class="keyword">if</span>(a[q].len==a[p].len+<span class="number">1</span>)</span><br><span class="line">            a[now].link=q;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="type">int</span> clone=sz++;</span><br><span class="line">            a[clone].link=a[q].link;</span><br><span class="line">            a[clone].len=a[p].len+<span class="number">1</span>;</span><br><span class="line">            a[clone].nx=a[q].nx;</span><br><span class="line">            <span class="keyword">while</span>(p!=<span class="number">-1</span>&amp;&amp;a[p].nx[c]==q)&#123;</span><br><span class="line">                a[p].nx[c]=clone;</span><br><span class="line">                p=a[p].link;</span><br><span class="line">            &#125;</span><br><span class="line">            a[now].link=a[q].link=clone;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ans+=(a[now].len-a[a[now].link].len);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> temp;</span><br><span class="line">    <span class="built_in">Init</span>();</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;temp);</span><br><span class="line">        <span class="built_in">ins</span>(temp);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="p4022-ctsc2012熟悉的文章">[P4022 <a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4022">CTSC2012]熟悉的文章</a></h2>
<p>广义SAM，多个串插入的时候，每次插入一个串之前las=0即可。</p>
<p>f[i]表示前i长度的串的匹配长度</p>
<p>f[i]=max(f[j]+i-j) (i-len&lt;=j&lt;=i-L)</p>
<p>len是到i的匹配长度</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 1100006</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> M 19270813</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod 20000007</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span>&#123;</span><br><span class="line">    <span class="type">int</span> len,link;</span><br><span class="line">    map&lt;<span class="type">int</span>,<span class="type">int</span>&gt; nx;</span><br><span class="line">&#125;;</span><br><span class="line">Node a[N*<span class="number">2</span>];</span><br><span class="line"><span class="type">int</span> las,sz;</span><br><span class="line"><span class="type">int</span> n,m,len;</span><br><span class="line"><span class="type">char</span> s[N];</span><br><span class="line"><span class="type">int</span> que[N],he,en;</span><br><span class="line"><span class="type">int</span> f[N],tem[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ++sz;</span><br><span class="line">    a[<span class="number">0</span>].len=<span class="number">0</span>;</span><br><span class="line">    a[<span class="number">0</span>].link=<span class="number">-1</span>;</span><br><span class="line">    las=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ins</span><span class="params">(<span class="type">int</span> c)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> now=sz++,p=las,q;</span><br><span class="line">    las=now;</span><br><span class="line">    a[now].len=a[p].len+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(p!=<span class="number">-1</span>&amp;&amp;!a[p].nx[c])&#123;</span><br><span class="line">        a[p].nx[c]=now;</span><br><span class="line">        p=a[p].link;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(p==<span class="number">-1</span>)</span><br><span class="line">        a[now].link=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        q=a[p].nx[c];</span><br><span class="line">        <span class="keyword">if</span>(a[q].len==a[p].len+<span class="number">1</span>)</span><br><span class="line">            a[now].link=q;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="type">int</span> clone=sz++;</span><br><span class="line">            a[clone].len=a[p].len+<span class="number">1</span>;</span><br><span class="line">            a[clone].link=a[q].link;</span><br><span class="line">            a[clone].nx=a[q].nx;</span><br><span class="line">            <span class="keyword">while</span>(p!=<span class="number">-1</span>&amp;&amp;a[p].nx[c]==q)&#123;</span><br><span class="line">                a[p].nx[c]=clone;</span><br><span class="line">                p=a[p].link;</span><br><span class="line">            &#125;</span><br><span class="line">            a[now].link=a[q].link=clone;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">check</span><span class="params">(<span class="type">int</span> L)</span></span>&#123;</span><br><span class="line">    he=<span class="number">1</span>; en=<span class="number">0</span>;</span><br><span class="line">    f[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=len;++i)&#123;</span><br><span class="line">        f[i]=f[i<span class="number">-1</span>];</span><br><span class="line">        <span class="keyword">if</span>(i&lt;L) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">while</span>(en&gt;=he&amp;&amp;f[que[en]]-que[en]&lt;f[i-L]-i+L)<span class="comment">// 我他妈竟然写成了f[que[en]]-que[en]&lt;f[i]-i</span></span><br><span class="line">            --en;</span><br><span class="line">        que[++en]=i-L;</span><br><span class="line">        <span class="keyword">while</span>(en&gt;=he&amp;&amp;que[he]&lt;i-tem[i])</span><br><span class="line">            ++he;</span><br><span class="line">        <span class="keyword">if</span>(en&gt;=he)</span><br><span class="line">            f[i]=<span class="built_in">max</span>(f[i],i+f[que[he]]-que[he]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> f[len]*<span class="number">10</span>&gt;=<span class="number">9</span>*len;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> l,r,mid,res;</span><br><span class="line">    <span class="type">int</span> now,temp,cc;</span><br><span class="line">    <span class="built_in">Init</span>();</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;++i)&#123;</span><br><span class="line">        las=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,s);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;s[j];++j)</span><br><span class="line">            <span class="built_in">ins</span>(s[j]-<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,s+<span class="number">1</span>);</span><br><span class="line">        len=<span class="built_in">strlen</span>(s+<span class="number">1</span>);</span><br><span class="line">        now=<span class="number">0</span>; temp=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=len;++j)&#123;</span><br><span class="line">            cc=s[j]-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">            <span class="keyword">if</span>(a[now].nx[cc])&#123;</span><br><span class="line">                now=a[now].nx[cc];</span><br><span class="line">                ++temp;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">while</span>(now!=<span class="number">-1</span>&amp;&amp;!a[now].nx[cc])</span><br><span class="line">                    now=a[now].link;</span><br><span class="line">                <span class="keyword">if</span>(now==<span class="number">-1</span>)&#123;</span><br><span class="line">                    now=<span class="number">0</span>; temp=<span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    temp=a[now].len+<span class="number">1</span>;</span><br><span class="line">                    now=a[now].nx[cc];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            tem[j]=temp;</span><br><span class="line">        &#125;</span><br><span class="line">        l=<span class="number">1</span>; r=len; res=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(l&lt;=r)&#123;</span><br><span class="line">            mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">check</span>(mid))&#123;</span><br><span class="line">                res=mid;</span><br><span class="line">                l=mid+<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                r=mid<span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,res);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="display-substring"><a target="_blank" rel="noopener" href="https://acm.hdu.edu.cn/showproblem.php?pid=6988">Display
Substring</a></h2>
<p>二分答案，也就是k小的值是多少</p>
<p>然后在后缀自动机上进行二分，利用了每一个节点表示一个
右端点相同的左端点区间的后缀 ，对左端点进行二分，计算个数即可。。。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 1000006</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ull unsigned long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod 1000000007</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> c[<span class="number">30</span>],sum[N],n,T;</span><br><span class="line">ll k;</span><br><span class="line"><span class="type">char</span> ss[N];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">automaton</span>&#123;</span><br><span class="line">    <span class="type">int</span> len[N&lt;&lt;<span class="number">1</span>],link[N&lt;&lt;<span class="number">1</span>],las,cnt;</span><br><span class="line">    <span class="type">int</span> ch[N&lt;&lt;<span class="number">1</span>][<span class="number">26</span>];</span><br><span class="line">    <span class="type">int</span> pos[N&lt;&lt;<span class="number">1</span>]; <span class="comment">// 记录当前节点表示状态后缀的右端点位置</span></span><br><span class="line">    <span class="type">int</span> head[N&lt;&lt;<span class="number">1</span>],num,nxt[N&lt;&lt;<span class="number">2</span>],v[N&lt;&lt;<span class="number">2</span>];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> t1,<span class="type">int</span> t2)</span></span>&#123;</span><br><span class="line">        ++num;</span><br><span class="line">        nxt[num]=head[t1];</span><br><span class="line">        head[t1]=num;</span><br><span class="line">        v[num]=t2;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Initsin</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">26</span>;++i)&#123;</span><br><span class="line">            ch[x][i]=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Init</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="built_in">Initsin</span>(<span class="number">0</span>);</span><br><span class="line">        cnt=<span class="number">1</span>;</span><br><span class="line">        len[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">        link[<span class="number">0</span>]=<span class="number">-1</span>;</span><br><span class="line">        las=<span class="number">0</span>;</span><br><span class="line">        num=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=(n&lt;&lt;<span class="number">1</span>);++i)&#123;</span><br><span class="line">            head[i]=<span class="number">0</span>;</span><br><span class="line">            pos[i]=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addchar</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="type">int</span> now=cnt++,p,q;</span><br><span class="line">        <span class="built_in">Initsin</span>(now);</span><br><span class="line">        p=las;</span><br><span class="line">        len[now]=len[las]+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(p!=<span class="number">-1</span>&amp;&amp;!ch[p][x])&#123;</span><br><span class="line">            ch[p][x]=now;</span><br><span class="line">            p=link[p];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(p==<span class="number">-1</span>)&#123;</span><br><span class="line">            link[now]=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            q=ch[p][x];</span><br><span class="line">            <span class="keyword">if</span>(len[q]==len[p]+<span class="number">1</span>)&#123;</span><br><span class="line">                link[now]=q;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="type">int</span> clone=cnt++;</span><br><span class="line">                len[clone]=len[p]+<span class="number">1</span>;</span><br><span class="line">                link[clone]=link[q];</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">26</span>;++i)&#123;</span><br><span class="line">                    ch[clone][i]=ch[q][i];</span><br><span class="line">                &#125;</span><br><span class="line">                link[q]=clone; link[now]=clone;</span><br><span class="line">                <span class="keyword">while</span>(p!=<span class="number">-1</span>&amp;&amp;ch[p][x]==q)&#123;</span><br><span class="line">                    ch[p][x]=clone;</span><br><span class="line">                    p=link[p];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        las=now;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">dfs1</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=head[x];i;i=nxt[i])&#123;</span><br><span class="line">            <span class="built_in">dfs1</span>(v[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!pos[x])&#123;</span><br><span class="line">            pos[x]=pos[v[head[x]]];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addstr</span><span class="params">(<span class="type">char</span> * s,<span class="type">int</span> len)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=len;++i)&#123;</span><br><span class="line">            <span class="built_in">addchar</span>(s[i]-<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">            pos[las]=i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;cnt;++i)&#123;</span><br><span class="line">            <span class="built_in">add</span>(link[i],i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">dfs1</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">check</span><span class="params">(<span class="type">int</span> val)</span></span>&#123;</span><br><span class="line">        ll ans=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;cnt;++i)&#123;</span><br><span class="line">            <span class="type">int</span> p=pos[i],l=p-len[i]+<span class="number">1</span>,r=p-len[link[i]],mid;</span><br><span class="line">            <span class="keyword">while</span>(l&lt;r)&#123;</span><br><span class="line">                mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span>(sum[p]-sum[mid<span class="number">-1</span>]&lt;=val)&#123;</span><br><span class="line">                    r=mid;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    l=mid+<span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(sum[p]-sum[l<span class="number">-1</span>]&lt;=val)&#123;</span><br><span class="line">                ans+=(p-len[link[i]]-l+<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans&gt;=k;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;autom;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> len;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;T);</span><br><span class="line">    <span class="keyword">while</span>(T--)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%s&quot;</span>,&amp;n,&amp;k,ss+<span class="number">1</span>);</span><br><span class="line">        len=<span class="built_in">strlen</span>(ss+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">26</span>;++i)&#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;c[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        sum[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=len;++i)&#123;</span><br><span class="line">            sum[i]=sum[i<span class="number">-1</span>]+c[ss[i]-<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        autom.<span class="built_in">Init</span>();</span><br><span class="line">        autom.<span class="built_in">addstr</span>(ss,len);</span><br><span class="line">        <span class="type">int</span> l=<span class="number">1</span>,r=sum[len],mid;</span><br><span class="line">        <span class="keyword">while</span>(l&lt;r)&#123;</span><br><span class="line">            mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(autom.<span class="built_in">check</span>(mid))&#123;</span><br><span class="line">                r=mid;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                l=mid+<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(autom.<span class="built_in">check</span>(l))&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,l);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;-1\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="ac自动机">AC自动机</h1>
<h2 id="searching-the-stringzoj-3228">Searching the
String（ZOJ-3228）</h2>
<p>题意：多组数据，每组给出一个文本和 n 个模式，0 代表能重叠，1
代表不能重叠，求每个模版串在文本串中出现的次数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;utility&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PI acos(-1.0)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> E 1e-9</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INF 0x3f3f3f3f</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LL long long</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MOD=<span class="number">10007</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">500000</span>+<span class="number">5</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> dx[]= &#123;<span class="number">-1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> dy[]= &#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">-1</span>,<span class="number">1</span>&#125;;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">AC_Automata</span>&#123;</span><br><span class="line">    <span class="type">int</span> tire[N][<span class="number">26</span>];<span class="comment">//字典树</span></span><br><span class="line">    <span class="type">int</span> val[N];<span class="comment">//字符串结尾标记</span></span><br><span class="line">    <span class="type">int</span> fail[N];<span class="comment">//失配指针</span></span><br><span class="line">    <span class="type">int</span> last[N];<span class="comment">//last[i]=j表j节点表示的单词是i节点单词的后缀，且j节点是单词节点</span></span><br><span class="line">    <span class="type">int</span> tot;<span class="comment">//编号</span></span><br><span class="line">    <span class="type">int</span> time[N];<span class="comment">//上次的单词出现在文本串的位置</span></span><br><span class="line">    <span class="type">int</span> len[N];<span class="comment">//单词节点的长度</span></span><br><span class="line">    <span class="type">int</span> cnt[N][<span class="number">2</span>];<span class="comment">//计数</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;<span class="comment">//初始化0号点</span></span><br><span class="line">        tot=<span class="number">1</span>;</span><br><span class="line">        val[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">        last[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">        fail[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">memset</span>(tire[<span class="number">0</span>],<span class="number">0</span>,<span class="built_in">sizeof</span>(tire[<span class="number">0</span>]));</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">char</span> *s)</span></span>&#123;<span class="comment">//构造trie</span></span><br><span class="line">        <span class="type">int</span> sLen=<span class="built_in">strlen</span>(s);</span><br><span class="line">        <span class="type">int</span> root=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;sLen;i++)&#123;</span><br><span class="line">            <span class="type">int</span> id=s[i]-<span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">            <span class="keyword">if</span>(tire[root][id]==<span class="number">0</span>)&#123;</span><br><span class="line">                tire[root][id]=tot;</span><br><span class="line">                <span class="built_in">memset</span>(tire[tot],<span class="number">0</span>,<span class="built_in">sizeof</span>(tire[tot]));</span><br><span class="line">                val[tot++]=<span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            root=tire[root][id];</span><br><span class="line">        &#125;</span><br><span class="line">        val[root]=<span class="number">1</span>;</span><br><span class="line">        time[root]=<span class="number">0</span>;</span><br><span class="line">        len[root]=sLen;</span><br><span class="line">        cnt[root][<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">        cnt[root][<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">()</span></span>&#123;<span class="comment">//构造fail与last</span></span><br><span class="line">        queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">26</span>;i++)&#123;</span><br><span class="line">            <span class="type">int</span> root=tire[<span class="number">0</span>][i];</span><br><span class="line">            <span class="keyword">if</span>(root!=<span class="number">0</span>)&#123;</span><br><span class="line">                fail[root]=<span class="number">0</span>;</span><br><span class="line">                last[root]=<span class="number">0</span>;</span><br><span class="line">                q.<span class="built_in">push</span>(root);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">while</span>(!q.<span class="built_in">empty</span>())&#123;<span class="comment">//bfs求fail</span></span><br><span class="line">            <span class="type">int</span> k=q.<span class="built_in">front</span>();</span><br><span class="line">            q.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">26</span>; i++)&#123;</span><br><span class="line">                <span class="type">int</span> u=tire[k][i];</span><br><span class="line">                <span class="keyword">if</span>(u==<span class="number">0</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                q.<span class="built_in">push</span>(u);</span><br><span class="line"> </span><br><span class="line">                <span class="type">int</span> v=fail[k];</span><br><span class="line">                <span class="keyword">while</span>(v &amp;&amp; tire[v][i]==<span class="number">0</span>)</span><br><span class="line">                    v=fail[v];</span><br><span class="line">                fail[u]=tire[v][i];</span><br><span class="line">                last[u]=val[fail[u]]?fail[u]:last[fail[u]];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">query</span><span class="params">(<span class="type">char</span> *s)</span></span>&#123;<span class="comment">//匹配</span></span><br><span class="line">        <span class="type">int</span> len=<span class="built_in">strlen</span>(s);</span><br><span class="line">        <span class="type">int</span> j=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">            <span class="type">int</span> id=s[i]-<span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">            <span class="keyword">while</span>(j &amp;&amp; tire[j][id]==<span class="number">0</span>)</span><br><span class="line">                j=fail[j];</span><br><span class="line">            j=tire[j][id];</span><br><span class="line">            <span class="keyword">if</span>(val[j])</span><br><span class="line">                <span class="built_in">print</span>(j,i+<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(last[j])</span><br><span class="line">                <span class="built_in">print</span>(last[j],i+<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(<span class="type">int</span> i,<span class="type">int</span> pos)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(val[i])&#123;</span><br><span class="line">            cnt[i][<span class="number">0</span>]++;</span><br><span class="line">            <span class="keyword">if</span>(time[i]+len[i]&lt;=pos)&#123;<span class="comment">//判断是否有重叠</span></span><br><span class="line">                time[i]=pos;</span><br><span class="line">                cnt[i][<span class="number">1</span>]++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">print</span>(last[i],pos);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">queryT</span><span class="params">(<span class="type">char</span> *s,<span class="type">int</span> op)</span></span>&#123;<span class="comment">//匹配单个文本</span></span><br><span class="line">        <span class="type">int</span> len=<span class="built_in">strlen</span>(s);</span><br><span class="line">        <span class="type">int</span> root=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">            <span class="type">int</span> id=s[i]-<span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">            root=tire[root][id];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cnt[root][op];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;ac;</span><br><span class="line"><span class="type">char</span> P[N][<span class="number">10</span>];</span><br><span class="line"><span class="type">char</span> T[N];</span><br><span class="line"><span class="type">int</span> op[N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> Case=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,T)!=EOF)&#123;</span><br><span class="line">        ac.<span class="built_in">init</span>();</span><br><span class="line"> </span><br><span class="line">        <span class="type">int</span> n;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d%s&quot;</span>,&amp;op[i],P[i]);</span><br><span class="line">            ac.<span class="built_in">insert</span>(P[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        ac.<span class="built_in">build</span>();</span><br><span class="line">        ac.<span class="built_in">query</span>(T);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Case %d\n&quot;</span>,Case++);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ac.<span class="built_in">queryT</span>(P[i],op[i]));</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="广义sam">广义SAM</h1>
<h2 id="p6139-模板广义后缀自动机广义-sam"><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P6139">P6139
【模板】广义后缀自动机（广义 SAM）</a></h2>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> dd double</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod 998244353</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">2000006</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> CHARSZ=<span class="number">26</span>;</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">char</span> s[N];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">exSAM</span>&#123;</span><br><span class="line">    <span class="type">int</span> nxt[N][CHARSZ],cnt,len[N],link[N];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Init</span><span class="params">()</span></span>&#123;</span><br><span class="line">        cnt=<span class="number">0</span>;</span><br><span class="line">        link[<span class="number">0</span>]=<span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">samins</span><span class="params">(<span class="type">int</span> las,<span class="type">int</span> c)</span></span>&#123;</span><br><span class="line">        <span class="type">int</span> cur=nxt[las][c];</span><br><span class="line">        <span class="keyword">if</span>(len[cur]) <span class="keyword">return</span> cur;</span><br><span class="line">        len[cur]=len[las]+<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> p=link[las];</span><br><span class="line">        <span class="keyword">while</span>(p!=<span class="number">-1</span>&amp;&amp;!nxt[p][c])&#123;</span><br><span class="line">            nxt[p][c]=cur;</span><br><span class="line">            p=link[p];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(p==<span class="number">-1</span>) link[cur]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="type">int</span> q=nxt[p][c];</span><br><span class="line">            <span class="keyword">if</span>(len[q]==len[p]+<span class="number">1</span>) link[cur]=q;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="type">int</span> clone=++cnt;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;CHARSZ;++i) nxt[clone][i]=len[nxt[q][i]]!=<span class="number">0</span>?nxt[q][i]:<span class="number">0</span>;</span><br><span class="line">                len[clone]=len[p]+<span class="number">1</span>;</span><br><span class="line">                link[clone]=link[q];</span><br><span class="line">                <span class="keyword">while</span>(p!=<span class="number">-1</span>&amp;&amp;nxt[p][c]==q)&#123;</span><br><span class="line">                    nxt[p][c]=clone;</span><br><span class="line">                    p=link[p];</span><br><span class="line">                &#125;</span><br><span class="line">                link[cur]=link[q]=clone;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cur;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">char</span> *s,<span class="type">int</span> len)</span></span>&#123;</span><br><span class="line">        <span class="type">int</span> now=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;++i)&#123;</span><br><span class="line">            <span class="keyword">if</span>(!nxt[now][s[i]-<span class="string">&#x27;a&#x27;</span>]) nxt[now][s[i]-<span class="string">&#x27;a&#x27;</span>]=++cnt;</span><br><span class="line">            now=nxt[now][s[i]-<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">()</span></span>&#123;</span><br><span class="line">        queue&lt;pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt;&gt; que;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;CHARSZ;++i) <span class="keyword">if</span>(nxt[<span class="number">0</span>][i]) que.<span class="built_in">push</span>(&#123;<span class="number">0</span>,i&#125;);</span><br><span class="line">        <span class="keyword">while</span>(!que.<span class="built_in">empty</span>())&#123;</span><br><span class="line">            <span class="keyword">auto</span> thi=que.<span class="built_in">front</span>();</span><br><span class="line">            <span class="type">int</span> las=<span class="built_in">samins</span>(thi.first,thi.second);</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;CHARSZ;++i) <span class="keyword">if</span>(nxt[las][i]) que.<span class="built_in">push</span>(&#123;las,i&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">ll <span class="title">calc</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ll ans=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=cnt;++i)&#123;</span><br><span class="line">            ans+=(len[i]-len[link[i]]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;sam;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;1.txt&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;2.txt&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">    sam.<span class="built_in">Init</span>();</span><br><span class="line">    <span class="keyword">while</span>(n--)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,s);</span><br><span class="line">        sam.<span class="built_in">insert</span>(s,<span class="built_in">strlen</span>(s));</span><br><span class="line">    &#125;</span><br><span class="line">    sam.<span class="built_in">build</span>();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,sam.<span class="built_in">calc</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="lcs2---longest-common-substring-ii"><a target="_blank" rel="noopener" href="https://www.spoj.com/problems/LCS2/">LCS2 - Longest Common
Substring II</a></h2>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> dd double</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod 998244353</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">2000006</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> CHARSZ=<span class="number">26</span>;</span><br><span class="line"><span class="type">int</span> n,nums,ind[N];</span><br><span class="line">string s;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">exSAM</span>&#123;</span><br><span class="line">    <span class="type">int</span> nxt[N][CHARSZ],cnt,len[N],link[N],num[N][<span class="number">10</span>];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Init</span><span class="params">()</span></span>&#123;</span><br><span class="line">        cnt=<span class="number">0</span>;</span><br><span class="line">        link[<span class="number">0</span>]=<span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">samins</span><span class="params">(<span class="type">int</span> las,<span class="type">int</span> c)</span></span>&#123;</span><br><span class="line">        <span class="type">int</span> cur=nxt[las][c];</span><br><span class="line">        <span class="keyword">if</span>(len[cur]) <span class="keyword">return</span> cur;</span><br><span class="line">        len[cur]=len[las]+<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> p=link[las];</span><br><span class="line">        <span class="keyword">while</span>(p!=<span class="number">-1</span>&amp;&amp;!nxt[p][c])&#123;</span><br><span class="line">            nxt[p][c]=cur;</span><br><span class="line">            p=link[p];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(p==<span class="number">-1</span>) link[cur]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="type">int</span> q=nxt[p][c];</span><br><span class="line">            <span class="keyword">if</span>(len[q]==len[p]+<span class="number">1</span>) link[cur]=q;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="type">int</span> clone=++cnt;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;CHARSZ;++i) nxt[clone][i]=len[nxt[q][i]]!=<span class="number">0</span>?nxt[q][i]:<span class="number">0</span>;</span><br><span class="line">                len[clone]=len[p]+<span class="number">1</span>;</span><br><span class="line">                link[clone]=link[q];</span><br><span class="line">                <span class="keyword">while</span>(p!=<span class="number">-1</span>&amp;&amp;nxt[p][c]==q)&#123;</span><br><span class="line">                    nxt[p][c]=clone;</span><br><span class="line">                    p=link[p];</span><br><span class="line">                &#125;</span><br><span class="line">                link[cur]=link[q]=clone;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cur;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(string &amp;s,<span class="type">int</span> len,<span class="type">int</span> idx)</span></span>&#123;</span><br><span class="line">        <span class="type">int</span> now=<span class="number">0</span>;</span><br><span class="line">        ++num[now][idx];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;++i)&#123;</span><br><span class="line">            <span class="keyword">if</span>(!nxt[now][s[i]-<span class="string">&#x27;a&#x27;</span>]) nxt[now][s[i]-<span class="string">&#x27;a&#x27;</span>]=++cnt;</span><br><span class="line">            now=nxt[now][s[i]-<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">            ++num[now][idx];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">()</span></span>&#123;</span><br><span class="line">        queue&lt;pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt;&gt; que;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;CHARSZ;++i) <span class="keyword">if</span>(nxt[<span class="number">0</span>][i]) que.<span class="built_in">push</span>(&#123;<span class="number">0</span>,i&#125;);</span><br><span class="line">        <span class="keyword">while</span>(!que.<span class="built_in">empty</span>())&#123;</span><br><span class="line">            <span class="keyword">auto</span> thi=que.<span class="built_in">front</span>();</span><br><span class="line">            <span class="type">int</span> las=<span class="built_in">samins</span>(thi.first,thi.second);</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;CHARSZ;++i) <span class="keyword">if</span>(nxt[las][i]) que.<span class="built_in">push</span>(&#123;las,i&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;sam;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span><span class="params">(<span class="type">int</span> t1,<span class="type">int</span> t2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> sam.len[t1]&lt;sam.len[t2];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">calc</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=sam.cnt;++i) ind[i]=i;</span><br><span class="line">    <span class="built_in">sort</span>(ind+<span class="number">1</span>,ind+<span class="number">1</span>+sam.cnt,cmp);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=sam.cnt;i;--i)&#123;</span><br><span class="line">        <span class="keyword">if</span>(sam.link[ind[i]]!=<span class="number">-1</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;nums;++j)&#123;</span><br><span class="line">                sam.num[sam.link[ind[i]]][j]+=sam.num[ind[i]][j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=sam.cnt;++i)&#123;</span><br><span class="line">        <span class="type">int</span> fla=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;nums;++j)&#123;</span><br><span class="line">            <span class="keyword">if</span>(!sam.num[i][j])&#123;</span><br><span class="line">                fla=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(fla) ans=<span class="built_in">max</span>(ans,sam.len[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;1.txt&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;2.txt&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    sam.<span class="built_in">Init</span>();</span><br><span class="line">    <span class="keyword">while</span>((cin&gt;&gt;s))&#123;</span><br><span class="line">        sam.<span class="built_in">insert</span>(s,s.<span class="built_in">size</span>(),nums++);</span><br><span class="line">    &#125;</span><br><span class="line">    sam.<span class="built_in">build</span>();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">calc</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="数位dp">数位DP</h1>
<h2 id="p4127-ahoi2009同类分布">[P4127 <a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4127">AHOI2009]同类分布</a></h2>
<p>枚举模数有点强</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 1000006</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> a[<span class="number">23</span>],len;</span><br><span class="line">ll f[<span class="number">23</span>][<span class="number">206</span>][<span class="number">206</span>][<span class="number">2</span>];</span><br><span class="line"><span class="function">ll <span class="title">dfs</span><span class="params">(<span class="type">int</span> pos,<span class="type">int</span> sum,<span class="type">int</span> allval,<span class="type">int</span> lim,<span class="type">int</span> mod)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!pos)&#123;</span><br><span class="line">        <span class="keyword">if</span>(sum==mod&amp;&amp;!allval) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(f[pos][sum][allval][lim]!=<span class="number">-1</span>)</span><br><span class="line">        <span class="keyword">return</span> f[pos][sum][allval][lim];</span><br><span class="line">    <span class="type">int</span> en=lim?a[pos]:<span class="number">9</span>;</span><br><span class="line">    ll res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=en;++i)&#123;</span><br><span class="line">        res+=<span class="built_in">dfs</span>(pos<span class="number">-1</span>,sum+i,(allval*<span class="number">10</span>+i)%mod,lim&amp;(i==a[pos]),mod);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> f[pos][sum][allval][lim]=res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Init</span><span class="params">(ll x)</span></span>&#123;</span><br><span class="line">    len=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(x)&#123;</span><br><span class="line">        a[++len]=x%<span class="number">10</span>;</span><br><span class="line">        x/=<span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">work</span><span class="params">(ll x)</span></span>&#123;</span><br><span class="line">    <span class="built_in">Init</span>(x);</span><br><span class="line">    ll res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">9</span>*len;++i)&#123;</span><br><span class="line">        <span class="built_in">memset</span>(f,<span class="number">-1</span>,<span class="built_in">sizeof</span>(f));</span><br><span class="line">        res+=<span class="built_in">dfs</span>(len,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ll t1,t2;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld&quot;</span>,&amp;t1,&amp;t2);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,<span class="built_in">work</span>(t2)-<span class="built_in">work</span>(t1<span class="number">-1</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="动态dp">动态dp</h1>
<p>不知道单位矩阵就别瞎定义。。。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> dd double</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">100006</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> mod=<span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Matrix</span>&#123;</span><br><span class="line">    ll b[<span class="number">2</span>][<span class="number">2</span>];</span><br><span class="line">    <span class="built_in">Matrix</span>()&#123;<span class="built_in">memset</span>(b,<span class="number">0</span>,<span class="built_in">sizeof</span>(b));&#125;</span><br><span class="line">    Matrix <span class="keyword">operator</span> * (Matrix c)&#123;</span><br><span class="line">        Matrix tmp;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">2</span>;++i)</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;<span class="number">2</span>;++j)</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;<span class="number">2</span>;++k)</span><br><span class="line">                    tmp.b[i][j]=<span class="built_in">max</span>(tmp.b[i][j],<span class="keyword">this</span>-&gt;b[i][k]+c.b[k][j]);</span><br><span class="line">        <span class="keyword">return</span> tmp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;val[N],data[N&lt;&lt;<span class="number">2</span>],sing;</span><br><span class="line"><span class="type">int</span> n,m,vv[N];</span><br><span class="line"><span class="type">int</span> head[N],cnt,v[N&lt;&lt;<span class="number">1</span>],nxt[N&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">adde</span><span class="params">(<span class="type">int</span> t1,<span class="type">int</span> t2)</span></span>&#123;</span><br><span class="line">    ++cnt;</span><br><span class="line">    nxt[cnt]=head[t1];</span><br><span class="line">    head[t1]=cnt;</span><br><span class="line">    v[cnt]=t2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> fa[N],sz[N],son[N],top[N],idx[N],tim,ed[N],anti[N];</span><br><span class="line">ll f[N][<span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs1</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    sz[x]=<span class="number">1</span>; f[x][<span class="number">1</span>]=vv[x];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=head[x];i;i=nxt[i])</span><br><span class="line">        <span class="keyword">if</span>(v[i]!=fa[x])&#123;</span><br><span class="line">            fa[v[i]]=x;</span><br><span class="line">            <span class="built_in">dfs1</span>(v[i]);</span><br><span class="line">            f[x][<span class="number">1</span>]+=f[v[i]][<span class="number">0</span>];</span><br><span class="line">            f[x][<span class="number">0</span>]+=<span class="built_in">max</span>(f[v[i]][<span class="number">0</span>],f[v[i]][<span class="number">1</span>]);</span><br><span class="line">            sz[x]+=sz[v[i]];</span><br><span class="line">            <span class="keyword">if</span>(!son[x]||sz[son[x]]&lt;sz[v[i]]) son[x]=v[i];</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs2</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> tp)</span></span>&#123;</span><br><span class="line">    idx[x]=++tim; top[x]=tp; ed[tp]=tim; anti[tim]=x;</span><br><span class="line">    <span class="keyword">if</span>(son[x]) <span class="built_in">dfs2</span>(son[x],tp);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=head[x];i;i=nxt[i])</span><br><span class="line">        <span class="keyword">if</span>(v[i]!=fa[x]&amp;&amp;v[i]!=son[x])</span><br><span class="line">            <span class="built_in">dfs2</span>(v[i],v[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">psu</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    data[x]=data[x&lt;&lt;<span class="number">1</span>]*data[x&lt;&lt;<span class="number">1</span>|<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l&gt;r) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="keyword">if</span>(l==r)&#123;</span><br><span class="line">        ll t0=<span class="number">0</span>,t1=vv[anti[l]];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=head[anti[l]];i;i=nxt[i])</span><br><span class="line">            <span class="keyword">if</span>(v[i]!=son[anti[l]]&amp;&amp;v[i]!=fa[anti[l]])&#123;</span><br><span class="line">                t0+=<span class="built_in">max</span>(f[v[i]][<span class="number">1</span>],f[v[i]][<span class="number">0</span>]);</span><br><span class="line">                t1+=f[v[i]][<span class="number">0</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        val[anti[l]].b[<span class="number">0</span>][<span class="number">0</span>]=val[anti[l]].b[<span class="number">0</span>][<span class="number">1</span>]=t0;</span><br><span class="line">        val[anti[l]].b[<span class="number">1</span>][<span class="number">0</span>]=t1; val[anti[l]].b[<span class="number">1</span>][<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">        data[x]=val[anti[l]];</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">build</span>(l,mid,x&lt;&lt;<span class="number">1</span>); <span class="built_in">build</span>(mid+<span class="number">1</span>,r,x&lt;&lt;<span class="number">1</span>|<span class="number">1</span>); <span class="built_in">psu</span>(x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">modi</span><span class="params">(<span class="type">int</span> pos,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l&gt;r) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="keyword">if</span>(l==r)&#123;data[x]=val[anti[l]];<span class="keyword">return</span>;&#125;</span><br><span class="line">    <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(pos&lt;=mid) <span class="built_in">modi</span>(pos,l,mid,x&lt;&lt;<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">modi</span>(pos,mid+<span class="number">1</span>,r,x&lt;&lt;<span class="number">1</span>|<span class="number">1</span>); <span class="built_in">psu</span>(x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">Matrix <span class="title">que</span><span class="params">(<span class="type">int</span> L,<span class="type">int</span> R,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(L&lt;=l&amp;&amp;r&lt;=R) <span class="keyword">return</span> data[x];</span><br><span class="line">    <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(R&lt;=mid) <span class="keyword">return</span> <span class="built_in">que</span>(L,R,l,mid,x&lt;&lt;<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(L&gt;mid) <span class="keyword">return</span> <span class="built_in">que</span>(L,R,mid+<span class="number">1</span>,r,x&lt;&lt;<span class="number">1</span>|<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">que</span>(L,R,l,mid,x&lt;&lt;<span class="number">1</span>)*<span class="built_in">que</span>(L,R,mid+<span class="number">1</span>,r,x&lt;&lt;<span class="number">1</span>|<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Modi</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> nwv)</span></span>&#123;</span><br><span class="line">    val[x].b[<span class="number">1</span>][<span class="number">0</span>]+=(nwv-vv[x]);</span><br><span class="line">    vv[x]=nwv;</span><br><span class="line">    Matrix od,nw;</span><br><span class="line">    <span class="keyword">while</span>(x)&#123;</span><br><span class="line">        od=<span class="built_in">que</span>(idx[top[x]],ed[top[x]],<span class="number">1</span>,n,<span class="number">1</span>);</span><br><span class="line">        <span class="built_in">modi</span>(idx[x],<span class="number">1</span>,n,<span class="number">1</span>);</span><br><span class="line">        nw=<span class="built_in">que</span>(idx[top[x]],ed[top[x]],<span class="number">1</span>,n,<span class="number">1</span>);</span><br><span class="line">        x=fa[top[x]];</span><br><span class="line">        val[x].b[<span class="number">0</span>][<span class="number">0</span>]+=(<span class="built_in">max</span>(nw.b[<span class="number">0</span>][<span class="number">0</span>],nw.b[<span class="number">1</span>][<span class="number">0</span>])-<span class="built_in">max</span>(od.b[<span class="number">0</span>][<span class="number">0</span>],od.b[<span class="number">1</span>][<span class="number">0</span>]));</span><br><span class="line">        val[x].b[<span class="number">0</span>][<span class="number">1</span>]=val[x].b[<span class="number">0</span>][<span class="number">0</span>];</span><br><span class="line">        val[x].b[<span class="number">1</span>][<span class="number">0</span>]+=(nw.b[<span class="number">0</span>][<span class="number">0</span>]-od.b[<span class="number">0</span>][<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;1.txt&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;2.txt&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;vv[i]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;++i)&#123;</span><br><span class="line">        <span class="type">int</span> t1,t2; <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;t1,&amp;t2);</span><br><span class="line">        <span class="built_in">adde</span>(t1,t2); <span class="built_in">adde</span>(t2,t1);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dfs1</span>(<span class="number">1</span>); <span class="built_in">dfs2</span>(<span class="number">1</span>,<span class="number">1</span>); <span class="built_in">build</span>(<span class="number">1</span>,n,<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;++i)&#123;</span><br><span class="line">        <span class="type">int</span> t1,t2;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;t1,&amp;t2);</span><br><span class="line">        <span class="built_in">Modi</span>(t1,t2);</span><br><span class="line">        Matrix tmp=<span class="built_in">que</span>(<span class="number">1</span>,ed[<span class="number">1</span>],<span class="number">1</span>,n,<span class="number">1</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,<span class="built_in">max</span>(tmp.b[<span class="number">0</span>][<span class="number">0</span>],tmp.b[<span class="number">1</span>][<span class="number">0</span>]));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="树上背包">树上背包</h1>
<p>四种优化只看懂了一种dfs序的… 挖个坑</p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/316010761">全网最详细的树上背包及其优化</a></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> dd double</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ld long double</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 306</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> mod=<span class="number">998244353</span>;</span><br><span class="line"><span class="type">int</span> n,m,s[N];</span><br><span class="line"><span class="type">int</span> head[N],cnt,v[N&lt;&lt;<span class="number">1</span>],nxt[N&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> t1,<span class="type">int</span> t2)</span></span>&#123;</span><br><span class="line">    ++cnt;</span><br><span class="line">    nxt[cnt]=head[t1];</span><br><span class="line">    head[t1]=cnt;</span><br><span class="line">    v[cnt]=t2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> ind[N],tim,vv[N],f[N][N],sz[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs1</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    sz[x]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=head[x];i;i=nxt[i])&#123;</span><br><span class="line">        <span class="built_in">dfs1</span>(v[i]);</span><br><span class="line">        sz[x]+=sz[v[i]];</span><br><span class="line">    &#125;</span><br><span class="line">    ind[x]=++tim; vv[tim]=x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">cmx</span><span class="params">(<span class="type">int</span> &amp;x,<span class="type">int</span> val)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;val) x=val;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;1.txt&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;2.txt&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m); ++m;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=n+<span class="number">1</span>;++i)&#123;</span><br><span class="line">        <span class="type">int</span> t1,t2;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;t1,&amp;t2); ++t1;</span><br><span class="line">        <span class="built_in">add</span>(t1,i); s[i]=t2;</span><br><span class="line">    &#125;</span><br><span class="line">    ++n;</span><br><span class="line">    <span class="built_in">dfs1</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=m;++j)&#123;</span><br><span class="line">            f[i][j]=f[i<span class="number">-1</span>][j<span class="number">-1</span>]+s[vv[i]];</span><br><span class="line">            <span class="keyword">if</span>(i&gt;=sz[vv[i]]) <span class="built_in">cmx</span>(f[i][j],f[i-sz[vv[i]]][j]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">0</span>; <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;=m;++j) ans=<span class="built_in">max</span>(ans,f[n][j]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="网络流">网络流</h1>
<h2 id="dinic">Dinic</h2>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> cnt,head[M],cur[M],v[M&lt;&lt;<span class="number">1</span>],nxt[M&lt;&lt;<span class="number">1</span>],fl[M&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">adde</span><span class="params">(<span class="type">int</span> t1,<span class="type">int</span> t2,<span class="type">int</span> t3)</span></span>&#123;</span><br><span class="line">    nxt[cnt]=head[t1];</span><br><span class="line">    head[t1]=cnt;</span><br><span class="line">    v[cnt]=t2;</span><br><span class="line">    fl[cnt]=t3;</span><br><span class="line">    ++cnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">addbi</span><span class="params">(<span class="type">int</span> t1,<span class="type">int</span> t2,<span class="type">int</span> t3)</span></span>&#123;</span><br><span class="line">    <span class="comment">// printf(&quot;add %d %d %d\n&quot;,t1,t2,t3);</span></span><br><span class="line">    <span class="built_in">adde</span>(t1,t2,t3);</span><br><span class="line">    <span class="built_in">adde</span>(t2,t1,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> d[M];</span><br><span class="line"><span class="type">bool</span> inq[M];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">bfs</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=S;i&lt;=T;++i) cur[i]=head[i],d[i]=<span class="number">1e9</span>,inq[i]=<span class="number">0</span>;</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line">    d[S]=<span class="number">0</span>;</span><br><span class="line">    q.<span class="built_in">push</span>(S); inq[S]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(!q.<span class="built_in">empty</span>())&#123;</span><br><span class="line">        <span class="type">int</span> now=q.<span class="built_in">front</span>(); q.<span class="built_in">pop</span>(); inq[now]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(now==T) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=head[now];i!=<span class="number">-1</span>;i=nxt[i])&#123;</span><br><span class="line">            <span class="keyword">if</span>(fl[i]&gt;<span class="number">0</span>&amp;&amp;d[v[i]]&gt;d[now]+<span class="number">1</span>)&#123;</span><br><span class="line">                d[v[i]]=d[now]+<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span>(!inq[v[i]])&#123;</span><br><span class="line">                    inq[v[i]]=<span class="number">1</span>;</span><br><span class="line">                    q.<span class="built_in">push</span>(v[i]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> lef)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(lef&lt;=<span class="number">0</span>||x==T) <span class="keyword">return</span> lef;</span><br><span class="line">    <span class="type">int</span> flow=<span class="number">0</span>,tmp;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=cur[x];i!=<span class="number">-1</span>;i=nxt[i])&#123;</span><br><span class="line">        cur[x]=i;</span><br><span class="line">        <span class="keyword">if</span>(d[v[i]]==d[x]+<span class="number">1</span>&amp;&amp;(tmp=<span class="built_in">dfs</span>(v[i],<span class="built_in">min</span>(lef,fl[i]))))&#123;</span><br><span class="line">            flow+=tmp;</span><br><span class="line">            lef-=tmp;</span><br><span class="line">            fl[i]-=tmp;</span><br><span class="line">            fl[i^<span class="number">1</span>]+=tmp;</span><br><span class="line">            <span class="keyword">if</span>(lef&lt;=<span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> flow;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Dinic</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">bfs</span>())&#123;</span><br><span class="line">        res+=<span class="built_in">dfs</span>(S,<span class="number">1e9</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="费用流">费用流</h2>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="km二分图匹配">KM二分图匹配</h1>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> cntx, cnty, M;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">KM</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> mp[maxN][maxN], link_x[maxN], link_y[maxN], N;</span><br><span class="line">    <span class="type">bool</span> visx[maxN], visy[maxN];</span><br><span class="line">    <span class="type">int</span> que[maxN &lt;&lt; <span class="number">1</span>], top, fail, pre[maxN];</span><br><span class="line">    ll hx[maxN], hy[maxN], slk[maxN];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">check</span><span class="params">(<span class="type">int</span> i)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        visx[i] =<span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span>(link_x[i])</span><br><span class="line">        &#123;</span><br><span class="line">            que[fail++] = link_x[i];</span><br><span class="line">            <span class="keyword">return</span> visy[link_x[i]] = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(i)</span><br><span class="line">        &#123;</span><br><span class="line">            link_x[i] = pre[i];</span><br><span class="line">            <span class="built_in">swap</span>(i, link_y[pre[i]]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">bfs</span><span class="params">(<span class="type">int</span> S)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>; i&lt;=N; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            slk[i] = INF;</span><br><span class="line">            visx[i] = visy[i] = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        top = <span class="number">0</span>; fail = <span class="number">1</span>;</span><br><span class="line">        que[<span class="number">0</span>] = S;</span><br><span class="line">        visy[S] = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            ll d;</span><br><span class="line">            <span class="keyword">while</span>(top &lt; fail)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>, j = que[top++]; i &lt;= N; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span>(!visx[i] &amp;&amp; slk[i] &gt;= (d = hx[i] + hy[j] - mp[i][j]))</span><br><span class="line">                    &#123;</span><br><span class="line">                        pre[i] = j;</span><br><span class="line">                        <span class="keyword">if</span>(d) slk[i] = d;</span><br><span class="line">                        <span class="keyword">else</span> <span class="keyword">if</span>(!<span class="built_in">check</span>(i)) <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            d = INF;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>; i&lt;=N; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(!visx[i] &amp;&amp; d &gt; slk[i]) d = slk[i];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>; i&lt;=N; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(visx[i]) hx[i] += d;</span><br><span class="line">                <span class="keyword">else</span> slk[i] -= d;</span><br><span class="line">                <span class="keyword">if</span>(visy[i]) hy[i] -= d;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>; i&lt;=N; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(!visx[i] &amp;&amp; !slk[i] &amp;&amp; !<span class="built_in">check</span>(i)) <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>; i&lt;=N; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            link_x[i] = link_y[i] = <span class="number">0</span>;</span><br><span class="line">            visy[i] = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>; i&lt;=N; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            hx[i] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>; j&lt;=N; j++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(hx[i] &lt; mp[i][j]) hx[i] = mp[i][j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;km;</span><br><span class="line"><span class="type">int</span> n,a[<span class="number">555</span>][<span class="number">555</span>];</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>,&amp;n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=n;j++)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>,&amp;a[i][j]);</span><br><span class="line">    cntx=cnty=(n+<span class="number">1</span>)/<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i*<span class="number">2</span><span class="number">-1</span>&lt;=n;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j*<span class="number">2</span><span class="number">-1</span>&lt;=n;j++)&#123;</span><br><span class="line">            km.mp[i][j]=inf-(a[i*<span class="number">2</span><span class="number">-1</span>][j*<span class="number">2</span><span class="number">-2</span>]+a[i*<span class="number">2</span><span class="number">-1</span>][j*<span class="number">2</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    km.N = <span class="built_in">max</span>(cntx, cnty) + <span class="number">1</span>;</span><br><span class="line">    ll ans = <span class="number">0</span>;</span><br><span class="line">    km.<span class="built_in">init</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>; i&lt;=km.N; i++) km.<span class="built_in">bfs</span>(i);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>; i&lt;=cntx; i++) ans += km.mp[i][km.link_x[i]];</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, -(ans-cntx*inf));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="optimize_dp">optimize_DP</h1>
<h2 id="四边形优化dp">四边形优化DP</h2>
<p>The formula <span class="math display">\[
m_{i,j-1}\leq m_{i,j}\leq m_{i+1,j}
\]</span> will be satisfied if and only if the formula <span class="math display">\[
dp_{a,c}+dp_{b,d}\leq dp_{a,d}+dp_{b,c}
\]</span> is satisfied, where <span class="math inline">\(a&lt;b&lt;c&lt;d\)</span> and <span class="math inline">\(m_{i,j}\)</span> denotes the index when the <span class="math inline">\(dp_{i,j}\)</span> is the best. ### merging the
rocks <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i) dp[i][i]=<span class="number">0</span>,m[i][i]=i;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> len=<span class="number">2</span>;len&lt;=n;++len)&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> l=<span class="number">1</span>,r=len;r&lt;=n;++l,++r)&#123;</span><br><span class="line">        dp[l][r]=<span class="number">1e9</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> k=m[l][r<span class="number">-1</span>],tr=m[l+<span class="number">1</span>][r];k&lt;=tr;++k)&#123;</span><br><span class="line">            <span class="keyword">if</span>(dp[l][k]+dp[k+<span class="number">1</span>][r]+a[r]-a[l<span class="number">-1</span>]&lt;dp[l][r])&#123;</span><br><span class="line">                dp[l][r]=dp[l][k]+dp[k+<span class="number">1</span>][r]+a[r]-a[l<span class="number">-1</span>];</span><br><span class="line">                m[l][r]=k;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="斜率优化dp">斜率优化DP</h2>
<h3 id="玩具装箱"><a target="_blank" rel="noopener" href="https://loj.ac/p/10188">玩具装箱</a></h3>
<p>Assume that <span class="math inline">\(j&gt;k\)</span> and <span class="math inline">\(j\)</span> is better than <span class="math inline">\(k\)</span> to choose, <span class="math display">\[
f_j+(s_i-s_j+i-j-1-L)^2&lt;f_k+(s_i-s_k+i-k-1-L)^2
\]</span> <span class="math display">\[
f_j+((s_i+i)-(s_j+j+1+L))^2&lt;f_k+((s_i+i)-(s_k+k+1+L))^2
\]</span> <span class="math display">\[
\frac{f_j+(s_j+j+1+L)^2-f_k-(s_k+k+1+L)^2}{2*(s_j+j-s_k-k)}&lt;s_i+i
\]</span> <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">ll n,L;</span><br><span class="line">ll f[N],c[N];</span><br><span class="line">ll sta[N],he,en;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">calc</span><span class="params">(ll k,ll j)</span></span>&#123;</span><br><span class="line">    <span class="type">double</span> t1=f[j]+(c[j]+L)*(c[j]+L)-f[k]-(c[k]+L)*(c[k]+L);</span><br><span class="line">    <span class="type">double</span> t2=<span class="number">2.0</span>*(c[j]-c[k]);</span><br><span class="line">    <span class="keyword">return</span> t1/t2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld&quot;</span>,&amp;n,&amp;L); ++L;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i) <span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>,c+i),c[i]+=c[i<span class="number">-1</span>]+<span class="number">1</span>;</span><br><span class="line">    he=<span class="number">1</span>; en=<span class="number">0</span>; sta[++en]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123;</span><br><span class="line">        <span class="keyword">while</span>(en&gt;he&amp;&amp;<span class="built_in">calc</span>(sta[he],sta[he+<span class="number">1</span>])&lt;=c[i]) ++he;</span><br><span class="line">        f[i]=f[sta[he]]+(c[i]-c[sta[he]]-L)*(c[i]-c[sta[he]]-L);</span><br><span class="line">        <span class="keyword">while</span>(en&gt;he&amp;&amp;<span class="built_in">calc</span>(sta[en],i)&lt;<span class="built_in">calc</span>(sta[en<span class="number">-1</span>],sta[en])) --en;</span><br><span class="line">        sta[++en]=i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,f[n]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="sat">2sat</h1>
<h2 id="words-on-tree"><a target="_blank" rel="noopener" href="https://codeforces.com/contest/1657/problem/F">Words on
Tree</a></h2>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> y:g[x])</span><br><span class="line">		<span class="keyword">if</span>(y!=fa[x]) dep[y]=dep[x]+<span class="number">1</span>,fa[y]=x,<span class="built_in">dfs</span>(y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">tarjan</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">	dfn[x]=low[x]=++num,st[++top]=x;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> y:v[x])&#123;</span><br><span class="line">		<span class="keyword">if</span>(!dfn[y]) <span class="built_in">tarjan</span>(y),low[x]=<span class="built_in">min</span>(low[x],low[y]);</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(!c[y]) low[x]=<span class="built_in">min</span>(low[x],dfn[y]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(low[x]==dfn[x])&#123;</span><br><span class="line">		tot++;</span><br><span class="line">		<span class="keyword">do</span>&#123;c[tmp=st[top--]]=tot;&#125;<span class="keyword">while</span>(tmp!=x);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;i++)</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;x,&amp;y),g[x].<span class="built_in">push_back</span>(y),g[y].<span class="built_in">push_back</span>(x); </span><br><span class="line">	<span class="built_in">dfs</span>(<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++)&#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%s&quot;</span>,&amp;x,&amp;y,s+<span class="number">1</span>),len=<span class="built_in">strlen</span>(s+<span class="number">1</span>);</span><br><span class="line">		<span class="type">int</span> l=<span class="number">1</span>,r=len,q=<span class="number">2</span>*n+i,nq=q+m;</span><br><span class="line">		<span class="keyword">while</span>(l&lt;=r)&#123;</span><br><span class="line">			<span class="keyword">if</span>(dep[x]&gt;dep[y]) p[l++]=x,x=fa[x];</span><br><span class="line">			<span class="keyword">else</span> p[r--]=y,y=fa[y];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=len;j++)&#123;</span><br><span class="line">			<span class="type">int</span> x=p[j];</span><br><span class="line">			<span class="keyword">if</span>(!vis[x]) vis[x]=<span class="number">1</span>,a[x]=s[j],b[x]=s[len-j+<span class="number">1</span>];</span><br><span class="line">			<span class="keyword">if</span>(a[x]!=s[j]) v[x].<span class="built_in">push_back</span>(nq),v[q].<span class="built_in">push_back</span>(x+n);</span><br><span class="line">			<span class="keyword">if</span>(b[x]!=s[j]) v[x+n].<span class="built_in">push_back</span>(nq),v[q].<span class="built_in">push_back</span>(x);</span><br><span class="line">			<span class="keyword">if</span>(a[x]!=s[len-j+<span class="number">1</span>]) v[x].<span class="built_in">push_back</span>(q),v[nq].<span class="built_in">push_back</span>(x+n);</span><br><span class="line">			<span class="keyword">if</span>(b[x]!=s[len-j+<span class="number">1</span>]) v[x+n].<span class="built_in">push_back</span>(q),v[nq].<span class="built_in">push_back</span>(x);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">2</span>*(n+m);i++) <span class="keyword">if</span>(!dfn[i]) <span class="built_in">tarjan</span>(i);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) <span class="keyword">if</span>(c[i]==c[i+n]) <span class="built_in">puts</span>(<span class="string">&quot;NO&quot;</span>),<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) <span class="keyword">if</span>(c[<span class="number">2</span>*n+i]==c[<span class="number">2</span>*n+i+m]) <span class="built_in">puts</span>(<span class="string">&quot;NO&quot;</span>),<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">	<span class="built_in">puts</span>(<span class="string">&quot;YES&quot;</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">		<span class="keyword">if</span>(!vis[i]) <span class="built_in">putchar</span>(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">		<span class="keyword">else</span> <span class="built_in">putchar</span>(c[i]&lt;c[i+n]?a[i]:b[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="cdqfft">CDQFFT</h1>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> N 100006</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> mod=<span class="number">998244353</span>;</span><br><span class="line"><span class="comment">// NTT</span></span><br><span class="line"><span class="type">int</span> r[N&lt;&lt;<span class="number">2</span>],lo[N&lt;&lt;<span class="number">2</span>];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">z</span>&#123;</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    <span class="built_in">z</span>(<span class="type">int</span> x=<span class="number">0</span>):<span class="built_in">x</span>(x)&#123;&#125;</span><br><span class="line">    <span class="keyword">friend</span> z <span class="keyword">operator</span> +(z a,z b)&#123;<span class="keyword">return</span> (a.x+=b.x)&gt;=mod?a.x-mod:a.x;&#125;</span><br><span class="line">    <span class="keyword">friend</span> z <span class="keyword">operator</span> -(z a,z b)&#123;<span class="keyword">return</span> (a.x-=b.x)&lt;<span class="number">0</span>?a.x+mod:a.x;&#125;</span><br><span class="line">    <span class="keyword">friend</span> z <span class="keyword">operator</span> *(z a,z b)&#123;<span class="keyword">return</span> <span class="number">1ll</span>*a.x*b.x%mod;&#125;</span><br><span class="line">&#125;w[N&lt;&lt;<span class="number">2</span>],inv[N&lt;&lt;<span class="number">2</span>];</span><br><span class="line"><span class="function">z <span class="title">power</span><span class="params">(z x,<span class="type">int</span> y)</span></span>&#123;z t=<span class="number">1</span>;<span class="keyword">for</span>(;y;y&gt;&gt;=<span class="number">1</span>,x=x*x)<span class="keyword">if</span>(y&amp;<span class="number">1</span>)t=t*x;<span class="keyword">return</span> t;&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Glim</span><span class="params">(<span class="type">int</span> n)</span></span>&#123;<span class="type">int</span> t=<span class="number">1</span>;<span class="keyword">while</span>(t&lt;n)t&lt;&lt;=<span class="number">1</span>;<span class="keyword">return</span> t;&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span> n)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> lim=<span class="built_in">Glim</span>(n);inv[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=lim;i++)inv[i]=mod-mod/i*inv[mod%i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>,j=<span class="number">0</span>;i&lt;=lim;i&lt;&lt;=<span class="number">1</span>,j++)lo[i]=j;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;lim;i&lt;&lt;=<span class="number">1</span>)&#123;</span><br><span class="line">        z Wn=<span class="built_in">power</span>(<span class="number">3</span>,(mod<span class="number">-1</span>)/(i&lt;&lt;<span class="number">1</span>)),W=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;i;j++,W=W*Wn)w[i+j]=W;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dft</span><span class="params">(vector&lt;z&gt; &amp;a,<span class="type">int</span> lim)</span></span>&#123;</span><br><span class="line">    a.<span class="built_in">resize</span>(lim);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;lim;i++)r[i]=r[i&gt;&gt;<span class="number">1</span>]&gt;&gt;<span class="number">1</span>^(i&amp;<span class="number">1</span>)&lt;&lt;lo[lim];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;lim;i++)<span class="keyword">if</span>(i&gt;r[i])<span class="built_in">swap</span>(a[i],a[r[i]]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;lim;i&lt;&lt;=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;lim;j+=i&lt;&lt;<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;i;k++)&#123;</span><br><span class="line">                z x=a[j+k],y=a[i+j+k]*w[i+k];</span><br><span class="line">                a[j+k]=x+y;a[i+j+k]=x-y;</span><br><span class="line">            &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">idft</span><span class="params">(vector&lt;z&gt; &amp;a,<span class="type">int</span> lim)</span></span>&#123;</span><br><span class="line">    <span class="built_in">dft</span>(a,lim);<span class="built_in">reverse</span>(&amp;a[<span class="number">1</span>],&amp;a[lim]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;lim;i++)a[i]=a[i]*inv[lim];</span><br><span class="line">&#125;</span><br><span class="line">vector&lt;z&gt; <span class="keyword">operator</span> *(vector&lt;z&gt; a,vector&lt;z&gt; b)&#123;</span><br><span class="line">    <span class="type">int</span> n=a.<span class="built_in">size</span>()+b.<span class="built_in">size</span>()<span class="number">-1</span>,lim=<span class="built_in">Glim</span>(n);</span><br><span class="line">    <span class="built_in">dft</span>(a,lim);<span class="built_in">dft</span>(b,lim);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;lim;i++)a[i]=a[i]*b[i];</span><br><span class="line">    <span class="built_in">idft</span>(a,lim);a.<span class="built_in">resize</span>(n); <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ADD</span><span class="params">(<span class="type">int</span> &amp;x,<span class="type">int</span> c)</span></span>&#123;</span><br><span class="line">    x+=c;</span><br><span class="line">    <span class="keyword">if</span>(x&gt;=mod) x-=mod;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;<span class="number">0</span>) x+=mod;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CDQFFT</span><span class="params">(<span class="type">int</span> *f,<span class="type">int</span> *g,<span class="type">int</span> l,<span class="type">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(l&gt;=r) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="built_in">CDQFFT</span>(f,g,l,mid);</span><br><span class="line">    vector&lt;z&gt; v1,v2;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=l;i&lt;=mid;++i) v1.<span class="built_in">push_back</span>(<span class="built_in">z</span>(f[i]));</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=r-l;++i) v2.<span class="built_in">push_back</span>(<span class="built_in">z</span>(g[i]));</span><br><span class="line">    v1=v1*v2;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=mid+<span class="number">1</span>;i&lt;=r;++i) <span class="built_in">ADD</span>(f[i],v1[i-l<span class="number">-1</span>].x);</span><br><span class="line">    <span class="built_in">CDQFFT</span>(f,g,mid+<span class="number">1</span>,r);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> n,f[N],g[N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">    <span class="built_in">init</span>(n&lt;&lt;<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;++i) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,g+i);</span><br><span class="line">    f[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">CDQFFT</span>(f,g,<span class="number">0</span>,n<span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;++i) <span class="built_in">printf</span>(<span class="string">&quot;%d%c&quot;</span>,f[i],<span class="string">&quot; \n&quot;</span>[i==n<span class="number">-1</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="mtt">MTT</h1>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> rint register int</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">Pow</span><span class="params">(ll a,ll b,ll p)</span></span>&#123;</span><br><span class="line">    ll Res=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(a%=p;b;b&gt;&gt;=<span class="number">1</span>,a=a*a%p)</span><br><span class="line">        <span class="keyword">if</span>(b&amp;<span class="number">1</span>)Res=Res*a%p;</span><br><span class="line">    <span class="keyword">return</span> Res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> r[<span class="number">1</span>&lt;&lt;<span class="number">18</span>];</span><br><span class="line"><span class="keyword">namespace</span> Poly&#123;</span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> Add(a,b) (((a)+(b))&gt;=p?(a)+(b)-p:(a)+(b))</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">NTT</span><span class="params">(<span class="type">int</span> n,<span class="type">int</span> *A,<span class="type">int</span> p,<span class="type">int</span> g)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(rint i=<span class="number">0</span>;i&lt;n;++i)<span class="keyword">if</span>(i&lt;r[i])std::<span class="built_in">swap</span>(A[i],A[r[i]]);</span><br><span class="line">        <span class="keyword">for</span>(rint i=<span class="number">2</span>,h=<span class="number">1</span>;i&lt;=n;i&lt;&lt;=<span class="number">1</span>,h&lt;&lt;=<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">for</span>(rint j=<span class="number">0</span>,Rs=<span class="built_in">Pow</span>(g,(p<span class="number">-1</span>)/i,p);j&lt;n;j+=i)</span><br><span class="line">                <span class="keyword">for</span>(rint k=<span class="number">0</span>,Rt=<span class="number">1</span>;k&lt;h;++k,Rt=(ll)Rt*Rs%p)&#123;</span><br><span class="line">                    <span class="type">int</span> Tmp=(ll)A[j+h+k]*Rt%p;</span><br><span class="line">                    A[j+h+k]=<span class="built_in">Add</span>(A[j+k],p-Tmp),A[j+k]=<span class="built_in">Add</span>(A[j+k],Tmp);</span><br><span class="line">                &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> A[<span class="number">1</span>&lt;&lt;<span class="number">18</span>],B[<span class="number">1</span>&lt;&lt;<span class="number">18</span>];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Multiply</span><span class="params">(<span class="type">int</span> n,<span class="type">int</span> *F,<span class="type">int</span> *G,<span class="type">int</span> p,<span class="type">int</span> *S)</span></span>&#123;</span><br><span class="line">        <span class="built_in">memcpy</span>(A,F,n*<span class="built_in">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">        <span class="built_in">memcpy</span>(B,G,n*<span class="built_in">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">        <span class="built_in">NTT</span>(n,A,p,<span class="number">3</span>),<span class="built_in">NTT</span>(n,B,p,<span class="number">3</span>);</span><br><span class="line">        <span class="keyword">for</span>(rint i=<span class="number">0</span>;i&lt;n;++i)A[i]=(ll)A[i]*B[i]%p;</span><br><span class="line">        <span class="built_in">NTT</span>(n,A,p,<span class="built_in">Pow</span>(<span class="number">3</span>,p<span class="number">-2</span>,p));</span><br><span class="line">        <span class="type">int</span> In=<span class="built_in">Pow</span>(n,p<span class="number">-2</span>,p);</span><br><span class="line">        <span class="keyword">for</span>(rint i=<span class="number">0</span>;i&lt;n;++i)S[i]=(ll)A[i]*In%p;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> n,m,p,F[<span class="number">1</span>&lt;&lt;<span class="number">18</span>],G[<span class="number">1</span>&lt;&lt;<span class="number">18</span>],S[<span class="number">3</span>][<span class="number">1</span>&lt;&lt;<span class="number">18</span>];</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> P[]=&#123;<span class="number">469762049</span>,<span class="number">998244353</span>,<span class="number">1004535809</span>&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;n,&amp;m,&amp;p);</span><br><span class="line">    <span class="keyword">for</span>(rint i=<span class="number">0</span>;i&lt;=n;++i)<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,F+i);</span><br><span class="line">    <span class="keyword">for</span>(rint i=<span class="number">0</span>;i&lt;=m;++i)<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,G+i);</span><br><span class="line">    <span class="keyword">for</span>(m=n+m,n=<span class="number">1</span>;n&lt;=m;n&lt;&lt;=<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(rint i=<span class="number">0</span>,l=(<span class="type">int</span>)<span class="built_in">log2</span>(n);i&lt;n;++i)r[i]=(r[i&gt;&gt;<span class="number">1</span>]&gt;&gt;<span class="number">1</span>)|((i&amp;<span class="number">1</span>)&lt;&lt;(l<span class="number">-1</span>));</span><br><span class="line">    <span class="keyword">for</span>(rint i=<span class="number">0</span>;i&lt;<span class="number">3</span>;++i)Poly::<span class="built_in">Multiply</span>(n,F,G,P[i],S[i]);</span><br><span class="line">    <span class="keyword">for</span>(rint i=<span class="number">0</span>;i&lt;=m;++i)&#123;</span><br><span class="line">        ll x=S[<span class="number">0</span>][i]+((S[<span class="number">1</span>][i]-S[<span class="number">0</span>][i]+P[<span class="number">1</span>])*<span class="built_in">Pow</span>(P[<span class="number">0</span>],P[<span class="number">1</span>]<span class="number">-2</span>,P[<span class="number">1</span>])%P[<span class="number">1</span>])*P[<span class="number">0</span>];</span><br><span class="line">        ll xs=(x%p+(S[<span class="number">2</span>][i]-x%P[<span class="number">2</span>]+P[<span class="number">2</span>])*<span class="built_in">Pow</span>((ll)P[<span class="number">0</span>]*P[<span class="number">1</span>],P[<span class="number">2</span>]<span class="number">-2</span>,P[<span class="number">2</span>])%P[<span class="number">2</span>]*P[<span class="number">0</span>]%p*P[<span class="number">1</span>]%p)%p;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld%c&quot;</span>,xs,<span class="string">&quot; \n&quot;</span>[i==m]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="fwt">FWT</h1>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> Mod=<span class="number">998244353</span>,Inv2=(Mod+<span class="number">1</span>)&gt;&gt;<span class="number">1</span>;<span class="comment">//Inv2 2在mod998244353下的逆元</span></span><br><span class="line"><span class="type">int</span> n,a[<span class="number">1</span>&lt;&lt;<span class="number">17</span>],b[<span class="number">1</span>&lt;&lt;<span class="number">17</span>],as[<span class="number">1</span>&lt;&lt;<span class="number">17</span>],bs[<span class="number">1</span>&lt;&lt;<span class="number">17</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">FWT</span><span class="params">(<span class="type">int</span> *A,<span class="type">int</span> op,<span class="type">int</span> t)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=n;i&lt;&lt;=<span class="number">1</span>)<span class="comment">//i 区间长度</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>,m=i&gt;&gt;<span class="number">1</span>;j&lt;n;j+=i)<span class="comment">//j 区间左端 m 区间大小一半</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;m;++k)<span class="comment">//k 正在算第几个数</span></span><br><span class="line">                <span class="keyword">if</span>(t==<span class="number">1</span>)A[j+m+k]=((ll)A[j+m+k]+A[j+k]*op+Mod)%Mod;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(t==<span class="number">2</span>)A[j+k]=((ll)A[j+k]+A[j+m+k]*op+Mod)%Mod;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="type">int</span> A0=A[j+k],A1=A[j+m+k];</span><br><span class="line">                    A[j+k]=(ll)(A0+A1)*(op==<span class="number">1</span>?<span class="number">1</span>:Inv2)%Mod;</span><br><span class="line">                    A[j+m+k]=(ll)(A0-A1+Mod)*(op==<span class="number">1</span>?<span class="number">1</span>:Inv2)%Mod;</span><br><span class="line">                &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n),n=<span class="number">1</span>&lt;&lt;n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;++i)<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;as[i]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;++i)<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;bs[i]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> t=<span class="number">1</span>;t&lt;=<span class="number">3</span>;++t)<span class="comment">//分别计算or/and/xor</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">memcpy</span>(a,as,<span class="built_in">sizeof</span>(<span class="type">int</span>)*n);</span><br><span class="line">        <span class="built_in">memcpy</span>(b,bs,<span class="built_in">sizeof</span>(<span class="type">int</span>)*n);</span><br><span class="line">        <span class="built_in">FWT</span>(a,<span class="number">1</span>,t),<span class="built_in">FWT</span>(b,<span class="number">1</span>,t);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;++i)a[i]=a[i]*<span class="number">1LL</span>*b[i]%Mod;</span><br><span class="line">        <span class="built_in">FWT</span>(a,<span class="number">-1</span>,t);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;++i)<span class="built_in">printf</span>(<span class="string">&quot;%d%c&quot;</span>,a[i],i==n<span class="number">-1</span>?<span class="string">&#x27;\n&#x27;</span>:<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="二维格雷码">二维格雷码</h1>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">pr</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> nu)</span></span>&#123; <span class="comment">// 打印二进制</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=nu<span class="number">-1</span>;i&gt;=<span class="number">0</span>;--i) <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>,(x&amp;(<span class="number">1</span>&lt;&lt;i))?<span class="string">&#x27;1&#x27;</span>:<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;++i)&#123;</span><br><span class="line">    <span class="type">int</span> len=<span class="number">1</span>&lt;&lt;i;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;len;++k)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=len;j&lt;(len&lt;&lt;<span class="number">1</span>);++j)</span><br><span class="line">            b[k][j]=b[k][(len&lt;&lt;<span class="number">1</span>)<span class="number">-1</span>-j]+(<span class="number">1</span>&lt;&lt;(i&lt;&lt;<span class="number">1</span>));</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=len;j&lt;(len&lt;&lt;<span class="number">1</span>);++j)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;(len&lt;&lt;<span class="number">1</span>);++k)</span><br><span class="line">            b[j][k]=b[(len&lt;&lt;<span class="number">1</span>)<span class="number">-1</span>-j][k]+(<span class="number">1</span>&lt;&lt;(i&lt;&lt;<span class="number">1</span>|<span class="number">1</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">32</span>;++i)&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;<span class="number">32</span>;++j)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,b[i][j]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">exit</span>(<span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<h1 id="五边形数">五边形数</h1>
<p><img src="/1970/01/01/banzi/Snipaste_2022-05-10_11-07-01.png"></p>
<h1 id="sosdp"><a target="_blank" rel="noopener" href="https://codeforces.com/blog/entry/45223">SOSDP</a></h1>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">17</span>;++i)</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;(<span class="number">1</span>&lt;&lt;<span class="number">17</span>);++j)</span><br><span class="line">        <span class="keyword">if</span>(j&amp;(<span class="number">1</span>&lt;&lt;i))</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;<span class="number">18</span>;++k)</span><br><span class="line">                (b[j][k]+=b[j^(<span class="number">1</span>&lt;&lt;i)][k])%=mod;</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/1970/01/01/scala/" rel="prev" title="scala">
      <i class="fa fa-chevron-left"></i> scala
    </a></div>
      <div class="post-nav-item">
    <a href="/1970/01/01/sbt/" rel="next" title="sbt">
      sbt <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%99%AE%E9%80%9A%E8%8E%AB%E9%98%9F"><span class="nav-number">1.</span> <span class="nav-text">普通莫队</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BE%85%E4%BF%AE%E6%94%B9%E8%8E%AB%E9%98%9F"><span class="nav-number">2.</span> <span class="nav-text">待修改莫队</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9B%9E%E6%BB%9A%E8%8E%AB%E9%98%9F"><span class="nav-number">3.</span> <span class="nav-text">回滚莫队</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%A0%91%E4%B8%8Adfs%E5%BA%8F%E8%8E%AB%E9%98%9F"><span class="nav-number">4.</span> <span class="nav-text">树上dfs序莫队</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#wc2013%E7%B3%96%E6%9E%9C%E5%85%AC%E5%9B%AD"><span class="nav-number">4.1.</span> <span class="nav-text">WC2013糖果公园</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%9C%9F-%E6%A0%91%E4%B8%8A%E8%8E%AB%E9%98%9F"><span class="nav-number">5.</span> <span class="nav-text">真 树上莫队</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#wc2013%E7%B3%96%E6%9E%9C%E5%85%AC%E5%9B%AD-1"><span class="nav-number">5.1.</span> <span class="nav-text">WC2013糖果公园</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%82%B9%E5%88%86%E6%B2%BB"><span class="nav-number">6.</span> <span class="nav-text">点分治</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#p4178-tree"><span class="nav-number">6.1.</span> <span class="nav-text">P4178 Tree</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E7%82%B9%E5%88%86%E6%B2%BB"><span class="nav-number">7.</span> <span class="nav-text">动态点分治</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#p2056-zjoi2007%E6%8D%89%E8%BF%B7%E8%97%8F"><span class="nav-number">7.1.</span> <span class="nav-text">[P2056 ZJOI2007]捉迷藏</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%AC%E5%BC%8F"><span class="nav-number">8.</span> <span class="nav-text">公式</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9E%81%E8%A7%92%E6%8E%92%E5%BA%8F"><span class="nav-number">9.</span> <span class="nav-text">极角排序</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#interger"><span class="nav-number">9.1.</span> <span class="nav-text">interger</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#neko-and-quadrilateral"><span class="nav-number">9.2.</span> <span class="nav-text">Neko and
quadrilateral</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#d"><span class="nav-number">10.</span> <span class="nav-text">3D</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A9%BA%E9%97%B4%E7%82%B9%E7%BB%95%E7%BA%BF%E6%97%8B%E8%BD%AC%E5%85%AC%E5%BC%8F"><span class="nav-number">10.1.</span> <span class="nav-text">空间点绕线旋转公式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9C%86%E4%B9%8B%E9%97%B4%E7%9B%B8%E4%BA%A4"><span class="nav-number">11.</span> <span class="nav-text">圆之间相交</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#square-card"><span class="nav-number">11.1.</span> <span class="nav-text">Square
Card</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%87%B8%E5%8C%85"><span class="nav-number">12.</span> <span class="nav-text">凸包</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#smzzl-with-safe-zone"><span class="nav-number">12.1.</span> <span class="nav-text">Smzzl with Safe
Zone</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#beauty-contest-poj---2187"><span class="nav-number">12.2.</span> <span class="nav-text">Beauty Contest POJ -
2187</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%80%E4%BA%9B%E9%A2%98"><span class="nav-number">13.</span> <span class="nav-text">一些题</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#c---empty-convex-polygons"><span class="nav-number">13.1.</span> <span class="nav-text">C - Empty Convex
Polygons</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8D%8A%E5%B9%B3%E9%9D%A2%E4%BA%A4"><span class="nav-number">14.</span> <span class="nav-text">半平面交</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#uyuws-concert"><span class="nav-number">14.1.</span> <span class="nav-text">Uyuw’s
Concert</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#p4196-cqoi2006%E5%87%B8%E5%A4%9A%E8%BE%B9%E5%BD%A2-%E6%A8%A1%E6%9D%BF%E5%8D%8A%E5%B9%B3%E9%9D%A2%E4%BA%A4"><span class="nav-number">14.2.</span> <span class="nav-text">P4196 [CQOI2006]凸多边形
&#x2F;【模板】半平面交</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%89%E7%BB%B4%E5%87%B8%E5%8C%85"><span class="nav-number">15.</span> <span class="nav-text">三维凸包</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#p4724-%E6%A8%A1%E6%9D%BF%E4%B8%89%E7%BB%B4%E5%87%B8%E5%8C%85"><span class="nav-number">15.1.</span> <span class="nav-text">P4724
【模板】三维凸包</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#kd-tree"><span class="nav-number">16.</span> <span class="nav-text">KD-TREE</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#in-case-of-failure"><span class="nav-number">16.1.</span> <span class="nav-text">In case of
failure</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%BB%E5%B8%AD%E6%A0%91"><span class="nav-number">17.</span> <span class="nav-text">主席树</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#p3834-%E6%A8%A1%E6%9D%BF%E5%8F%AF%E6%8C%81%E4%B9%85%E5%8C%96%E7%BA%BF%E6%AE%B5%E6%A0%91-2%E4%B8%BB%E5%B8%AD%E6%A0%91"><span class="nav-number">17.1.</span> <span class="nav-text">P3834
【模板】可持久化线段树 2（主席树）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#p3157-cqoi2011%E5%8A%A8%E6%80%81%E9%80%86%E5%BA%8F%E5%AF%B9"><span class="nav-number">17.2.</span> <span class="nav-text">[P3157 CQOI2011]动态逆序对</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#p2633-count-on-a-tree"><span class="nav-number">17.3.</span> <span class="nav-text">P2633 Count on a
tree</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B9%B3%E8%A1%A1%E6%A0%91"><span class="nav-number">18.</span> <span class="nav-text">平衡树</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#p3369-%E6%A8%A1%E6%9D%BF%E6%99%AE%E9%80%9A%E5%B9%B3%E8%A1%A1%E6%A0%91"><span class="nav-number">18.1.</span> <span class="nav-text">P3369
【模板】普通平衡树</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#treap"><span class="nav-number">18.1.1.</span> <span class="nav-text">Treap:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#splay"><span class="nav-number">18.1.2.</span> <span class="nav-text">splay:</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#p3391-%E6%A8%A1%E6%9D%BF%E6%96%87%E8%89%BA%E5%B9%B3%E8%A1%A1%E6%A0%91"><span class="nav-number">18.2.</span> <span class="nav-text">P3391
【模板】文艺平衡树</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#lca"><span class="nav-number">19.</span> <span class="nav-text">LCA</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#o1-lca"><span class="nav-number">19.1.</span> <span class="nav-text">O(1) LCA</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#lct"><span class="nav-number">20.</span> <span class="nav-text">LCT</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#p3690-%E6%A8%A1%E6%9D%BF%E5%8A%A8%E6%80%81%E6%A0%91link-cut-tree"><span class="nav-number">20.1.</span> <span class="nav-text">P3690 【模板】动态树（Link
Cut Tree）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#p3203-hnoi2010%E5%BC%B9%E9%A3%9E%E7%BB%B5%E7%BE%8A"><span class="nav-number">20.2.</span> <span class="nav-text">[P3203 HNOI2010]弹飞绵羊</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#p4299-%E9%A6%96%E9%83%BD"><span class="nav-number">20.3.</span> <span class="nav-text">P4299 首都</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sp2939-qtree5---query-on-a-tree-v"><span class="nav-number">20.4.</span> <span class="nav-text">SP2939 QTREE5 - Query on
a tree V</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%A0%91%E7%9A%84%E6%80%A7%E8%B4%A8"><span class="nav-number">21.</span> <span class="nav-text">树的性质</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%87%8D%E5%BF%83"><span class="nav-number">21.1.</span> <span class="nav-text">重心</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%89%A9%E5%B1%95%E5%9F%9F%E5%B9%B6%E6%9F%A5%E9%9B%86"><span class="nav-number">22.</span> <span class="nav-text">扩展域并查集</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#e.-prefix-enlightenment"><span class="nav-number">22.1.</span> <span class="nav-text">E. Prefix
Enlightenment</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#p1525-noip2010-%E6%8F%90%E9%AB%98%E7%BB%84-%E5%85%B3%E6%8A%BC%E7%BD%AA%E7%8A%AF"><span class="nav-number">22.2.</span> <span class="nav-text">[P1525 NOIP2010 提高组]
关押罪犯</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#p2024-noi2001-%E9%A3%9F%E7%89%A9%E9%93%BE"><span class="nav-number">22.3.</span> <span class="nav-text">[P2024 NOI2001] 食物链</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%BE%B9%E5%B8%A6%E6%9D%83%E5%B9%B6%E6%9F%A5%E9%9B%86"><span class="nav-number">23.</span> <span class="nav-text">边带权并查集</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#p1196-noi2002-%E9%93%B6%E6%B2%B3%E8%8B%B1%E9%9B%84%E4%BC%A0%E8%AF%B4"><span class="nav-number">23.1.</span> <span class="nav-text">[P1196 NOI2002]
银河英雄传说</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%99%9A%E6%A0%91"><span class="nav-number">24.</span> <span class="nav-text">虚树</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#sdoi2011%E6%B6%88%E8%80%97%E6%88%98"><span class="nav-number">24.1.</span> <span class="nav-text">SDOI2011]消耗战</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#g.-yet-another-lcp-problem"><span class="nav-number">24.2.</span> <span class="nav-text">G. Yet Another LCP
Problem</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#p4426-hnoiahoi2018%E6%AF%92%E7%98%A4"><span class="nav-number">24.3.</span> <span class="nav-text">P4426
[HNOI&#x2F;AHOI2018]毒瘤</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#segment-tree-beats"><span class="nav-number">25.</span> <span class="nav-text">segment tree beats</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#f.-stations"><span class="nav-number">25.1.</span> <span class="nav-text">F.
Stations</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#gorgeous-sequence"><span class="nav-number">25.2.</span> <span class="nav-text">Gorgeous
Sequence</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%90%88%E5%B9%B6%E7%BA%BF%E6%AE%B5%E6%A0%91"><span class="nav-number">26.</span> <span class="nav-text">合并线段树</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%88%E5%B9%B601trie%E5%BC%82%E6%88%96%E6%A0%91"><span class="nav-number">26.1.</span> <span class="nav-text">合并01trie:异或树</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8B%89%E6%A0%BC%E6%9C%97%E6%97%A5%E6%8F%92%E5%80%BC%E6%B3%95"><span class="nav-number">27.</span> <span class="nav-text">拉格朗日插值法</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#f---cumulative-sum-%E6%8B%89%E6%A0%BC%E6%9C%97%E6%97%A5%E6%8F%92%E5%80%BC%E6%B3%95"><span class="nav-number">27.1.</span> <span class="nav-text">F - Cumulative Sum
拉格朗日插值法</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%95%B0%E8%AE%BA%E5%88%86%E5%9D%97"><span class="nav-number">28.</span> <span class="nav-text">数论分块</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#p2261-cqoi2007%E4%BD%99%E6%95%B0%E6%B1%82%E5%92%8C"><span class="nav-number">28.1.</span> <span class="nav-text">[P2261 CQOI2007]余数求和</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%8E%AB%E6%AF%94%E4%B9%8C%E6%96%AF"><span class="nav-number">29.</span> <span class="nav-text">莫比乌斯</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8E%AB%E6%AF%94%E4%B9%8C%E6%96%AF%E5%87%BD%E6%95%B0"><span class="nav-number">29.1.</span> <span class="nav-text">莫比乌斯函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#p2522-haoi2011problem-b"><span class="nav-number">29.2.</span> <span class="nav-text">[P2522 HAOI2011]Problem
b</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#lcmsum---lcm-sum"><span class="nav-number">29.3.</span> <span class="nav-text">LCMSUM - LCM Sum</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#p1829-%E5%9B%BD%E5%AE%B6%E9%9B%86%E8%AE%AD%E9%98%9Fcrash%E7%9A%84%E6%95%B0%E5%AD%97%E8%A1%A8%E6%A0%BC-jzptab"><span class="nav-number">29.4.</span> <span class="nav-text">[P1829 国家集训队]Crash的数字表格
&#x2F; JZPTAB</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sdoi2015%E7%BA%A6%E6%95%B0%E4%B8%AA%E6%95%B0%E5%92%8C"><span class="nav-number">29.5.</span> <span class="nav-text">#2185.
「SDOI2015」约数个数和</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#p3768-%E7%AE%80%E5%8D%95%E7%9A%84%E6%95%B0%E5%AD%A6%E9%A2%98"><span class="nav-number">29.6.</span> <span class="nav-text">P3768
简单的数学题</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9D%9C%E6%95%99%E7%AD%9B"><span class="nav-number">30.</span> <span class="nav-text">杜教筛</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9D%9C%E6%95%99%E7%AD%9B%E5%85%AC%E5%BC%8F"><span class="nav-number">30.1.</span> <span class="nav-text">杜教筛公式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#p3768-%E7%AE%80%E5%8D%95%E7%9A%84%E6%95%B0%E5%AD%A6%E9%A2%98-1"><span class="nav-number">30.2.</span> <span class="nav-text">P3768
简单的数学题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#e---huntian-oy"><span class="nav-number">30.3.</span> <span class="nav-text">E - huntian
oy</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B9%B3%E5%9D%87%E6%9C%80%E5%B0%8F%E5%85%AC%E5%80%8D%E6%95%B0"><span class="nav-number">30.4.</span> <span class="nav-text">1227
平均最小公倍数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BA%A6%E6%95%B0%E4%B9%8B%E5%92%8C"><span class="nav-number">30.5.</span> <span class="nav-text">1220
约数之和</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#gcd-and-lcm"><span class="nav-number">30.6.</span> <span class="nav-text">Gcd
and Lcm</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#min25%E7%AD%9B"><span class="nav-number">31.</span> <span class="nav-text">min25筛</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#fft"><span class="nav-number">32.</span> <span class="nav-text">FFT</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ntt"><span class="nav-number">33.</span> <span class="nav-text">NTT</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#bsgs"><span class="nav-number">34.</span> <span class="nav-text">BSGS</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#pass"><span class="nav-number">34.1.</span> <span class="nav-text">Pass!</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#burnside-and-polya"><span class="nav-number">35.</span> <span class="nav-text">Burnside and Polya</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%B2%E8%A7%A3%E7%BD%91%E5%9D%80"><span class="nav-number">35.1.</span> <span class="nav-text">讲解网址</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#crt"><span class="nav-number">36.</span> <span class="nav-text">CRT</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#p2480-sdoi2010%E5%8F%A4%E4%BB%A3%E7%8C%AA%E6%96%87"><span class="nav-number">36.1.</span> <span class="nav-text">[P2480 SDOI2010]古代猪文</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%A4%9A%E9%A1%B9%E5%BC%8F%E6%B1%82%E9%80%86"><span class="nav-number">37.</span> <span class="nav-text">多项式求逆</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#b---basel-problem"><span class="nav-number">37.1.</span> <span class="nav-text">B - Basel
Problem</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%9F%A9%E9%98%B5%E6%B1%82%E9%80%86%E9%AB%98%E6%96%AF%E6%B6%88%E5%85%83"><span class="nav-number">38.</span> <span class="nav-text">矩阵求逆(高斯消元)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#p4783-%E6%A8%A1%E6%9D%BF%E7%9F%A9%E9%98%B5%E6%B1%82%E9%80%86"><span class="nav-number">38.1.</span> <span class="nav-text">P4783
【模板】矩阵求逆</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#random-walk-2"><span class="nav-number">38.2.</span> <span class="nav-text">Random Walk
2</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BA%BF%E6%80%A7%E5%9F%BA"><span class="nav-number">39.</span> <span class="nav-text">线性基</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#e---odd-subrectangles"><span class="nav-number">39.1.</span> <span class="nav-text">E
- Odd Subrectangles</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#tarjan"><span class="nav-number">40.</span> <span class="nav-text">tarjan</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%B2%E7%82%B9"><span class="nav-number">40.1.</span> <span class="nav-text">割点</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#sam"><span class="nav-number">41.</span> <span class="nav-text">SAM</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#p4070-sdoi2016%E7%94%9F%E6%88%90%E9%AD%94%E5%92%92"><span class="nav-number">41.1.</span> <span class="nav-text">[P4070 SDOI2016]生成魔咒</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#p4022-ctsc2012%E7%86%9F%E6%82%89%E7%9A%84%E6%96%87%E7%AB%A0"><span class="nav-number">41.2.</span> <span class="nav-text">[P4022 CTSC2012]熟悉的文章</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#display-substring"><span class="nav-number">41.3.</span> <span class="nav-text">Display
Substring</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ac%E8%87%AA%E5%8A%A8%E6%9C%BA"><span class="nav-number">42.</span> <span class="nav-text">AC自动机</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#searching-the-stringzoj-3228"><span class="nav-number">42.1.</span> <span class="nav-text">Searching the
String（ZOJ-3228）</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B9%BF%E4%B9%89sam"><span class="nav-number">43.</span> <span class="nav-text">广义SAM</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#p6139-%E6%A8%A1%E6%9D%BF%E5%B9%BF%E4%B9%89%E5%90%8E%E7%BC%80%E8%87%AA%E5%8A%A8%E6%9C%BA%E5%B9%BF%E4%B9%89-sam"><span class="nav-number">43.1.</span> <span class="nav-text">P6139
【模板】广义后缀自动机（广义 SAM）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#lcs2---longest-common-substring-ii"><span class="nav-number">43.2.</span> <span class="nav-text">LCS2 - Longest Common
Substring II</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%95%B0%E4%BD%8Ddp"><span class="nav-number">44.</span> <span class="nav-text">数位DP</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#p4127-ahoi2009%E5%90%8C%E7%B1%BB%E5%88%86%E5%B8%83"><span class="nav-number">44.1.</span> <span class="nav-text">[P4127 AHOI2009]同类分布</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8A%A8%E6%80%81dp"><span class="nav-number">45.</span> <span class="nav-text">动态dp</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%A0%91%E4%B8%8A%E8%83%8C%E5%8C%85"><span class="nav-number">46.</span> <span class="nav-text">树上背包</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E6%B5%81"><span class="nav-number">47.</span> <span class="nav-text">网络流</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#dinic"><span class="nav-number">47.1.</span> <span class="nav-text">Dinic</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B4%B9%E7%94%A8%E6%B5%81"><span class="nav-number">47.2.</span> <span class="nav-text">费用流</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#km%E4%BA%8C%E5%88%86%E5%9B%BE%E5%8C%B9%E9%85%8D"><span class="nav-number">48.</span> <span class="nav-text">KM二分图匹配</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#optimize_dp"><span class="nav-number">49.</span> <span class="nav-text">optimize_DP</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E8%BE%B9%E5%BD%A2%E4%BC%98%E5%8C%96dp"><span class="nav-number">49.1.</span> <span class="nav-text">四边形优化DP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%9C%E7%8E%87%E4%BC%98%E5%8C%96dp"><span class="nav-number">49.2.</span> <span class="nav-text">斜率优化DP</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%8E%A9%E5%85%B7%E8%A3%85%E7%AE%B1"><span class="nav-number">49.2.1.</span> <span class="nav-text">玩具装箱</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#sat"><span class="nav-number">50.</span> <span class="nav-text">2sat</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#words-on-tree"><span class="nav-number">50.1.</span> <span class="nav-text">Words on
Tree</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#cdqfft"><span class="nav-number">51.</span> <span class="nav-text">CDQFFT</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#mtt"><span class="nav-number">52.</span> <span class="nav-text">MTT</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#fwt"><span class="nav-number">53.</span> <span class="nav-text">FWT</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%8C%E7%BB%B4%E6%A0%BC%E9%9B%B7%E7%A0%81"><span class="nav-number">54.</span> <span class="nav-text">二维格雷码</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%94%E8%BE%B9%E5%BD%A2%E6%95%B0"><span class="nav-number">55.</span> <span class="nav-text">五边形数</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#sosdp"><span class="nav-number">56.</span> <span class="nav-text">SOSDP</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">mad0g4</p>
  <div class="site-description" itemprop="description">Blog of Mad0g4</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">5</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">mad0g4</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
